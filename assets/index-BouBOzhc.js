import{j as e,S as m,I as $}from"./index-D_a7UJeS.js";import{r as l}from"./vendor-react-DcqtUZ_G.js";import{c as w}from"./commonService-DDRzK25x.js";import{E as ae,c as E}from"./editBrand-D30vH6pr.js";import{c as le,o as ne,p as te,a as re}from"./options-DHqL16EA.js";import ce from"./brandModelDetail-D3QQpe8l.js";import{w as t,i as d,x as y,P as b,F as ie,y as z,j as de,I as oe,z as he,s as me}from"./vendor-antd-BiNc4BQP.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DcB4TerO.js";import"./addBrand-Cdele-hj.js";import"./cpManagementService-7XV0VY5a.js";function Ce(){const[A,N]=l.useState(1),[n,r]=l.useState({page:1}),[i,x]=l.useState([]),[C,R]=l.useState("list"),[T,f]=l.useState(!1),[K,S]=l.useState(!1),[p,L]=l.useState([]),[V,F]=l.useState(0),[W,k]=l.useState(!1),[v,_]=l.useState(null),[q,o]=l.useState(0),[u,M]=l.useState({}),[j,I]=l.useState(null),P=s=>{_(s),f(!0)},D=s=>{_(s||null),S(!0)},G=[{title:"Brand",dataIndex:"brand",key:"brand"},{title:"Brand Model",dataIndex:"brand_model",key:"brand_model",className:"bold",render:(s,a)=>e.jsx(d,{type:"link",onClick:()=>P(a),children:s})},{title:"Charge Model",dataIndex:"charge_model",width:"140px",key:"charge_model"},{title:"Connector NO.",dataIndex:"connector_no",width:"140px",key:"connector_no"},{title:"Phase",dataIndex:"phase",key:"phase"},{title:"OCPP",dataIndex:"ocpp",key:"ocpp"},{title:"Current Min",dataIndex:"out_current_min",key:"out_current_min",render:s=>e.jsxs("span",{children:[`${s}`,"A"]})},{title:"Current Max",dataIndex:"out_current_max",key:"out_current_max",render:s=>e.jsxs("span",{children:[`${s}`,"A"]})},{title:"Power Min",dataIndex:"out_power_min",key:"out_power_min",render:s=>e.jsxs("span",{children:[`${s}`,"kW"]})},{title:"Power Max",dataIndex:"out_power_max",key:"out_power_max",render:s=>e.jsxs("span",{children:[`${s}`,"kW"]})},{title:"Operation",width:"140px",key:"operation",render:(s,a)=>e.jsx("div",{className:"operations",children:e.jsx(b,{title:"Confirm delete?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>{g(a.id)},children:e.jsx(d,{type:"link",danger:!0,icon:e.jsx(m,{icon:"Delete",size:"20"}),children:"Delete"})})})}],J=()=>{i.length===p.length?x([]):x(p.map(s=>s.id))},Q=()=>{N(1);const s={...n};delete s.page,r(s),o(Date.now())},U=s=>{N(s),r({...n,page:s}),o(Date.now())},B=async()=>{const{detail:s}=await w.getBrands({num:100}),a={},h={};s.results.forEach(c=>{a[c.brand]=c.id;const O=[];c.chargepointbrandmodel_set&&c.chargepointbrandmodel_set.forEach(se=>{O.push(se.brand_model)}),h[c.brand]=O}),I(a),M(h)},H=()=>i.map(s=>s.split(w.rowKeySplit)[0]),g=async s=>{try{const a=await E.del({brand_model_ids:s?[s]:H()});a?.code===200&&(me.success(a.message),o(Date.now()))}catch{}},X=s=>s.map(a=>({...a,out_current_max:parseInt(`${a.out_current_max}`,10),out_current_min:parseInt(`${a.out_current_min}`,10),out_power_max:parseInt(`${a.out_power_max}`,10),out_power_min:parseInt(`${a.out_power_min}`,10),out_voltage_max:parseInt(`${a.out_voltage_max}`,10),out_voltage_min:parseInt(`${a.out_voltage_min}`,10),connector_type:a.charge_model==="AC"?"ac - type2":"dc - ccs2"})),Y=s=>{I({...j,[s.brand]:s.id}),M({...u,[s.brand]:[]})},Z=()=>{r({}),N(1),o(Date.now())},ee=async()=>{const s={...n};j&&(s.brand_id=j[s.brand],delete s.brand,s.brand_model||delete s.brand_model),k(!0);const a=await E.queryAll(s),{results:h,count:c}=a.detail;L(X(h||[])),F(c),k(!1)};return l.useEffect(()=>{ee()},[q]),l.useEffect(()=>{B(),o(Date.now())},[]),e.jsxs("div",{className:"main-content",children:[e.jsxs("div",{className:"search-area flex items-center justify-start",children:[e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Brand"}),e.jsx(t,{className:"w-full",value:n.brand,allowClear:!0,style:{width:"120px"},placeholder:"Select",onChange:s=>r({...n,brand:s,brand_model:void 0}),children:Object.keys(u).map(s=>e.jsx(t.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Brand Model"}),e.jsx(t,{className:"w-full",style:{width:"160px"},allowClear:!0,placeholder:"Select",value:n.brand_model,disabled:!n.brand,onChange:s=>r({...n,brand_model:s}),children:n.brand&&u[n.brand].map(s=>e.jsx(t.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Charge Model"}),e.jsx(t,{className:"w-full",style:{width:"160px"},allowClear:!0,placeholder:"Select",onChange:s=>r({...n,charge_model:s}),children:le.map(s=>e.jsx(t.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"OCPP"}),e.jsx(t,{placeholder:"Select",allowClear:!0,style:{width:"210px"},onChange:s=>r({...n,ocpp:s}),children:ne.map(s=>e.jsx(t.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Phase"}),e.jsx(t,{placeholder:"Select",allowClear:!0,style:{width:"190px"},onChange:s=>r({...n,phase:s}),children:te.map(s=>e.jsx(t.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Connector No"}),e.jsx(t,{className:"w-full",style:{width:"190px"},allowClear:!0,placeholder:"Select",onChange:s=>r({...n,connector_no:s}),children:re.map(s=>e.jsx(t.Option,{value:s,children:s},s))})]}),e.jsx("div",{className:"search-btn",children:e.jsx(d,{icon:e.jsx(m,{icon:"Search",size:"20"}),type:"primary",loading:W,onClick:Q})}),e.jsx("div",{className:"search-btn clear",children:e.jsx(d,{icon:e.jsx(m,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:Z})})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"operation-area flex items-center justify-start",children:[e.jsxs(y.Group,{className:"layout-switch",value:C,onChange:s=>R(s.target.value),children:[e.jsx(y.Button,{value:"list",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx($,{icon:"mynaui:list",size:20}),"List"]})}),e.jsx(y.Button,{value:"grid",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx($,{icon:"proicons:grid",size:20}),"Grid"]})})]}),e.jsx(d,{type:"primary",icon:e.jsx(m,{icon:"Add",size:"20"}),className:"ml-3 mr-3",onClick:()=>D(),children:"Add Brand Model"}),e.jsx(b,{title:"Confirm delete?",onConfirm:()=>{g()},placement:"bottom",okText:"Confirm",cancelText:"Cancel",children:e.jsx(d,{disabled:i.length===0,danger:!0,icon:e.jsx(m,{icon:"Delete",size:"20",color:i.length===0?"#999":"currentColor"}),children:"Bulk Delete"})})]})}),C==="list"?e.jsx(ie,{rowSelection:{type:"checkbox",onChange:s=>x(s)},bordered:!0,columns:G,dataSource:p,rowKey:s=>`${s.id}${w.rowKeySplit}${s.id_tag}`,pagination:!1}):e.jsxs("div",{className:"grid-wrapper",children:[e.jsx(z,{className:"check-all",checked:p.length===i.length,onChange:J}),e.jsx("div",{className:"grid",children:p.map(s=>e.jsx("div",{className:"grid-item",children:e.jsxs(de,{hoverable:!0,className:"flex flex-col",children:[e.jsxs("div",{className:"grid-top with-image flex items-center",children:[e.jsx(z,{checked:i.includes(s.id),onChange:a=>{const h=a.target.checked?[...i,s.id]:i.filter(c=>c!==s.id);x(h)}}),e.jsx(oe,{src:s.picture,preview:!1,height:184,className:"entity-image object-cover"})]}),e.jsxs("div",{className:"grid-bottom",children:[e.jsx("div",{className:"display-item title",children:s.brand}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand Model:"}),e.jsx("span",{className:"value",children:e.jsx(d,{type:"link",onClick:()=>{P(s)},children:e.jsx("span",{className:"bold",children:s.brand_model})})})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Charge Model:"}),e.jsx("span",{className:"value",children:s.charge_model})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Connector No:"}),e.jsx("span",{className:"value",children:s.connector_no})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Phase:"}),e.jsx("span",{className:"value",children:s.phase})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"OCPP:"}),e.jsx("span",{className:"value",children:s.ocpp})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Current:"})," ",e.jsxs("span",{className:"value",children:[e.jsxs("span",{className:"value-item",children:[e.jsxs("span",{className:"data",children:[s.out_current_min,"A"]}),e.jsx("span",{className:"tag",children:"min"})]}),e.jsxs("span",{className:"value-item",children:[e.jsxs("span",{className:"data",children:[s.out_current_max,"A"]}),e.jsx("span",{className:"tag",children:"max"})]})]})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Power:"})," ",e.jsx("span",{className:"value",children:e.jsxs("span",{className:"value-item",children:[e.jsxs("span",{className:"data",children:[s.out_power_min,"kW"]}),e.jsx("span",{className:"tag",children:"min"}),e.jsxs("span",{className:"value-item",children:[e.jsxs("span",{className:"data",children:[s.out_power_max,"kW"]}),e.jsx("span",{className:"tag",children:"max"})]})]})})]}),e.jsx("div",{className:"operation-rows",children:e.jsx(b,{title:"Confirm delete?",onConfirm:()=>{g(s.id)},placement:"bottom",okText:"Confirm",cancelText:"Cancel",children:e.jsx(d,{type:"link",danger:!0,icon:e.jsx(m,{icon:"Delete",size:"20",color:"#FF4747"}),children:"Delete"})})})]})]},s.id)}))})]}),e.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:e.jsx(he,{current:A,total:V,showSizeChanger:!1,showQuickJumper:!0,onChange:U})}),e.jsx(ce,{visible:T,onClose:()=>f(!1),record:v,onDelete:()=>{o(Date.now())},onEdit:()=>{D(v)}}),e.jsx(ae,{visible:K,onClose:()=>S(!1),record:v,brandModels:u,brandMap:j,updateBrandModels:Y,onSave:()=>{o(Date.now()),_(null),B()}})]})}export{Ce as default};

import{j as e,S as u,f as D}from"./index-BG77QkcC.js";import{r as a}from"./vendor-react-DcqtUZ_G.js";import{c as v}from"./commonService-Du_g5rH6.js";import{c as L}from"./cpUserManagementService-CHpzmyTz.js";import{c as xe}from"./chargepoint-wPlJlVYc.js";import je from"./addChargepoint-0airySOO.js";import _e from"./chargepointUserDetail-DnF86L6H.js";import fe from"./editLocation-nJBrh40q.js";import ge from"./unbindUser-BXQe5-7o.js";import{K as be,w as N,i as c,x as C,P as y,F as ve,y as P,j as Ce,I as ye,k as we,z as Ne,s as Se}from"./vendor-antd-DC1bX4vL.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DUuMHeSo.js";import"./index-8g4EbXuE.js";import"./index.modern-DDXp5BPH.js";import"./vendor-charts-CCrp_OZH.js";import"./index-DcX75npX.js";const{Option:w}=N;function qe(){const[r,h]=a.useState({page:1}),[E,d]=a.useState(0),[T,z]=a.useState(null),[f,V]=a.useState("id_tag"),[S,R]=a.useState([]),[x,A]=a.useState([]),[K,O]=a.useState(0),[q,k]=a.useState(!1),[$,F]=a.useState("list"),[i,_]=a.useState([]),[G,J]=a.useState([]),[Q,H]=a.useState(null),[W,X]=a.useState(null),[Y,M]=a.useState(!1),[Z,U]=a.useState(!1),[ee,g]=a.useState(!1);a.useState(!1);const[se,I]=a.useState(!1),B=s=>{z(s),M(!0)},te=[{title:"Charge Point",dataIndex:"id_tag",key:"id_tag",className:"bold",render:(s,t)=>e.jsx(c,{type:"link",onClick:()=>B(t),children:s})},{title:"User",dataIndex:"user",key:"user"},{title:"Location",dataIndex:"location",key:"location",render:s=>e.jsx("div",{className:"display-row location",children:e.jsx("div",{className:"row-item",children:`${s?.cp_address||""} ${s?.cp_suburb||""} ${s?.cp_state||""} ${s?.cp_postcode||""}`})})},{title:"Operation",width:"140px",key:"operation",render:(s,t)=>e.jsx("div",{className:"operations",children:e.jsx(y,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm unbind?",onConfirm:()=>b(t.id),children:e.jsx(c,{type:"link",icon:e.jsx(u,{icon:"Unbind",size:"20"}),children:"Unbind"})})})}],ae=()=>{g(!0)},ne={selectedRowKeys:i,onChange:s=>{_(s)}},ie=e.jsxs(N,{value:f,onChange:V,style:{width:156},children:[e.jsx(w,{value:"id_tag",children:"Charge Point"}),e.jsx(w,{value:"sn",children:"SN"})]}),oe=()=>{i.length===x.length?_([]):_(x.map(s=>s.key))},b=async s=>{try{const t=await L.unbind({charge_point_user_ids:s?[s]:i});t?.code===200&&(Se.success(t.message),d(Date.now()))}catch{}},le=()=>{const s={...r};delete s.page,h(s),d(Date.now())},ce=s=>{h({...r,page:s}),d(Date.now())},re=async()=>{const{detail:s}=await v.getBrands({num:100}),t={},o={},m={};s.results.forEach(l=>{t[l.brand]=l.id;const j=[];l.chargepointbrandmodel_set&&l.chargepointbrandmodel_set.forEach(p=>{m[`${l.id} ${p.brand_model}`]=p.id,j.push(p.brand_model)}),o[l.brand]=j}),H(t),X(m),J(o)},de=async()=>{const{detail:s}=await v.getUsers({num:100});R(s.results.map(t=>({name:`${t.first_name} ${t.last_name}`,phone:t.phone,email:t.email,user_id:t.user_id})))},me=s=>s.map(t=>{const{id:o,first_name:m,last_name:l,charge_point:j}=t,{charge_point_detail:p,brand_model:n,sn:he}=j;return{id:o,user:`${m} ${l}`,picture:n.picture,location:p,latlng:p?.latlng,key:`${t.id}${v.rowKeySplit}${t.charge_point_id}`,sn:he,id_tag:j.id_tag,brand:n.brand,brand_model:n.brand_model,charge_model:n.charge_model,connector_no:n.connector_no,ocpp:n.ocpp,phase:n.phase,out_current_max:parseInt(`${n.out_current_max}`,10),out_current_min:parseInt(`${n.out_current_min}`,10),out_power_max:parseInt(`${n.out_power_max}`,10),out_power_min:parseInt(`${n.out_power_min}`,10),out_voltage_max:parseInt(`${n.out_voltage_max}`,10),out_voltage_min:parseInt(`${n.out_voltage_min}`,10),connector_type:n.charge_model==="AC"?"ac - type2":"dc - ccs2"}}),pe=()=>{h({}),d(Date.now())},ue=async()=>{k(!0);const s=await L.queryAll(r),{results:t,count:o}=s.detail;A(me(t||[])),O(o),k(!1)};return a.useEffect(()=>{ue()},[E]),a.useEffect(()=>{de(),re(),d(Date.now())},[]),e.jsxs("div",{className:"main-content",children:[e.jsxs("div",{className:"search-area flex items-center justify-start",children:[e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:" "}),e.jsx(be,{addonBefore:ie,placeholder:"Enter",allowClear:!0,value:r[f],onChange:s=>{let t={...r};delete t.id_tag,delete t.sn,t={...t,[f]:s.target.value},h(t)}})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"User"}),e.jsx(N,{className:"w-full",allowClear:!0,value:r.user_id,style:{width:"150px"},onChange:s=>{h({...r,user_id:s})},placeholder:"Select",children:S.map(s=>e.jsx(w,{value:s.user_id,children:s.name},s.name))})]}),e.jsx("div",{className:"search-btn",children:e.jsx(c,{icon:e.jsx(u,{icon:"Search",size:"20"}),type:"primary",loading:q,onClick:le})}),e.jsx("div",{className:"search-btn clear",children:e.jsx(c,{icon:e.jsx(u,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:pe})})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"operation-area flex items-center justify-start",children:[e.jsxs(C.Group,{className:"layout-switch",value:$,onChange:s=>F(s.target.value),children:[e.jsx(C.Button,{value:"list",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(D,{icon:"mynaui:list",size:20}),"List"]})}),e.jsx(C.Button,{value:"grid",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(D,{icon:"proicons:grid",size:20}),"Grid"]})})]}),e.jsx(c,{icon:e.jsx(u,{icon:"Bind",size:"20"}),type:"primary",onClick:ae,className:"ml-3 mr-3",children:"Bind User and Charge Point"}),e.jsx(y,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm unbind?",onConfirm:()=>b(),children:e.jsx(c,{disabled:i.length===0,className:"ml-3",icon:e.jsx(u,{icon:"Unbind",size:"20",color:i.length===0?"#999":"currentColor"}),children:"Bulk Unbind"})})]})}),$==="list"?e.jsx(ve,{rowSelection:ne,rowKey:"id",columns:te,bordered:!0,dataSource:x,pagination:!1}):e.jsxs("div",{className:"grid-wrapper",children:[e.jsx(P,{className:"check-all",checked:x.length===i.length,onChange:oe}),e.jsx("div",{className:"grid",children:x.map(s=>e.jsx("div",{className:"grid-item",children:e.jsxs(Ce,{children:[e.jsxs("div",{className:"grid-top with-image flex items-center",children:[e.jsx(P,{checked:i.includes(s.id),onChange:t=>{const o=t.target.checked?[...i,s.id]:i.filter(m=>m!==s.id);_(o)}}),e.jsx(ye,{src:xe,preview:!1,height:184,className:"entity-image object-cover"})]}),e.jsxs("div",{className:"grid-bottom",children:[e.jsx("div",{className:"display-item",children:e.jsx(c,{type:"link",className:"detail-link",onClick:()=>{B(s)},children:s.id_tag})}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label bold",children:"User:"})," ",e.jsx("span",{className:"value",children:e.jsx("div",{children:e.jsx("div",{children:s.user})})})]}),e.jsxs("div",{className:"display-item location",children:[e.jsx("span",{className:"label",children:"Location:"})," ",e.jsx("span",{className:"value",children:e.jsx(we,{placement:"topLeft",title:`${s.location?.cp_address} ${s.location?.cp_suburb} ${s.location?.cp_state} ${s.location?.cp_postcode}`,children:e.jsx("span",{className:"truncated-text mr-1",children:`${s.location?.cp_address} ${s.location?.cp_suburb} ${s.location?.cp_state} ${s.location?.cp_postcode}`})})})]}),e.jsx("div",{className:"operation-rows",children:e.jsx(y,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm unbind?",onConfirm:()=>b(s.id),children:e.jsx(c,{type:"link",icon:e.jsx(u,{icon:"Unbind",size:"20"}),children:"Unbind"})})})]})]},s.id)}))})]}),e.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:e.jsx(Ne,{total:K,showQuickJumper:!0,onChange:ce})}),e.jsx(_e,{record:T,visible:Y,onClose:()=>{M(!1),d(Date.now())}}),e.jsx(fe,{visible:Z,onCancel:()=>U(!1),onConfirm:()=>U(!1)}),e.jsx(je,{visible:ee,brandModels:G,users:S,brandMap:Q,branModelMap:W,onCancel:()=>g(!1),onConfirm:()=>g(!1)}),e.jsx(ge,{visible:se,onCancel:()=>I(!1),onConfirm:()=>I(!1)})]})}export{qe as default};

import{j as e,S as u}from"./index-BnnhTYue.js";import{r as o}from"./vendor-react-DcqtUZ_G.js";import{c as S}from"./cpMonitorService-DSYHoixP.js";import{E as z,i as p,k as P,Q as x,x as _,j as B,H as N,s as j}from"./vendor-antd-BiNc4BQP.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DcB4TerO.js";function K({visible:m,onCancel:A,connector:r,onConfirm:y}){const[l,n]=o.useState([{limit:"",startAfter:0,time:0}]),[C,I]=o.useState(),[f,b]=o.useState(),[M,v]=o.useState("Set Charge Profile"),[d,w]=o.useState("current");o.useEffect(()=>{m||n([{limit:"",startAfter:0,time:0}])},[m]);const R=()=>{n([...l,{limit:"",startAfter:l.length===0?0:"",time:Date.now()}])},V=t=>{const a=l.filter((s,i)=>i!==t);n([...a])},k=(t,a)=>{const s=[...l],i=s.map((h,c)=>c===t?{...s[t]||{limit:"",startAfter:"",time:Date.now()},limit:a}:h);n(i)},E=(t,a)=>{const s=[...l],i=s.map((h,c)=>c===t?{...s[t]||{limit:"",startAfter:"",time:Date.now()},startAfter:a}:h);n(i)},D=t=>{w(t),n([{limit:"",startAfter:"",time:Date.now()}])},L=async()=>{if(r.v2g_support==="V2G"&&!f){j.error("Please Enter SoC");return}let t=!0;const a=l.map(g=>((g.limit===""||g.startAfter==="")&&(t=!1),{limit:g.limit,startPeriod:g.startAfter*60}));if(!t||a.length===0){j.error("Please Input Limit and Start After");return}let s={max:.92};r.v2g_support==="V2G"&&(s=r?.charge_mode==="charge_mode"?{max:(f||0)/100}:{min:(f||0)/100});let i={charge_point_id:r.charge_point_id,connector_id:r.connector_id,transaction_id:C,mode:r?.charge_mode==="charge_mode"?"default":"v2g",soc:s};i={...i,cs_charging_profiles:{chargingProfileId:1,transaction_id:C,stackLevel:2,chargingProfilePurpose:"TxProfile",chargingProfileKind:"Relative",chargingSchedule:{chargingRateUnit:d==="current"?"A":"B",chargingSchedulePeriod:a}}};const h=[i],c=await S.setChargingProfile({charge_profiles:h});c?.code===200&&(j.success(c.message),y())},T=async()=>{const t=await S.getRealtimeInfo(r.charge_point_id,{connector_id:r.connector_id,action:"MeterValues"});I(t.detail.transaction_id)};return o.useEffect(()=>{m&&(n([{limit:"",startAfter:0,time:Date.now()}]),w("current"),T(),r?.v2g_support==="V2G"&&(r?.charge_mode==="charge_mode"?v("Set Charge Profile"):v("Set Discharge Profile")))},[m]),e.jsx(z,{title:M,open:m,onCancel:A,zIndex:1001,footer:[e.jsxs("div",{className:`footer-normal-btns ${r?.charge_mode}_form`,children:[e.jsx(p,{onClick:A,children:"Cancel"},"cancel"),e.jsx(p,{type:"primary",onClick:L,children:"Confirm"},"confirm")]},"set-charge-footer")],width:500,children:e.jsxs("div",{className:`modal-form one-column ${r?.charge_mode}_form`,children:[e.jsx("div",{className:"between-wrapper",children:e.jsx("div",{className:"title",children:r?.name})}),r?.v2g_support==="V2G"&&e.jsxs("div",{className:"soc-wrapper label-value-split mt-2",children:[e.jsx("label",{children:r?.charge_mode==="charge_mode"?e.jsxs("div",{className:"icon-label",children:[e.jsx("span",{children:"Max SoC(%)"}),e.jsx(P,{title:"Maximum Charge Limit Is 95%",placement:"top",children:e.jsx("span",{className:"svg-wrapper",children:e.jsx(u,{className:"ml-1",icon:"Help",size:"20"})})})]}):e.jsxs("div",{className:"icon-label",children:[e.jsx("span",{children:"Min SoC(%)"}),e.jsx(P,{title:"Minimum Discharge Limit Is 20%",placement:"top",children:e.jsx("span",{children:e.jsx(u,{className:"ml-1",icon:"Help",size:"20"})})})]})}),e.jsx(x,{min:r?.charge_mode==="charge_mode"?1:20,max:r?.charge_mode==="charge_mode"?95:1e4,placeholder:"Enter",onChange:t=>b(t)})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"between-wrapper",children:[e.jsxs(_.Group,{optionType:"button",value:d,onChange:t=>D(t.target.value),className:"my-4",children:[e.jsx(_.Button,{value:"current",children:"Current"}),e.jsx(_.Button,{value:"power",children:"Power"})]}),e.jsx(p,{type:"link",icon:e.jsx(u,{icon:r?.charge_mode==="discharge_mode"?"Add2":"Add",color:r?.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",size:"28"}),onClick:()=>R()})]}),e.jsx(B,{children:l.map((t,a)=>e.jsxs("div",{className:"advance-start-row",children:[e.jsx("div",{className:"close-row",children:e.jsx(p,{type:"link",onClick:()=>V(a),icon:e.jsx(u,{icon:"Close",size:"20",color:"#C3C3C3"})})}),e.jsxs("div",{className:"label-value-split ",children:[e.jsx(N.Item,{name:"limit",label:d==="current"?"Limit(A)":"Limit(W)",rules:[{required:!0,message:d==="current"?"Current limit":"Power limit"}],children:e.jsx(x,{min:1,max:1e5,defaultValue:t.limit,placeholder:d==="current"?"Current limit":"Power limit",onChange:s=>k(a,s)})}),e.jsx(N.Item,{name:"startAfter",label:"Start After(Minutes)",rules:[{required:!0,message:"Start After"}],children:e.jsx(x,{min:a===0?0:1,max:a===0?0:1e5,disabled:a===0,placeholder:"Start After",defaultValue:t.startAfter,onChange:s=>E(a,s)})})]},a)]},`setting-${t.time}`))})]})]})})}export{K as default};

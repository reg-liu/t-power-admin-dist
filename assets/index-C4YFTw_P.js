import{j as e,S as d,f as te}from"./index-4YVUTv9m.js";import{r}from"./vendor-react-DcqtUZ_G.js";import{c as S}from"./commonService-BMeX5SkH.js";import{c as I}from"./cpMonitorService-mLFqFA9m.js";import{c as Te}from"./chargepoint-wPlJlVYc.js";import{v as Fe,b as ne}from"./options-DHqL16EA.js";import ze from"./detail-CHGL3Cc7.js";import Ke from"./editConnector-bdc6EkYm.js";import Oe from"./setChargeProfile-kgSXLT1o.js";import Ae from"./start-3xbe4hC5.js";import Pe from"./v2gStart-CKbolHx8.js";import{F as M,i as c,K as Ge,w as h,x as R,P as j,y as U,j as Le,I as Re,k as y,z as Ue,s as q}from"./vendor-antd-BiNc4BQP.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DcB4TerO.js";const{Option:V}=h,H={1:"Online",2:"Offline",3:"Unknown"},le={1:"Available",2:"Unavailable",3:"Preparing",4:"Starting",5:"Stopping",6:"Charging",7:"Suspended EV",8:"Suspended EVSE",9:"Finishing",10:"Reserved",11:"Faulted",12:"Unknown",13:"Discharging"};function rs(){const[re,D]=r.useState(1),[i,u]=r.useState({page:1}),[$,oe]=r.useState("id_tag"),[g,J]=r.useState([]),[m,b]=r.useState([]),[Q,ie]=r.useState("list"),[ce,N]=r.useState(!1),[de,T]=r.useState(!1),[he,w]=r.useState(!1),[k,F]=r.useState(!1),[me,C]=r.useState(!1),[z,E]=r.useState(null),[f,x]=r.useState(null),[pe,X]=r.useState([]),[_,W]=r.useState([]),[ue,Y]=r.useState(!1),[xe,ge]=r.useState(0),[_e,K]=r.useState(0),[je,p]=r.useState(0),[Z,Ce]=r.useState({}),[ee,fe]=r.useState(null);r.useEffect(()=>{const s=_.filter(a=>g.includes(a.key)).flatMap(a=>a.connectors.map(n=>n.key));b(s)},[g]);const ve=()=>{const s=m.map(a=>{const[n,t]=a.split(S.rowKeySplit);return{charge_point_id:n,connector_id:t}});P(s,!0)},Se=()=>{const s=m.map(a=>{const[n,t]=a.split(S.rowKeySplit);return{charge_point_id:n,connector_id:t}});G(s,!0)},O=s=>{J(s)},ye=s=>{if(m.includes(s.key)){const a=m.filter(n=>n!==s.key);b(a)}else b([...m,s.key])},be=()=>{g.length===_.length?O([]):O(_.map(s=>s.key))},se=()=>{f?.status==="Charging"?N(!0):q.error("Only the Connector in Charging state supports this operation.")},A=(s,a)=>{const n=[..._];n.map(t=>(s.charge_point_id===t.id&&(t.connectors=t.connectors.map(o=>(s.connector_id===o.connector_id&&(o.charge_mode=a),o))),t)),W(n)},Ne=[M.SELECTION_COLUMN,M.EXPAND_COLUMN,{title:"Charge Point",dataIndex:"id_tag",className:"bold",key:"id_tag",width:"260px",render:(s,a)=>e.jsx(c,{type:"link",onClick:()=>{E(a),F(!0)},children:s})},{title:"Status",width:"200px",dataIndex:"charge_point_status",key:"charge_point_status",render:s=>e.jsxs("div",{className:`status-item ${s.toLowerCase()}`,children:[e.jsx("div",{className:"point"}),e.jsx("span",{children:s})]})},{title:"SN",width:"200px",dataIndex:"sn",key:"sn"},{title:"Brand",width:"166px",dataIndex:"brand",key:"brand"},{title:"Brand Model",dataIndex:"brand_model",key:"brand_model"},{title:"V2G Support",dataIndex:"v2g_support",key:"v2g_support"}],we=s=>{const a=[{title:"ID",className:"bold",width:"300px",dataIndex:"name",key:"name"},{title:"Status",width:"210px",dataIndex:"status",key:"status",render:n=>e.jsx("div",{className:`status ${n.toLowerCase().replace(" ","_")}`,children:e.jsx("span",{children:n})})},{title:"Charge Mode",width:"160px",dataIndex:"charge_mode",key:"charge_mode",render:(n,t)=>t.v2g_support==="V2G"?e.jsx("div",{className:"change-charge-mode ",children:e.jsx(h,{placeholder:"Select",value:n,style:{width:"160px"},onChange:o=>A(t,o),children:ne.map(o=>e.jsx(h.Option,{value:o.value,children:e.jsx("span",{className:o.value,children:o.label})},o.value))})}):e.jsx("div",{className:"status charge_mode",children:e.jsx("span",{children:"Charge Mode"})})},{title:"Operation",key:"operation",render:(n,t)=>e.jsxs("div",{className:"operations end",children:[t.v2g_support==="V2G"?e.jsx(c,{type:"link",onClick:()=>ae(t),icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Start"})}):e.jsx(j,{title:"Confirm start?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>P(t),children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Start"})})}),e.jsx(j,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm stop?",onConfirm:()=>G(t),children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Stop",size:"20"}),children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Stop"})})}),e.jsx(c,{type:"link",className:"operation-row-item",icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"AStart",size:"20"}),onClick:()=>{x(t),C(!0)},children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Advance Start"})}),e.jsx(c,{type:"link",icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Set",size:"20"}),onClick:()=>{x(t),se()},children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Set Profile"})})]})}];return e.jsx(M,{columns:a,showHeader:!1,dataSource:s.connectors,pagination:!1,rowKey:"key",bordered:!0,rowSelection:{selectedRowKeys:m,onSelect:ye}})},ke=e.jsxs(h,{value:$,onChange:oe,style:{width:156},children:[e.jsx(V,{value:"id_tag",children:"Charge Point"}),e.jsx(V,{value:"sn",children:"SN"})]}),Ee=s=>{const{expanded:a,onExpand:n,record:t}=s;return e.jsx("span",{onClick:o=>n(t,o),children:e.jsx(d,{icon:a?"Down":"Right",size:"17",color:"#d9d9d9",style:{marginTop:"-2px"}})})},ae=s=>{x(s),w(!0)},P=async(s,a)=>{const n=a?s:[{charge_point_id:s.charge_point_id,connector_id:s.connector_id,mode:"default"}],t=await I.start({cp_id_connector_pairs:n});t?.code===200&&(q.success(t.message),p(Date.now()))},G=async(s,a)=>{const n=a?s:[{charge_point_id:s.charge_point_id,connector_id:s.connector_id}],t=await I.stop({cp_id_connector_pairs:n});t?.code===200&&(q.success(t.message),p(Date.now()))},Be=()=>{const s={...i};D(1),delete s.page,u(s),p(Date.now())},Ie=s=>{D(s),u({...i,page:s}),p(Date.now())},Me=async()=>{const{detail:s}=await S.getBrands({num:100}),a={},n={};s.results.forEach(t=>{a[t.brand]=t.id;const o=[];t.chargepointbrandmodel_set&&t.chargepointbrandmodel_set.forEach(l=>{o.push(l.brand_model)}),n[t.brand]=o}),fe(a),Ce(n)},Ve=(s,a)=>{const n={},t={0:"Connector A",1:"Connector B",2:"Connector C",3:"Connector D",4:"Connector E",5:"Connector F",6:"Connector G",7:"Connector H",8:"Connector I",9:"Connector J"};return a.forEach(l=>{const{connector_statuses:B}=l;B.sort((v,L)=>v.connector_id-L.connector_id),n[l.charge_point_id]={charge_point_status:H[l.charge_point_status],connector_statuses:B.map((v,L)=>({key:`${l.charge_point_id}${S.rowKeySplit}${v.connector_id}`,name:t[`${L}`],charge_point_id:l.charge_point_id,connector_id:v.connector_id,charge_mode:"charge_mode",status:le[v.status]}))}}),s.filter(l=>n[l.id]).map(l=>({key:`${l.id}${S.rowKeySplit}${l.id_tag}`,id:l.id,id_tag:l.id_tag,sn:l.sn,brand:l.brand_model.brand,brand_model:l.brand_model.brand_model,v2g_support:l.v2g_support?"V2G":"Non-V2G",charge_point_status:n[l.id].charge_point_status,picture:l.brand_model.picture,charge_model:l.brand_model.charge_model,connector_type:l.brand_model.charge_model==="AC"?"AC - Type2":"DC - CCS2",connectors:n[l.id].connector_statuses.map(B=>({...B,v2g_support:l.v2g_support?"V2G":"Non-V2G"}))}))},De=()=>{u({}),D(1),p(Date.now())},$e=async()=>{const s={...i};ee&&(s.brand_id=ee[s.brand],delete s.brand,s.brand_model||delete s.brand_model),Y(!0);const a=await I.queryAll({num:100}),{results:n}=a.detail,t=await I.getStatus(s),o=Ve(n||[],t.detail.results);W(o),z&&o.length&&o.forEach(l=>{l.key===z.key&&E(l)}),X(o.map(l=>l.key)),ge(t.detail.count),Y(!1)};return r.useEffect(()=>{$e()},[je]),r.useEffect(()=>{Me(),p(Date.now())},[]),e.jsxs("div",{className:"main-content",children:[e.jsxs("div",{className:"search-area flex items-center justify-start",children:[e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:" "}),e.jsx(Ge,{addonBefore:ke,placeholder:"Enter",allowClear:!0,style:{width:"360px"},value:i[$],onChange:s=>{let a={...i};delete a.id_tag,delete a.sn,a={...a,[$]:s.target.value},u(a)}})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Brand"}),e.jsx(h,{className:"w-full",placeholder:"Select",allowClear:!0,value:i.brand,style:{width:"150px"},onChange:s=>{u({...i,brand:s,brand_model:void 0})},children:Object.keys(Z).map(s=>e.jsx(h.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Brand Model"}),e.jsx(h,{className:"w-full",allowClear:!0,disabled:!i.brand,placeholder:"Select",style:{width:"160px"},value:i.brand_model,onChange:s=>u({...i,brand_model:s}),children:i.brand&&Z[i.brand].map(s=>e.jsx(h.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"V2G Support"}),e.jsx(h,{placeholder:"Select",allowClear:!0,style:{width:"160px"},onChange:s=>{u({...i,v2g_support:!!s})},children:Fe.map(s=>e.jsx(h.Option,{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Charge Point Status"}),e.jsx(h,{className:"w-full",style:{width:"210px"},allowClear:!0,value:i.charge_point_status,placeholder:"Select",onChange:s=>u({...i,charge_point_status:s}),children:Object.entries(H).map(([s,a])=>e.jsx(V,{value:s,children:`${a}`},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Connector Status"}),e.jsx(h,{className:"w-full",style:{width:"190px"},allowClear:!0,placeholder:"Select",value:i.connector_status,onChange:s=>u({...i,connector_status:s}),children:Object.entries(le).map(([s,a])=>e.jsx(V,{value:s,children:`${a}`},s))})]}),e.jsx("div",{className:"search-btn",children:e.jsx(c,{icon:e.jsx(d,{icon:"Search",size:"20"}),type:"primary",loading:ue,onClick:Be})}),e.jsx("div",{className:"search-btn clear",children:e.jsx(c,{icon:e.jsx(d,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:De})})]}),e.jsxs("div",{className:"operation-area flex items-center justify-start",children:[e.jsxs(R.Group,{className:"layout-switch",value:Q,onChange:s=>ie(s.target.value),children:[e.jsx(R.Button,{value:"list",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(te,{icon:"mynaui:list",size:20}),"List"]})}),e.jsx(R.Button,{value:"grid",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(te,{icon:"proicons:grid",size:20}),"Grid"]})})]}),e.jsx(j,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm Start?",onConfirm:()=>ve(),children:e.jsx(c,{className:"ml-3 mr-3",disabled:m.length===0,icon:e.jsx(d,{icon:"Start",size:"20",color:m.length===0?"#999":"currentColor"}),children:"Bulk Start"})}),e.jsx(j,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm stop?",onConfirm:()=>Se(),children:e.jsx(c,{disabled:m.length===0,className:"mr-3",icon:e.jsx(d,{color:m.length===0?"#999":"currentColor",icon:"Stop",size:"20"}),children:"Bulk Stop"})})]}),Q==="list"?e.jsx(M,{columns:Ne,dataSource:_,rowHoverable:!1,bordered:!0,rowKey:"key",pagination:!1,expandable:{expandedRowRender:we,expandIcon:Ee,expandedRowKeys:pe,onExpand:(s,a)=>{X(n=>s?[...n,a.key]:n.filter(t=>t!==a.key))}},rowSelection:{selectedRowKeys:g,onChange:O}}):e.jsxs("div",{className:"grid-wrapper",children:[e.jsx(U,{className:"check-all",checked:_.length===g.length,onChange:be}),e.jsx("div",{className:"grid",children:_.map(s=>e.jsx("div",{className:"grid-item",children:e.jsxs(Le,{children:[e.jsxs("div",{className:"grid-top with-image flex items-center",children:[e.jsx(U,{checked:g.includes(s.key),onChange:a=>{const n=a.target.checked?[...g,s.key]:g.filter(t=>t!==s.key);J(n)}}),e.jsx(Re,{src:Te,preview:!1,height:184,className:"entity-image object-cover"})]}),e.jsxs("div",{className:"grid-bottom monitor-bottom",children:[e.jsx("div",{className:"display-item",children:e.jsx(c,{type:"link",className:"detail-link",onClick:()=>{E(s),F(!0)},children:s.id_tag})}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Status:"})," ",e.jsx("span",{className:"value",children:e.jsxs("div",{className:`status-item ${s.charge_point_status.toLowerCase().replace(" ","_")}`,children:[e.jsx("div",{className:"point"}),e.jsx("span",{children:s.charge_point_status})]})})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"SN:"})," ",e.jsx("span",{className:"value",children:s.sn})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand:"})," ",e.jsx("span",{className:"value",children:s.brand})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand Model:"})," ",e.jsx("span",{className:"value",children:s.brand_model})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"V2G Support:"})," ",e.jsx("span",{className:"value",children:s.v2g_support})]}),s.charge_point_status!=="Offline"&&e.jsx("div",{className:"display-item  !mb-0 flex-col !items-start gap-2 !px-0",children:s.connectors.map(a=>e.jsxs("div",{className:"connector-wrapper w-full",children:[e.jsxs("div",{className:"connectors",children:[e.jsx(U,{checked:m.includes(a.key),onChange:n=>{const t=n.target.checked?[...m,a.key]:m.filter(o=>o!==a.key);b(t)}}),e.jsx("div",{className:"items flex-auto",children:e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:a.name})," ",e.jsx("span",{className:`value status ${a.status.toLowerCase().replace(" ","_")}`,children:a.status})]})})]}),e.jsxs("div",{className:"operation-columns",children:[e.jsx("div",{className:"operation-row",children:a.v2g_support==="V2G"?e.jsx(h,{placeholder:"Select",value:a.charge_mode,style:{width:"100%"},onChange:n=>A(a,n),children:ne.map(n=>e.jsx(h.Option,{value:n.value,children:e.jsx("span",{className:n.value,children:n.label})},n.value))}):e.jsx("div",{className:"status charge_mode",children:e.jsx("span",{children:"Charge Mode"})})}),e.jsxs("div",{className:"operation-row btns",children:[a.v2g_support==="V2G"?e.jsx(y,{title:"Start",color:a.charge_mode==="discharge_mode"?"#1B6EF3":"#1CAE70",placement:"bottom",children:e.jsx(c,{type:"link",onClick:()=>ae(a),icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`})})}):e.jsx(j,{title:"Confirm start?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>P(a),children:e.jsx(y,{title:"Start",color:a.charge_mode==="discharge_mode"?"#1B6EF3":"#1CAE70",placement:"bottom",children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`})})})}),e.jsx("div",{className:"split"}),e.jsx(j,{title:"Confirm stop?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>G(a),children:e.jsx(y,{title:"Stop",color:a.charge_mode==="discharge_mode"?"#1B6EF3":"#1CAE70",placement:"bottom",children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Stop",size:"20"}),children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`})})})}),e.jsx("div",{className:"split"}),e.jsx(y,{title:"Advance Start",color:a.charge_mode==="discharge_mode"?"#1B6EF3":"#1CAE70",placement:"bottom",children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"AStart",size:"20"}),onClick:()=>{x(a),C(!0)},children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`})})}),e.jsx("div",{className:"split"}),e.jsx(y,{title:"Set Profile",color:a.charge_mode==="discharge_mode"?"#1B6EF3":"#1CAE70",placement:"bottom",children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Set",size:"20"}),onClick:()=>{x(a),se()},children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`})})})]})]})]},a.key))})]})]},s.key)}))})]}),e.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:e.jsx(Ue,{total:xe,current:re,showSizeChanger:!1,showQuickJumper:!0,onChange:Ie})}),e.jsx(Oe,{visible:ce,connector:f,onCancel:()=>N(!1),onConfirm:()=>{N(!1),p(Date.now()),k&&K(Date.now())}}),e.jsx(Ke,{visible:de,connector:f,onCancel:()=>T(!1),onConfirm:()=>{T(!1)}}),e.jsx(Pe,{visible:he,connector:f,onCancel:()=>w(!1),onConfirm:()=>{w(!1),k&&K(Date.now())}}),k?e.jsx(ze,{onCancel:()=>{E(null),F(!1),p(Date.now())},cpStatusMap:H,detailUpdate:_e,chargePoint:z,onChangeChargeMode:(s,a)=>{A(s,a)},handleV2gStart:s=>{x(s),w(!0)},onStart:s=>{x(s),C(!0)},onUpdate:()=>{p(Date.now())},onSetChargeProfile:s=>{x(s),N(!0)},onEditConnector:s=>{x(s),T(!0)}}):null,e.jsx(Ae,{visible:me,connector:f,onCancel:()=>C(!1),onConfirm:()=>{C(!1),p(Date.now()),k&&K(Date.now())}})]})}export{rs as default};

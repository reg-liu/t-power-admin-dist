import{j as e}from"./index-BG77QkcC.js";import{r as l}from"./vendor-react-DcqtUZ_G.js";import{c as y}from"./cpUserManagementService-CHpzmyTz.js";import{M as B}from"./index-8g4EbXuE.js";import{H as r,E as I,i as c,K as k,w as n,s as v}from"./vendor-antd-DC1bX4vL.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DUuMHeSo.js";import"./index.modern-DDXp5BPH.js";import"./vendor-charts-CCrp_OZH.js";import"./index-DcX75npX.js";const{Option:N}=n;function H({visible:d,onCancel:o,onConfirm:j,users:b,brandMap:i,brandModels:m,branModelMap:f}){const[a]=r.useForm(),[_,p]=l.useState(!1),[t,u]=l.useState(),[h,g]=l.useState([]),S=()=>{p(!0)},C=()=>{p(!1)},F=s=>{u(s),a.setFieldsValue({location:s})},M=()=>{a.setFieldsValue({brand_model:void 0}),g(m[a.getFieldValue("brand")])},O=()=>{a.validateFields().then(async s=>{const V={sn:s.sn,user_id:s.user,brand_id:i[s.brand],brand_model_id:f[`${i[s.brand]} ${s.brand_model}`],cp_address:t?.cp_address,latlng:`${t?.lat}, ${t?.lng}`,cp_suburb:t?.cp_suburb,cp_state:t?.cp_state,cp_postcode:t?.cp_postcode,cp_country:t?.cp_country},x=await y.add(V);x?.code===200&&(v.success(x.message),j(),o())}).catch(s=>{})};return l.useEffect(()=>{d||(u(null),a.setFieldsValue({brand_model:void 0}),a.setFieldsValue({sn:""}),a.setFieldsValue({brand:""}),a.setFieldsValue({user:""}))},[d]),e.jsx(I,{title:"Bind User and Charge Point",open:d,okText:"Confirm",width:640,cancelText:"Cancel",onCancel:o,footer:[e.jsxs("div",{className:"footer-normal-btns",children:[e.jsx(c,{onClick:o,children:"Cancel"},"cancel"),e.jsx(c,{type:"primary",onClick:O,children:"Add"},"confirm")]},"add-cp-footer")],children:e.jsx("div",{className:"modal-form",children:e.jsxs(r,{form:a,layout:"vertical",children:[e.jsx(r.Item,{name:"sn",label:"SN",rules:[{required:!0,message:"SN"}],children:e.jsx(k,{placeholder:"Input SN"})}),e.jsxs("div",{className:"two-column",children:[e.jsx(r.Item,{name:"brand",label:"Brand",rules:[{required:!0,message:"Brand"}],children:e.jsx(n,{onChange:M,placeholder:"select",children:Object.keys(m).map(s=>e.jsx(n.Option,{value:s,children:s},s))})}),e.jsx(r.Item,{name:"brand_model",label:"Brand Model",rules:[{required:!0,message:"Brand Model"}],children:e.jsx(n,{children:h&&h.map(s=>e.jsx(n.Option,{value:s,children:s},s))})})]}),e.jsxs("div",{className:"two-column",children:[e.jsx(r.Item,{name:"user",label:"User",rules:[{required:!0,message:"User"}],children:e.jsx(n,{placeholder:"User",children:b.map(s=>e.jsx(N,{value:s.user_id,children:s.name},s.user_id))})}),e.jsx(r.Item,{name:"empty",label:"",children:e.jsx("span",{})})]}),e.jsxs(r.Item,{name:"location",label:"location",rules:[{required:!0,message:"Location"}],children:[e.jsx(c,{onClick:S,children:t?t.cp_address:"Open Location Picker"}),e.jsx(B,{visible:_,onClose:C,onSelect:F})]})]})})})}export{H as default};

import{j as e,S as j}from"./index-B4s8r8l3.js";import{r as d}from"./vendor-react-BcJS7s_i.js";import{c as A}from"./cpMonitorService-BQOIE-hr.js";import{E as D,i as u,x as h,j as E,H as w,O as C,s as S}from"./vendor-antd-B62eGpCx.js";import"./vendor-ui-DPkccqlC.js";import"./vendor-utils-CtEfXJzW.js";function V({visible:l,onCancel:p,connector:m,onConfirm:_}){const[o,s]=d.useState([{limit:"",startAfter:"",time:0}]),[g,v]=d.useState(),[f,x]=d.useState("current");d.useEffect(()=>{l||s([{limit:"",startAfter:"",time:0}])},[l]);const P=()=>{s([...o,{limit:"",startAfter:"",time:Date.now()}])},y=t=>{const a=o.filter((r,n)=>n!==t);s([...a])},I=(t,a)=>{const r=[...o],n=r.map((c,i)=>i===t?{...r[t]||{limit:"",startAfter:"",time:Date.now()},limit:a}:c);s(n)},N=(t,a)=>{const r=[...o],n=r.map((c,i)=>i===t?{...r[t]||{limit:"",startAfter:"",time:Date.now()},startAfter:a}:c);s(n)},R=t=>{x(t),s([{limit:"",startAfter:"",time:Date.now()}])},k=async()=>{let t=!0;const a=o.map(i=>((i.limit===""||i.startAfter==="")&&(t=!1),{limit:i.limit,startPeriod:i.startAfter}));if(!t||a.length===0){S.error("Please Input Limit and Start After");return}let r={charge_point_id:m.charge_point_id,connector_id:m.connector_id,transaction_id:g};r={...r,cs_charging_profiles:{chargingProfileId:1,transaction_id:g,stackLevel:2,chargingProfilePurpose:"TxProfile",chargingProfileKind:"Relative",chargingSchedule:{chargingRateUnit:f==="current"?"A":"B",chargingSchedulePeriod:a}}};const n=[r],c=await A.setChargingProfile({charge_profiles:n});c?.code===200&&(S.success(c.message),_())},b=async()=>{const t=await A.getRealtimeInfo(m.charge_point_id,{connector_id:m.connector_id,action:"MeterValues"});v(t.detail.transaction_id)};return d.useEffect(()=>{l&&(s([{limit:"",startAfter:"",time:Date.now()}]),x("current"),b())},[l]),e.jsx(D,{title:"Set Charge Profile",open:l,onCancel:p,zIndex:1001,footer:[e.jsxs("div",{className:"footer-normal-btns",children:[e.jsx(u,{onClick:p,children:"Cancel"},"cancel"),e.jsx(u,{type:"primary",onClick:k,children:"Confirm"},"confirm")]},"set-charge-footer")],width:500,children:e.jsxs("div",{className:"modal-form one-column",children:[e.jsx("div",{className:"between-wrapper",children:e.jsx("div",{className:"title",children:m?.name})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"between-wrapper",children:[e.jsxs(h.Group,{optionType:"button",value:f,onChange:t=>R(t.target.value),className:"my-4",children:[e.jsx(h.Button,{value:"current",children:"Current"}),e.jsx(h.Button,{value:"power",children:"Power"})]}),e.jsx(u,{type:"link",icon:e.jsx(j,{icon:"Add",size:"28"}),onClick:()=>P()})]}),e.jsx(E,{children:o.map((t,a)=>e.jsxs("div",{className:"advance-start-row",children:[e.jsx("div",{className:"close-row",children:e.jsx(u,{type:"link",onClick:()=>y(a),icon:e.jsx(j,{icon:"Close",size:"20",color:"#C3C3C3"})})}),e.jsxs("div",{className:"label-value-split ",children:[e.jsx(w.Item,{name:"limit",label:"Limit",rules:[{required:!0,message:f==="current"?"Current limit":"Power limit"}],children:e.jsx(C,{min:1,max:1e5,defaultValue:t.limit,placeholder:f==="current"?"Current limit":"Power limit",onChange:r=>I(a,r)})}),e.jsx(w.Item,{name:"startAfter",label:"Start After(Minutes)",rules:[{required:!0,message:"Start After"}],children:e.jsx(C,{min:1,max:1e5,placeholder:"Start After",defaultValue:t.startAfter,onChange:r=>N(a,r)})})]},a)]},`setting-${t.time}`))})]})]})})}export{V as default};

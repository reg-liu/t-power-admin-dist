import{j as e,S as A}from"./index-BLO2Apo4.js";import{r as l}from"./vendor-react-DcqtUZ_G.js";import{s as z}from"./scheduleService-f9s_T6qb.js";import{d as x,b as K,r as G}from"./options-DHqL16EA.js";import{H as s,E as Q,i as f,w as i,$ as b,o as J,x as _,j as U,Q as y,s as k}from"./vendor-antd-BiNc4BQP.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DcB4TerO.js";function ne({visible:g,chargePoints:v,onCancel:w,onConfirm:I}){const[m]=s.useForm(),[D,C]=l.useState(!1),[p,P]=l.useState(!1),[o,c]=l.useState([{limit:"",startAfter:"",time:0}]),[j,M]=l.useState("current"),[O,S]=l.useState(!1),[T,Y]=l.useState(null),[X,q]=l.useState(95),[u,N]=l.useState("charge_mode"),[E,F]=l.useState([x[0]]),R=()=>{S(!0),c([...o,{limit:"",startAfter:"",time:Date.now()}])},V=t=>{P(t)},B=t=>{M(t),c([{limit:"",startAfter:"",time:Date.now()}])},H=t=>{const a=o.filter((r,n)=>n!==t);c([...a])},L=(t,a)=>{const r=[...o],n=r.map((h,d)=>d===t?{...r[t]||{limit:"",startAfter:"",time:Date.now()},limit:a}:h);c(n)},W=(t,a)=>{const r=[...o],n=r.map((h,d)=>d===t?{...r[t]||{limit:"",startAfter:"",time:Date.now()},startAfter:a}:h);c(n)},$=async()=>{let t=!0;const a=p?o.map(r=>((r.limit===""||r.startAfter==="")&&(t=!1),{limit:r.limit,startPeriod:r.startAfter*60})):[];if(p&&(!t||a.length===0)){k.error("Please Input Limit and Start After");return}m.validateFields().then(async r=>{let n={charge_point_id:T.id,connector_id:r.connector_id,mode:u==="charge_mode"?"default":"v2g",ocpp_charging_schedule_period:a};n={...n,smart_charge:!0,profile_start_datetime:new Date(r.start_time).toISOString(),profile_end_datetime:new Date(r.end_time).toISOString(),ocpp_charging_profile_id:1,ocpp_stack_level:2,ocpp_charging_profile_purpose:"TxProfile",ocpp_charging_profile_kind:"Relative",ocpp_charging_rate_unit:j==="current"?"A":"B",ocpp_recurrency_kind:r.repeat_kind||"None"},C(!0);const h=n,d=await z.add({...h});C(!1),d?.code===200&&(k.success(d.message),I())})};return l.useEffect(()=>{g||(m.resetFields(),c([{limit:"",startAfter:"",time:0}]))},[g]),e.jsx(Q,{title:"Add Schedule",open:g,onCancel:w,footer:[e.jsxs("div",{className:"footer-normal-btns",children:[e.jsx(f,{onClick:w,children:"Cancel"},"cancel"),e.jsx(f,{type:"primary",loading:D,onClick:$,children:"Add"},"confirm")]},"add-schedule-footer")],children:e.jsx("div",{className:`modal-form ${u}_form`,children:e.jsxs(s,{form:m,layout:"vertical",children:[e.jsx(s.Item,{name:"charge_point_id",label:"Charge Point",rules:[{required:!0}],children:e.jsx(i,{className:"w-full",allowClear:!0,onChange:t=>{const a=v.find(r=>r.id_tag===t);Y(a),S(a?.v2g_support||!1),q(95),m.setFieldValue("connector_id",""),m.setFieldValue("mode","charge_mode"),N("charge_mode"),F(a?.connector_no===2?x:[x[0]])},placeholder:"Select",children:v.map(t=>e.jsx(i.Option,{value:t.id_tag,children:t.id_tag},t.id_tag))})}),e.jsxs("div",{className:"two-column",children:[e.jsx(s.Item,{name:"connector_id",label:"Connector",rules:[{required:!0}],children:e.jsx(i,{className:"w-full",allowClear:!0,placeholder:"Select",children:E.map(t=>e.jsx(i.Option,{value:t.value,children:t.label},t.value))})}),e.jsx(s.Item,{label:""})]}),e.jsxs("div",{className:"two-column",children:[e.jsx(s.Item,{name:"mode",label:"Energy Mode",rules:[{required:!0}],children:O?e.jsx(i,{placeholder:"Select",value:u,style:{width:"100%"},onChange:t=>N(t),children:K.map(t=>e.jsx(i.Option,{value:t.value,children:e.jsx("span",{className:t.value,children:t.label})},t.value))}):e.jsx("div",{className:"form-status charge_mode",children:"Charge Mode"})}),e.jsx(s.Item,{label:""})]}),e.jsxs("div",{className:"two-column",children:[e.jsx(s.Item,{name:"start_time",label:"Start Time",rules:[{required:!0}],children:e.jsx(b,{showTime:!0,format:"YYYY-MM-DD HH:mm"})}),e.jsx(s.Item,{name:"end_time",label:"End Time",rules:[{required:!0}],children:e.jsx(b,{showTime:!0,format:"YYYY-MM-DD HH:mm"})})]}),e.jsxs("div",{className:"two-column",children:[e.jsx(s.Item,{name:"repeat_kind",label:"Repeat Kind",children:e.jsx(i,{defaultValue:"No",allowClear:!0,children:G.map(t=>e.jsx(i.Option,{value:t.value,children:t.label},t.value))})}),e.jsx(s.Item,{label:""})]}),e.jsxs("div",{className:"between-wrapper mt-2",children:[e.jsx("span",{}),e.jsxs("div",{className:"switch",children:["With Profile",e.jsx(J,{checked:p,onChange:V})]})]}),p&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"between-wrapper",children:[e.jsxs(_.Group,{optionType:"button",value:j,onChange:t=>B(t.target.value),className:"my-4",children:[e.jsx(_.Button,{value:"current",children:"Current"}),e.jsx(_.Button,{value:"power",children:"Power"})]}),e.jsx(f,{type:"link",icon:e.jsx(A,{icon:u==="discharge_mode"?"Add2":"Add",color:u==="discharge_mode"?"#1B6EF3":"currentColor",size:"28"}),onClick:()=>R()})]}),e.jsx(U,{children:o.map((t,a)=>e.jsxs("div",{className:"advance-start-row",children:[e.jsx("div",{className:"close-row",children:e.jsx(f,{type:"link",onClick:()=>H(a),icon:e.jsx(A,{icon:"Close",size:"20",color:"#C3C3C3"})})}),e.jsxs("div",{className:"label-value-split ",children:[e.jsxs("div",{className:"mock-column",children:[e.jsx("div",{className:"required label",children:"Limit(W)"}),e.jsx(y,{min:1,max:1e5,value:t.limit,placeholder:j==="current"?"Current limit":"Power limit",onChange:r=>L(a,r)})]}),e.jsxs("div",{className:"mock-column",children:[e.jsx("div",{className:"required label",children:"Duration(Minutes)"}),e.jsx(y,{min:1,max:1e5,placeholder:"Input",value:t.startAfter,onChange:r=>W(a,r)})]})]},a)]},`setting-${t.time}`))})]})]})})})}export{ne as default};

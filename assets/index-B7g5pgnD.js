import{j as s,S as m}from"./index-x526v5wV.js";import{K as ee,w as h,i as r,J as se,P as S,F as te,z as ae,s as ne,O as l}from"./vendor-antd-BiNc4BQP.js";import{r as a}from"./vendor-react-DcqtUZ_G.js";import{c as C}from"./commonService-jucT3H--.js";import{c as oe}from"./cpBrandModelService-BVeKS8m6.js";import{h as re}from"./historyService-DLIhqdnX.js";import{e as ie}from"./options-MDMYukvs.js";import le from"./addChargingSchedule-e86AknnG.js";import ce from"./detail-DkYz4IhG.js";import de from"./editChargingSchedule-Cp1eaU3S.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DcB4TerO.js";import"./cpMonitorService-B1l_pe55.js";function we(){const[v,u]=a.useState(!1),[w,p]=a.useState(!1),[c,D]=a.useState([]),[M,x]=a.useState(!1),[j,g]=a.useState(null),[n,o]=a.useState({}),[b,i]=a.useState(0),[k,N]=a.useState([]),[Y,I]=a.useState([]),[E,y]=a.useState(!1),[P,H]=a.useState(0),A=[{title:"Charge Point",dataIndex:"id_tag",key:"id_tag",render:(e,t)=>s.jsx(r,{type:"link",onClick:()=>R(t),children:e})},{title:"Scheduled Time",dataIndex:"scheduled_time",key:"scheduled_time"},{title:"Energy Mode",dataIndex:"session_mode",key:"session_mode",render:e=>s.jsx("span",{className:e==="Discharge"?"discharge_mode":"charge_mode",children:e})},{title:"Duration",dataIndex:"duration",key:"duration"},{title:"Repeat Kind",dataIndex:"repeat_kind",key:"repeat_kind"},{title:"Operation",width:"140px",key:"operation",render:(e,t)=>s.jsx("div",{className:"operations",children:s.jsx(S,{title:"Confirm delete?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>{_(t.id)},children:s.jsx(r,{type:"link",danger:!0,icon:s.jsx(m,{icon:"Delete",size:"20"}),children:"Delete"})})})}],T=()=>{u(!0)},K=e=>{g(e),p(!0)},R=e=>{g(e),x(!0)},$=e=>{D(e)},O=()=>{const e={...n};delete e.page,o(e),i(Date.now())},V=e=>{o({...n,page:e}),i(Date.now())},z=()=>{o({}),i(Date.now())},L=async()=>{const{detail:e}=await C.getUsers({num:100});N(e.results.map(t=>({name:`${t.first_name} ${t.last_name}`,phone:t.phone,email:t.email,user_id:t.user_id})))},U=e=>e.map((t,d)=>{const f=parseFloat(t.duration),B=Math.floor(f/3600),J=Math.floor(f%3600/60),Q=Math.floor(f%60),{id:W,first_name:G,last_name:X}=t,Z=l().startOf("day").add(B,"hour").add(J,"minute").add(Q,"second").format("HH:mm:ss");return{...t,key:W,user:`${G} ${X}`,repeat_kind:d%2===0?"Daily":"Weekly",session_mode:d%2===0?"Charge":"Discharge",duration:Z,start_time:l(t.cs_start_datetime).format("YYYY-MM-DD HH:mm:ss"),end_time:l(t.cs_end_datetime).format("YYYY-MM-DD HH:mm:ss"),scheduled_time:`${l(t.cs_start_datetime).format("YYYY-MM-DD HH:mm:ss")} - ${l(t.cs_end_datetime).format("YYYY-MM-DD HH:mm:ss")}`}}),F=async()=>{y(!0);const e=await re.queryAll(n),{results:t,count:d}=e.detail;I(U(t||[])),H(d),y(!1)},q=()=>c.map(e=>e.split(C.rowKeySplit)[0]),_=async e=>{try{const t=await oe.del({brand_model_ids:e?[e]:q()});t?.code===200&&(ne.success(t.message),i(Date.now()))}catch{}};return a.useEffect(()=>{F()},[b]),a.useEffect(()=>{L(),i(Date.now())},[]),s.jsxs("div",{className:"main-content",children:[s.jsxs("div",{className:"search-area flex items-center justify-start",children:[s.jsxs("div",{className:"search-item",children:[s.jsx("div",{className:"label mb-2",children:"Charge Point"}),s.jsx(ee,{className:"w-full",placeholder:"Enter",onChange:e=>{o({...n,id_tag:e.target.value})}})]}),s.jsxs("div",{className:"search-item",children:[s.jsx("div",{className:"label",children:"User"}),s.jsx(h,{className:"w-full",allowClear:!0,value:n.user_id,style:{width:"150px"},onChange:e=>{o({...n,user_id:e})},placeholder:"Select",children:k.map(e=>s.jsx(h.Option,{value:e.user_id,children:e.name},e.user_id))})]}),s.jsxs("div",{className:"search-item",children:[s.jsx("div",{className:"label",children:"Energy Mode"}),s.jsx(h,{placeholder:"Select",allowClear:!0,style:{width:"210px"},onChange:e=>{o({...n,session_mode:e})},children:ie.map(e=>s.jsx(h.Option,{value:e.value,children:e.label},e.value))})]}),s.jsx("div",{className:"search-btn",children:s.jsx(r,{icon:s.jsx(m,{icon:"Search",size:"20"}),type:"primary",loading:E,onClick:O})}),s.jsx("div",{className:"search-btn clear",children:s.jsx(r,{icon:s.jsx(m,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:z})})]}),s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"operation-area flex items-center justify-start",children:[s.jsx(r,{type:"primary",icon:s.jsx(se,{}),onClick:T,children:"Add Schedule"}),s.jsx(S,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm delete?",onConfirm:()=>{_()},children:s.jsx(r,{disabled:c.length===0,className:"ml-3",icon:s.jsx(m,{color:c.length===0?"#999":"currentColor",icon:"Stop",size:"20"}),children:"Bulk Delete"})})]})}),s.jsx(te,{columns:A,dataSource:Y,pagination:!1,rowKey:"key",rowSelection:{selectedRowKeys:c,onChange:$}}),s.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:s.jsx(ae,{total:P,showQuickJumper:!0,onChange:V})}),s.jsx(le,{visible:v,onCancel:()=>u(!1),onConfirm:()=>u(!1)}),s.jsx(de,{visible:w,onCancel:()=>p(!1),onConfirm:()=>p(!1),record:j}),s.jsx(ce,{visible:M,onCancel:()=>x(!1),record:j,onEdit:K})]})}export{we as default};

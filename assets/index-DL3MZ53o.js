import{e as de,j as e,S as p,I as D}from"./index-3_qVLhXE.js";import{r as t}from"./vendor-react-DcqtUZ_G.js";import{c as f}from"./commonService-BP-nhihU.js";import{c as P}from"./cpManagementService-CkXKFZnG.js";import{c as ie}from"./chargepoint-wPlJlVYc.js";import{c as me}from"./options-DHqL16EA.js";import he from"./addChargepoint-CeyB8Rw6.js";import pe from"./detail-DH-iPLXS.js";import{K as ue,w as c,i as o,x as y,P as C,F as xe,y as $,j as ge,I as je,z as _e,s as be}from"./vendor-antd-BiNc4BQP.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DcB4TerO.js";const{Option:z}=c;function Pe(){const[A,g]=t.useState(1),[n,x]=t.useState([]),[u,T]=t.useState([]),[R,E]=t.useState(0),[O,N]=t.useState(!1),[w,F]=t.useState("list"),[K,S]=t.useState(!1),[L,k]=t.useState(!1),[j,V]=t.useState("id_tag"),[l,d]=t.useState({page:1}),[q,i]=t.useState(0),[G,M]=t.useState(null),[_,U]=t.useState([]),[J,Q]=t.useState(null),[H,W]=t.useState(null),X=de(),Y=[{title:"Charge Point",dataIndex:"id_tag",key:"id_tag",className:"bold",render:(a,s)=>e.jsx(o,{type:"link",onClick:()=>I(s),children:a})},{title:"SN",dataIndex:"sn",key:"sn"},{title:"Brand",dataIndex:"brand",key:"brand"},{title:"Brand Model",dataIndex:"brand_model",key:"brand_model"},{title:"Charge Model",dataIndex:"charge_model",key:"charge_model"},{title:"Operation",width:"140px",key:"operation",render:(a,s)=>e.jsx("div",{className:"operations",children:e.jsx(C,{title:"Confirm delete?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>{b(s.id)},children:e.jsx(o,{type:"link",danger:!0,icon:e.jsx(p,{icon:"Delete",size:"20",color:"#FF4747"}),children:"Delete"})})})}],Z={selectedRowKeys:n,onChange:a=>{x(a)}},I=a=>{M(a),S(!0)},ee=e.jsxs(c,{value:j,onChange:V,style:{width:156},children:[e.jsx(z,{value:"id_tag",children:"Charge Point"}),e.jsx(z,{value:"sn",children:"SN"})]}),ae=()=>{n.length===u.length?x([]):x(u.map(a=>a.key))},se=()=>n.map(a=>a.split(f.rowKeySplit)[0]),b=async a=>{try{const s=await P.del({charge_point_ids:a?[a]:se()});s?.code===200&&(be.success(s.message),i(Date.now()))}catch{}},te=()=>{const a={...l};g(1),delete a.page,d(a),i(Date.now())},le=a=>{g(a),d({...l,page:a}),i(Date.now())},ne=async()=>{const{detail:a}=await f.getBrands({num:100}),s={},r={},m={};a.results.forEach(h=>{s[h.brand]=h.id;const B=[];h.chargepointbrandmodel_set&&h.chargepointbrandmodel_set.forEach(v=>{m[`${h.id} ${v.brand_model}`]=v.id,B.push(v.brand_model)}),r[h.brand]=B}),Q(s),W(m),U(r)},re=a=>a.map(s=>{const{id:r,sn:m}=s;return{id:r,sn:m,key:`${s.id}${f.rowKeySplit}${s.id_tag}`,id_tag:s.id_tag,brand:s.brand_model.brand,brand_model:s.brand_model.brand_model,charge_model:s.brand_model.charge_model,connector_no:s.brand_model.connector_no,ocpp:s.brand_model.ocpp,phase:s.brand_model.phase,picture:s.brand_model.picture,out_current_max:parseInt(`${s.brand_model.out_current_max}`,10),out_current_min:parseInt(`${s.brand_model.out_current_min}`,10),out_power_max:parseInt(`${s.brand_model.out_power_max}`,10),out_power_min:parseInt(`${s.brand_model.out_power_min}`,10),out_voltage_max:parseInt(`${s.brand_model.out_voltage_max}`,10),out_voltage_min:parseInt(`${s.brand_model.out_voltage_min}`,10),connector_type:s.brand_model.charge_model==="AC"?"ac - type2":"dc - ccs2"}}),oe=()=>{d({}),g(1),i(Date.now())},ce=async()=>{N(!0);const a=await P.queryAll(l),{results:s,count:r}=a.detail;T(re(s||[])),E(r),N(!1)};return t.useEffect(()=>{ce()},[q]),t.useEffect(()=>{ne(),i(Date.now())},[]),e.jsxs("div",{className:"main-content",children:[e.jsxs("div",{className:"search-area flex items-center justify-start",children:[e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:" "}),e.jsx(ue,{addonBefore:ee,placeholder:"Enter",allowClear:!0,value:l[j],style:{width:"360px"},onChange:a=>{let s={...l};delete s.id_tag,delete s.sn,s={...s,[j]:a.target.value},d(s)}})]}),e.jsxs("div",{className:"search-item ",children:[e.jsx("div",{className:"label",children:"Brand"}),e.jsx(c,{placeholder:"Select",allowClear:!0,className:"w-full",style:{width:"150px"},value:l.brand,onChange:a=>d({...l,brand:a,brand_model:""}),children:Object.keys(_).map(a=>e.jsx(c.Option,{value:a,children:a},a))})]}),e.jsxs("div",{className:"search-item ",children:[e.jsx("div",{className:"label",children:"Brand Model"}),e.jsx(c,{value:l.brand_model,placeholder:"Select",disabled:!l.brand,allowClear:!0,style:{width:"160px"},className:"w-full",onChange:a=>d({...l,brand_model:a}),children:l.brand&&_[l.brand].map(a=>e.jsx(c.Option,{value:a,children:a},a))})]}),e.jsxs("div",{className:"search-item ",children:[e.jsx("div",{className:"label",children:"Charge Model"}),e.jsx(c,{style:{width:"160px"},value:l.charge_model,allowClear:!0,placeholder:"Select",className:"w-full",onChange:a=>d({...l,charge_model:a}),children:me.map(a=>e.jsx(c.Option,{value:a,children:a},a))})]}),e.jsx("div",{className:"search-btn",children:e.jsx(o,{icon:e.jsx(p,{icon:"Search",size:"20"}),type:"primary",loading:O,onClick:te})}),e.jsx("div",{className:"search-btn clear",children:e.jsx(o,{icon:e.jsx(p,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:oe})})]}),e.jsxs("div",{className:"operation-area flex items-center justify-start",children:[e.jsxs(y.Group,{className:"layout-switch",value:w,onChange:a=>F(a.target.value),children:[e.jsx(y.Button,{value:"list",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(D,{icon:"mynaui:list",size:20}),"List"]})}),e.jsx(y.Button,{value:"grid",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(D,{icon:"proicons:grid",size:20}),"Grid"]})})]}),e.jsx(o,{className:"ml-3 mr-3",type:"primary",icon:e.jsx(p,{icon:"Add",size:"20"}),onClick:()=>k(!0),children:"Add Charge Point"}),e.jsx(C,{title:"Confirm delete?",onConfirm:()=>{b()},placement:"bottom",okText:"Confirm",cancelText:"Cancel",children:e.jsx(o,{disabled:n.length===0,danger:!0,icon:e.jsx(p,{icon:"Delete",size:"20",color:n.length===0?"#999":"currentColor"}),children:"Bulk Delete"})})]}),w==="list"?e.jsx(xe,{bordered:!0,rowSelection:Z,columns:Y,dataSource:u,pagination:!1}):e.jsxs("div",{className:"grid-wrapper",children:[e.jsx($,{className:"check-all",checked:u.length===n.length,onChange:ae}),e.jsx("div",{className:"grid",children:u.map(a=>e.jsx("div",{className:"grid-item",children:e.jsxs(ge,{hoverable:!0,className:"flex flex-col",children:[e.jsxs("div",{className:"grid-top with-image flex items-center",children:[e.jsx($,{checked:n.includes(a.id),onChange:s=>{const r=s.target.checked?[...n,a.id]:n.filter(m=>m!==a.id);x(r)}}),e.jsx(je,{src:a.picture||ie,preview:!1,height:184,className:"entity-image object-cover"})]}),e.jsxs("div",{className:"grid-bottom",children:[e.jsx("div",{className:"display-item",children:e.jsx(o,{type:"link",className:"detail-link",onClick:()=>{I(a)},children:a.id_tag})}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"SN:"})," ",e.jsx("span",{className:"value",children:a.sn})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand:"})," ",e.jsx("span",{className:"value",children:a.brand})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand Model:"})," ",e.jsx("span",{className:"value",children:a.brand_model})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Charge Model:"})," ",e.jsx("span",{className:"value",children:a.charge_model.toUpperCase()})]}),e.jsx("div",{className:"operation-rows",children:e.jsx(C,{title:"Confirm delete?",onConfirm:()=>{b(a.id)},placement:"bottom",okText:"Confirm",cancelText:"Cancel",children:e.jsx(o,{type:"link",danger:!0,icon:e.jsx(p,{icon:"Delete",size:"20",color:"#FF4747"}),children:"Delete"})})})]})]},a.id)}))})]}),e.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:e.jsx(_e,{total:R,current:A,showSizeChanger:!1,showQuickJumper:!0,onChange:le})}),e.jsx(pe,{visible:K,onClose:()=>S(!1),onDelete:()=>{i(Date.now())},record:G,isAdmin:X}),e.jsx(he,{visible:L,onClose:()=>k(!1),brandModels:_,brandMap:J,branModelMap:H,onSave:()=>{i(Date.now()),M(null)}})]})}export{Pe as default};

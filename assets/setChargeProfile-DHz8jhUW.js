import{j as e,S as x}from"./index-D-fi11Kk.js";import{r as f}from"./vendor-react-BcJS7s_i.js";import{c as j}from"./cpMonitorService-CG2IYLp4.js";import{E as k,i as u,x as h,j as b,H as A,O as w,s as C}from"./vendor-antd-B62eGpCx.js";import"./vendor-ui-DPkccqlC.js";import"./vendor-utils-CtEfXJzW.js";function O({visible:l,onCancel:p,connector:m,onConfirm:v}){const[o,s]=f.useState([{limit:"",startAfter:"",time:0}]),[d,g]=f.useState("current");f.useEffect(()=>{l||s([{limit:"",startAfter:"",time:0}])},[l]);const S=()=>{s([...o,{limit:"",startAfter:"",time:Date.now()}])},_=t=>{const a=o.filter((r,n)=>n!==t);s([...a])},P=(t,a)=>{const r=[...o],n=r.map((c,i)=>i===t?{...r[t]||{limit:"",startAfter:"",time:Date.now()},limit:a}:c);s(n)},y=(t,a)=>{const r=[...o],n=r.map((c,i)=>i===t?{...r[t]||{limit:"",startAfter:"",time:Date.now()},startAfter:a}:c);s(n)},N=t=>{g(t),s([{limit:"",startAfter:"",time:Date.now()}])},I=async()=>{let t=!0;const a=o.map(i=>((i.limit===""||i.startAfter==="")&&(t=!1),{limit:i.limit,startPeriod:i.startAfter}));if(!t||a.length===0){C.error("Please Input Limit and Start After");return}let r={charge_point_id:m.charge_point_id,connector_id:m.connector_id,transaction_id:16510572};r={...r,cs_charging_profiles:{chargingProfileId:1,transaction_id:16510572,stackLevel:2,chargingProfilePurpose:"TxProfile",chargingProfileKind:"Relative",chargingSchedule:{chargingRateUnit:d==="current"?"A":"B",chargingSchedulePeriod:a}}};const n=[r],c=await j.start({charge_profiles:n});c?.code===200&&(C.success(c.message),v())},R=async()=>{(await j.getRealtimeInfo(m.charge_point_id,{connector_id:m.connector_id,action:"MeterValues"}))?.code};return f.useEffect(()=>{l&&(s([{limit:"",startAfter:"",time:Date.now()}]),g("current"),R())},[l]),e.jsx(k,{title:"Set Charge Profile",open:l,onCancel:p,zIndex:1001,footer:[e.jsxs("div",{className:"footer-normal-btns",children:[e.jsx(u,{onClick:p,children:"Cancel"},"cancel"),e.jsx(u,{type:"primary",onClick:I,children:"Confirm"},"confirm")]},"set-charge-footer")],width:500,children:e.jsxs("div",{className:"modal-form one-column",children:[e.jsx("div",{className:"between-wrapper",children:e.jsx("div",{className:"title",children:m?.name})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"between-wrapper",children:[e.jsxs(h.Group,{optionType:"button",value:d,onChange:t=>N(t.target.value),className:"my-4",children:[e.jsx(h.Button,{value:"current",children:"Current"}),e.jsx(h.Button,{value:"power",children:"Power"})]}),e.jsx(u,{type:"link",icon:e.jsx(x,{icon:"Add",size:"28"}),onClick:()=>S()})]}),e.jsx(b,{children:o.map((t,a)=>e.jsxs("div",{className:"advance-start-row",children:[e.jsx("div",{className:"close-row",children:e.jsx(u,{type:"link",onClick:()=>_(a),icon:e.jsx(x,{icon:"Close",size:"20",color:"#C3C3C3"})})}),e.jsxs("div",{className:"label-value-split ",children:[e.jsx(A.Item,{name:"limit",label:"Limit",rules:[{required:!0,message:d==="current"?"Current limit":"Power limit"}],children:e.jsx(w,{min:1,max:1e5,defaultValue:t.limit,placeholder:d==="current"?"Current limit":"Power limit",onChange:r=>P(a,r)})}),e.jsx(A.Item,{name:"startAfter",label:"Start After(Minutes)",rules:[{required:!0,message:"Start After"}],children:e.jsx(w,{min:1,max:1e5,placeholder:"Start After",defaultValue:t.startAfter,onChange:r=>y(a,r)})})]},a)]},`setting-${t.time}`))})]})]})})}export{O as default};

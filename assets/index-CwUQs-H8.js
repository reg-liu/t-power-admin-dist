import{g as x,j as e,S as d}from"./index-BQ55rnNs.js";import{K as H,w as l,i as c,F as $,z as F,a1 as L,s as O,O as m}from"./vendor-antd-DmtkV1Ch.js";import{r as n}from"./vendor-react-BcJS7s_i.js";import{c as R}from"./commonService-DWT_OFPi.js";import{e as U}from"./options-BdxPQc9L.js";import"./vendor-ui-DPkccqlC.js";import"./vendor-utils-BKiv1F2M.js";const z=t=>x.get({url:"/charge-sessions/",params:t}),A=t=>x.post({url:"/statements/",data:t}),h={queryAll:z,download:A},{RangePicker:q}=L,{Option:K}=l;function Z(){const[t,o]=n.useState({}),[p,i]=n.useState(0),[y,f]=n.useState([]),[j,_]=n.useState([]),[g,u]=n.useState(!1),[v,w]=n.useState(0),C=()=>{i(Date.now())},S=[{title:"Record ID",dataIndex:"id",key:"id"},{title:"Charge Point",dataIndex:"id_tag",key:"id_tag"},{title:"Start Time",dataIndex:"start_time",key:"start_time"},{title:"End Time",dataIndex:"end_time",key:"end_time"},{title:"Duration",dataIndex:"duration",key:"duration"},{title:"Energy Type",dataIndex:"session_mode",key:"session_mode"},{title:"Amount(kWh)",dataIndex:"amount",key:"amount"},{title:"User",dataIndex:"user",key:"user"}],D=s=>{o({...t,page:s}),i(Date.now())},N=()=>{o({}),i(Date.now())},k=async()=>{const{detail:s}=await R.getUsers({num:100});f(s.results.map(a=>({name:`${a.first_name} ${a.last_name}`,phone:a.phone,email:a.email,user_id:a.user_id})))},b=async()=>{const s=await h.download({start_date:t.start_date,end_date:t.end_date});if(s.code===200&&(O.success(s.message),s.detail.url)){const a=document.createElement("a");a.download="",a.style.display="none",a.href=s.detail.url,document.body.appendChild(a),a.click(),document.body.removeChild(a)}},Y=s=>s.map(a=>{const r=parseFloat(a.duration),M=Math.floor(r/3600),E=Math.floor(r%3600/60),P=Math.floor(r%60),T=m().startOf("day").add(M,"hour").add(E,"minute").add(P,"second").format("HH:mm:ss");return{...a,amount:a.cs_energy,user:`${a.user_firstname} ${a.user_lastname}`,session_mode:a.session_mode===1?"Charge":"Discharge",duration:T,start_time:m(a.cs_start_datetime).format("YYYY-MM-DD HH:mm:ss"),end_time:m(a.cs_end_datetime).format("YYYY-MM-DD HH:mm:ss")}}),I=async()=>{u(!0);const s=await h.queryAll(t),{results:a,count:r}=s.detail;_(Y(a||[])),w(r),u(!1)};return n.useEffect(()=>{I()},[p]),n.useEffect(()=>{k(),i(Date.now())},[]),e.jsxs("div",{className:"main-content",children:[e.jsxs("div",{className:"search-area flex items-center justify-start",children:[e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label mb-2",children:"Time Range"}),e.jsx(q,{className:"w-full",format:"YYYY-MM-DD",onChange:(s,[a,r])=>{o({...t,start_date:a,end_date:r})}})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label mb-2",children:"Charge Point"}),e.jsx(H,{className:"w-full",placeholder:"Enter",onChange:s=>{o({...t,id_tag:s.target.value})}})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Energy Type"}),e.jsx(l,{placeholder:"Select",allowClear:!0,style:{width:"210px"},onChange:s=>o({...t,energe_type:s}),children:U.map(s=>e.jsx(l.Option,{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"User"}),e.jsx(l,{className:"w-full",allowClear:!0,value:t.user_id,style:{width:"150px"},onChange:s=>{o({...t,user_id:s})},placeholder:"Select",children:y.map(s=>e.jsx(K,{value:s.user_id,children:s.name},s.user_id))})]}),e.jsx("div",{className:"search-btn",children:e.jsx(c,{icon:e.jsx(d,{icon:"Search",size:"20"}),type:"primary",loading:g,onClick:C})}),e.jsx("div",{className:"search-btn clear",children:e.jsx(c,{icon:e.jsx(d,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:N})})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"operation-area flex items-center justify-start",children:[e.jsx("span",{className:"mr-4 font-bold",children:"Charge Point Record"}),e.jsx(c,{type:"primary",icon:e.jsx(d,{icon:"Download",size:"20",color:"#FF4747"}),onClick:b,children:"Download"})]})}),e.jsx($,{columns:S,bordered:!0,rowKey:"id",pagination:!1,dataSource:j}),e.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:e.jsx(F,{total:v,showQuickJumper:!0,onChange:D})})]})}export{Z as default};

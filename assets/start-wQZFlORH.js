import{j as e,S as u}from"./index-PVkWanS8.js";import{r as n}from"./vendor-react-BcJS7s_i.js";import{c as z}from"./cpMonitorService-Dy5_0UUe.js";import{E as G,i as f,k as N,Q as j,o as T,x as v,j as B,H as P,s as w}from"./vendor-antd-DmtkV1Ch.js";import"./vendor-ui-DPkccqlC.js";import"./vendor-utils-BKiv1F2M.js";function Q({visible:m,onCancel:A,connector:r,onConfirm:y}){const[g,_]=n.useState(!1),[x,b]=n.useState(),[k,S]=n.useState("Advanced Start"),[c,l]=n.useState([{limit:"",startAfter:"",time:0}]),[h,C]=n.useState("current");n.useEffect(()=>{m||l([{limit:"",startAfter:"",time:0}])},[m]);const I=()=>{l([...c,{limit:"",startAfter:"",time:Date.now()}])},M=t=>{const a=c.filter((s,i)=>i!==t);l([...a])},V=(t,a)=>{const s=[...c],i=s.map((d,o)=>o===t?{...s[t]||{limit:"",startAfter:"",time:Date.now()},limit:a}:d);l(i)},D=(t,a)=>{const s=[...c],i=s.map((d,o)=>o===t?{...s[t]||{limit:"",startAfter:"",time:Date.now()},startAfter:a}:d);l(i)},E=t=>{_(t)},L=t=>{C(t),l([{limit:"",startAfter:"",time:Date.now()}])},R=async()=>{if(r.v2g_support==="V2G"&&!x){w.error("Please Enter Soc");return}let t=!0;const a=c.map(p=>((p.limit===""||p.startAfter==="")&&(t=!1),{limit:p.limit,startPeriod:p.startAfter*60}));let s={max:.92};r.v2g_support==="V2G"&&(s=r?.charge_mode==="charge_mode"?{max:(x||0)/100}:{min:(x||0)/100});let i={charge_point_id:r.charge_point_id,connector_id:r.connector_id,mode:r?.charge_mode==="charge_mode"?"default":"v2g",soc:s};if(g){if(!t||a.length===0){w.error("Please Input Limit and Start After");return}i={...i,mode:"default",charging_profile:{chargingProfileId:1,chargingProfileKind:"Relative",chargingProfilePurpose:"TxProfile",stackLevel:1,chargingSchedule:{chargingRateUnit:h==="current"?"A":"B",chargingSchedulePeriod:a}}}}const d=[i],o=await z.start({cp_id_connector_pairs:d});o?.code===200&&(w.success(o.message),y())};return n.useEffect(()=>{m&&(l([{limit:"",startAfter:"",time:Date.now()}]),_(!1),C("current"),r?.v2g_support==="V2G"&&(r?.charge_mode==="charge_mode"?S("Advanced Charge"):S("Advanced Discharge")))},[m,r]),e.jsx(G,{title:k,open:m,onCancel:A,zIndex:1001,footer:[e.jsxs("div",{className:"footer-normal-btns",children:[e.jsx(f,{onClick:A,children:"Cancel"},"cancel"),e.jsx(f,{type:"primary",onClick:R,children:"Start"},"confirm")]},"start-footer")],width:500,children:e.jsxs("div",{className:"modal-form one-column start-form",children:[e.jsx("div",{className:"between-wrapper",children:e.jsx("div",{className:"title",children:r?.name})}),r?.v2g_support==="V2G"&&e.jsxs("div",{className:"soc-wrapper label-value-split mt-2",children:[e.jsx("label",{children:r?.charge_mode==="charge_mode"?e.jsxs("div",{className:"icon-label",children:[e.jsx("span",{children:"Max Soc(%)"}),e.jsx(N,{title:"Maximum Charge Limit Is 95%",placement:"top",children:e.jsx("span",{className:"svg-wrapper",children:e.jsx(u,{className:"ml-1",icon:"Help",size:"20"})})})]}):e.jsxs("div",{className:"icon-label",children:[e.jsx("span",{children:"Min Soc(%)"}),e.jsx(N,{title:"Minimum Discharge Limit Is 20%",placement:"top",children:e.jsx("span",{children:e.jsx(u,{className:"ml-1",icon:"Help",size:"20"})})})]})}),e.jsx(j,{min:r?.charge_mode==="charge_mode"?1:20,max:r?.charge_mode==="charge_mode"?95:1e4,placeholder:"Enter",onChange:t=>b(t)})]}),e.jsxs("div",{className:"between-wrapper mt-2",children:[e.jsx("span",{}),e.jsxs("div",{className:"switch",children:["With Charge Profile",e.jsx(T,{checked:g,onChange:E})]})]}),e.jsxs("div",{className:g?"mt-4":"pointer-events-none mt-4 opacity-50",children:[e.jsxs("div",{className:"between-wrapper",children:[e.jsxs(v.Group,{optionType:"button",value:h,onChange:t=>L(t.target.value),className:"my-4",children:[e.jsx(v.Button,{value:"current",children:"Current"}),e.jsx(v.Button,{value:"power",children:"Power"})]}),e.jsx(f,{type:"link",icon:e.jsx(u,{icon:"Add",size:"28"}),onClick:()=>I()})]}),e.jsx(B,{children:c.map((t,a)=>e.jsxs("div",{className:"advance-start-row",children:[e.jsx("div",{className:"close-row",children:e.jsx(f,{type:"link",onClick:()=>M(a),icon:e.jsx(u,{icon:"Close",size:"20",color:"#C3C3C3"})})}),e.jsxs("div",{className:"label-value-split ",children:[e.jsx(P.Item,{name:"limit",label:"Limit",rules:[{required:!0,message:h==="current"?"Current limit":"Power limit"}],children:e.jsx(j,{min:1,max:1e5,defaultValue:t.limit,placeholder:h==="current"?"Current limit":"Power limit",onChange:s=>V(a,s)})}),e.jsx(P.Item,{name:"startAfter",label:"Start After(Minutes)",rules:[{required:!0,message:"Start After"}],children:e.jsx(j,{min:1,max:1e5,placeholder:"Start After",defaultValue:t.startAfter,onChange:s=>D(a,s)})})]},a)]},`setting-${t.time}`))})]})]})})}export{Q as default};

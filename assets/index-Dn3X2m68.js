import{j as e,S as d,f as Z}from"./index-DJRIS-tN.js";import{r as o}from"./vendor-react-DcqtUZ_G.js";import{c as S}from"./commonService-eK9Mlejw.js";import{c as B}from"./cpMonitorService-BYkV63oT.js";import{c as Ve}from"./chargepoint-wPlJlVYc.js";import{v as De,b as ee}from"./options-DHqL16EA.js";import $e from"./detail-BXuLkAc3.js";import Te from"./editConnector-D8_z5Fbo.js";import Fe from"./setChargeProfile-Bvt02RIr.js";import ze from"./start-BIRR3Apg.js";import Ke from"./v2gStart-DajHETc9.js";import{F as I,i as c,K as Oe,w as h,x as P,P as _,y as G,j as Ae,I as Pe,k as y,z as Ge,s as L}from"./vendor-antd-BiNc4BQP.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DcB4TerO.js";const{Option:M}=h,se={1:"Online",2:"Offline",3:"Unknown"},ae={1:"Available",2:"Unavailable",3:"Preparing",4:"Starting",5:"Stopping",6:"Charging",7:"Suspended EV",8:"Suspended EVSE",9:"Finishing",10:"Reserved",11:"Faulted",12:"Unknown",13:"Discharging"};function ts(){const[i,u]=o.useState({page:1}),[V,te]=o.useState("id_tag"),[g,R]=o.useState([]),[m,b]=o.useState([]),[U,ne]=o.useState("list"),[le,N]=o.useState(!1),[re,D]=o.useState(!1),[oe,w]=o.useState(!1),[k,$]=o.useState(!1),[ie,C]=o.useState(!1),[T,E]=o.useState(null),[f,x]=o.useState(null),[ce,q]=o.useState([]),[j,H]=o.useState([]),[de,J]=o.useState(!1),[he,me]=o.useState(0),[pe,F]=o.useState(0),[ue,p]=o.useState(0),[Q,xe]=o.useState({}),[X,ge]=o.useState(null);o.useEffect(()=>{const s=j.filter(a=>g.includes(a.key)).flatMap(a=>a.connectors.map(n=>n.key));b(s)},[g]);const je=()=>{const s=m.map(a=>{const[n,t]=a.split(S.rowKeySplit);return{charge_point_id:n,connector_id:t}});O(s,!0)},_e=()=>{const s=m.map(a=>{const[n,t]=a.split(S.rowKeySplit);return{charge_point_id:n,connector_id:t}});A(s,!0)},z=s=>{R(s)},Ce=s=>{if(m.includes(s.key)){const a=m.filter(n=>n!==s.key);b(a)}else b([...m,s.key])},fe=()=>{g.length===j.length?z([]):z(j.map(s=>s.key))},W=()=>{f?.status==="Charging"?N(!0):L.error("Only the Connector in Charging state supports this operation.")},K=(s,a)=>{const n=[...j];n.map(t=>(s.charge_point_id===t.id&&(t.connectors=t.connectors.map(r=>(s.connector_id===r.connector_id&&(r.charge_mode=a),r))),t)),H(n)},ve=[I.SELECTION_COLUMN,I.EXPAND_COLUMN,{title:"Charge Point",dataIndex:"id_tag",className:"bold",key:"id_tag",width:"260px",render:(s,a)=>e.jsx(c,{type:"link",onClick:()=>{E(a),$(!0)},children:s})},{title:"Status",width:"200px",dataIndex:"charge_point_status",key:"charge_point_status",render:s=>e.jsxs("div",{className:`status-item ${s.toLowerCase()}`,children:[e.jsx("div",{className:"point"}),e.jsx("span",{children:s})]})},{title:"SN",width:"200px",dataIndex:"sn",key:"sn"},{title:"Brand",width:"166px",dataIndex:"brand",key:"brand"},{title:"Brand Model",dataIndex:"brand_model",key:"brand_model"},{title:"V2G Support",dataIndex:"v2g_support",key:"v2g_support"}],Se=s=>{const a=[{title:"ID",className:"bold",width:"300px",dataIndex:"name",key:"name"},{title:"Status",width:"210px",dataIndex:"status",key:"status",render:n=>e.jsx("div",{className:`status ${n.toLowerCase().replace(" ","_")}`,children:e.jsx("span",{children:n})})},{title:"Charge Mode",width:"160px",dataIndex:"charge_mode",key:"charge_mode",render:(n,t)=>t.v2g_support==="V2G"?e.jsx("div",{className:"change-charge-mode ",children:e.jsx(h,{placeholder:"Select",value:n,style:{width:"160px"},onChange:r=>K(t,r),children:ee.map(r=>e.jsx(h.Option,{value:r.value,children:e.jsx("span",{className:r.value,children:r.label})},r.value))})}):e.jsx("div",{className:"status charge_mode",children:e.jsx("span",{children:"Charge Mode"})})},{title:"Operation",key:"operation",render:(n,t)=>e.jsxs("div",{className:"operations end",children:[t.v2g_support==="V2G"?e.jsx(c,{type:"link",onClick:()=>Y(t),icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Start"})}):e.jsx(_,{title:"Confirm start?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>O(t),children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Start"})})}),e.jsx(_,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm stop?",onConfirm:()=>A(t),children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Stop",size:"20"}),children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Stop"})})}),e.jsx(c,{type:"link",className:"operation-row-item",icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"AStart",size:"20"}),onClick:()=>{x(t),C(!0)},children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Advance Start"})}),e.jsx(c,{type:"link",icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Set",size:"20"}),onClick:()=>{x(t),W()},children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Set Profile"})})]})}];return e.jsx(I,{columns:a,showHeader:!1,dataSource:s.connectors,pagination:!1,rowKey:"key",bordered:!0,rowSelection:{selectedRowKeys:m,onSelect:Ce}})},ye=e.jsxs(h,{value:V,onChange:te,style:{width:156},children:[e.jsx(M,{value:"id_tag",children:"Charge Point"}),e.jsx(M,{value:"sn",children:"SN"})]}),be=s=>{const{expanded:a,onExpand:n,record:t}=s;return e.jsx("span",{onClick:r=>n(t,r),children:e.jsx(d,{icon:a?"Down":"Right",size:"17",color:"#d9d9d9",style:{marginTop:"-2px"}})})},Y=s=>{x(s),w(!0)},O=async(s,a)=>{const n=a?s:[{charge_point_id:s.charge_point_id,connector_id:s.connector_id,mode:"default"}],t=await B.start({cp_id_connector_pairs:n});t?.code===200&&(L.success(t.message),p(Date.now()))},A=async(s,a)=>{const n=a?s:[{charge_point_id:s.charge_point_id,connector_id:s.connector_id}],t=await B.stop({cp_id_connector_pairs:n});t?.code===200&&(L.success(t.message),p(Date.now()))},Ne=()=>{const s={...i};delete s.page,u(s),p(Date.now())},we=s=>{u({...i,page:s}),p(Date.now())},ke=async()=>{const{detail:s}=await S.getBrands({num:100}),a={},n={};s.results.forEach(t=>{a[t.brand]=t.id;const r=[];t.chargepointbrandmodel_set&&t.chargepointbrandmodel_set.forEach(l=>{r.push(l.brand_model)}),n[t.brand]=r}),ge(a),xe(n)},Ee=(s,a)=>{const n={},t={0:"Connector A",1:"Connector B",2:"Connector C",3:"Connector D",4:"Connector E",5:"Connector F",6:"Connector G",7:"Connector H",8:"Connector I",9:"Connector J"};return a.forEach(l=>{n[l.charge_point_id]={charge_point_status:se[l.charge_point_status],connector_statuses:l.connector_statuses.map((v,Me)=>({key:`${l.charge_point_id}${S.rowKeySplit}${v.connector_id}`,name:t[`${Me}`],charge_point_id:l.charge_point_id,connector_id:v.connector_id,charge_mode:"charge_mode",status:ae[v.status]}))}}),s.filter(l=>n[l.id]).map(l=>({key:`${l.id}${S.rowKeySplit}${l.id_tag}`,id:l.id,id_tag:l.id_tag,sn:l.sn,brand:l.brand_model.brand,brand_model:l.brand_model.brand_model,v2g_support:l.v2g_support?"V2G":"Non-V2G",charge_point_status:n[l.id].charge_point_status,picture:l.brand_model.picture,charge_model:l.brand_model.charge_model,connector_type:l.brand_model.charge_model==="AC"?"AC - Type2":"DC - CCS2",connectors:n[l.id].connector_statuses.map(v=>({...v,v2g_support:l.v2g_support?"V2G":"Non-V2G"}))}))},Be=()=>{u({}),p(Date.now())},Ie=async()=>{const s={...i};X&&(s.brand_id=X[s.brand],delete s.brand,s.brand_model||delete s.brand_model),J(!0);const a=await B.queryAll({num:100}),{results:n}=a.detail,t=await B.getStatus(s),r=Ee(n||[],t.detail.results);H(r),T&&r.length&&r.forEach(l=>{l.key===T.key&&E(l)}),q(r.map(l=>l.key)),me(t.detail.count),J(!1)};return o.useEffect(()=>{Ie()},[ue]),o.useEffect(()=>{ke(),p(Date.now())},[]),e.jsxs("div",{className:"main-content",children:[e.jsxs("div",{className:"search-area flex items-center justify-start",children:[e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:" "}),e.jsx(Oe,{addonBefore:ye,placeholder:"Enter",allowClear:!0,style:{width:"360px"},value:i[V],onChange:s=>{let a={...i};delete a.id_tag,delete a.sn,a={...a,[V]:s.target.value},u(a)}})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Brand"}),e.jsx(h,{className:"w-full",placeholder:"Select",allowClear:!0,value:i.brand,style:{width:"150px"},onChange:s=>{u({...i,brand:s,brand_model:void 0})},children:Object.keys(Q).map(s=>e.jsx(h.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Brand Model"}),e.jsx(h,{className:"w-full",allowClear:!0,disabled:!i.brand,placeholder:"Select",style:{width:"160px"},value:i.brand_model,onChange:s=>u({...i,brand_model:s}),children:i.brand&&Q[i.brand].map(s=>e.jsx(h.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"V2G Support"}),e.jsx(h,{placeholder:"Select",allowClear:!0,style:{width:"160px"},onChange:s=>{u({...i,v2g_support:!!s})},children:De.map(s=>e.jsx(h.Option,{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Charge Point Status"}),e.jsx(h,{className:"w-full",style:{width:"210px"},allowClear:!0,value:i.charge_point_status,placeholder:"Select",onChange:s=>u({...i,charge_point_status:s}),children:Object.entries(se).map(([s,a])=>e.jsx(M,{value:s,children:`${a}`},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Connector Status"}),e.jsx(h,{className:"w-full",style:{width:"190px"},allowClear:!0,placeholder:"Select",value:i.connector_status,onChange:s=>u({...i,connector_status:s}),children:Object.entries(ae).map(([s,a])=>e.jsx(M,{value:s,children:`${a}`},s))})]}),e.jsx("div",{className:"search-btn",children:e.jsx(c,{icon:e.jsx(d,{icon:"Search",size:"20"}),type:"primary",loading:de,onClick:Ne})}),e.jsx("div",{className:"search-btn clear",children:e.jsx(c,{icon:e.jsx(d,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:Be})})]}),e.jsxs("div",{className:"operation-area flex items-center justify-start",children:[e.jsxs(P.Group,{className:"layout-switch",value:U,onChange:s=>ne(s.target.value),children:[e.jsx(P.Button,{value:"list",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(Z,{icon:"mynaui:list",size:20}),"List"]})}),e.jsx(P.Button,{value:"grid",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(Z,{icon:"proicons:grid",size:20}),"Grid"]})})]}),e.jsx(_,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm Start?",onConfirm:()=>je(),children:e.jsx(c,{className:"ml-3 mr-3",disabled:m.length===0,icon:e.jsx(d,{icon:"Start",size:"20",color:m.length===0?"#999":"currentColor"}),children:"Bulk Start"})}),e.jsx(_,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm stop?",onConfirm:()=>_e(),children:e.jsx(c,{disabled:m.length===0,className:"mr-3",icon:e.jsx(d,{color:m.length===0?"#999":"currentColor",icon:"Stop",size:"20"}),children:"Bulk Stop"})})]}),U==="list"?e.jsx(I,{columns:ve,dataSource:j,rowHoverable:!1,bordered:!0,rowKey:"key",pagination:!1,expandable:{expandedRowRender:Se,expandIcon:be,expandedRowKeys:ce,onExpand:(s,a)=>{q(n=>s?[...n,a.key]:n.filter(t=>t!==a.key))}},rowSelection:{selectedRowKeys:g,onChange:z}}):e.jsxs("div",{className:"grid-wrapper",children:[e.jsx(G,{className:"check-all",checked:j.length===g.length,onChange:fe}),e.jsx("div",{className:"grid",children:j.map(s=>e.jsx("div",{className:"grid-item",children:e.jsxs(Ae,{children:[e.jsxs("div",{className:"grid-top with-image flex items-center",children:[e.jsx(G,{checked:g.includes(s.key),onChange:a=>{const n=a.target.checked?[...g,s.key]:g.filter(t=>t!==s.key);R(n)}}),e.jsx(Pe,{src:Ve,preview:!1,height:184,className:"entity-image object-cover"})]}),e.jsxs("div",{className:"grid-bottom monitor-bottom",children:[e.jsx("div",{className:"display-item",children:e.jsx(c,{type:"link",className:"detail-link",onClick:()=>{E(s),$(!0)},children:s.id_tag})}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Status:"})," ",e.jsx("span",{className:"value",children:e.jsxs("div",{className:`status-item ${s.charge_point_status.toLowerCase().replace(" ","_")}`,children:[e.jsx("div",{className:"point"}),e.jsx("span",{children:s.charge_point_status})]})})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"SN:"})," ",e.jsx("span",{className:"value",children:s.sn})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand:"})," ",e.jsx("span",{className:"value",children:s.brand})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand Model:"})," ",e.jsx("span",{className:"value",children:s.brand_model})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"V2G Support:"})," ",e.jsx("span",{className:"value",children:s.v2g_support})]}),s.charge_point_status!=="Offline"&&e.jsx("div",{className:"display-item  !mb-0 flex-col !items-start gap-2 !px-0",children:s.connectors.map(a=>e.jsxs("div",{className:"connector-wrapper w-full",children:[e.jsxs("div",{className:"connectors",children:[e.jsx(G,{checked:m.includes(a.key),onChange:n=>{const t=n.target.checked?[...m,a.key]:m.filter(r=>r!==a.key);b(t)}}),e.jsx("div",{className:"items flex-auto",children:e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:a.name})," ",e.jsx("span",{className:`value status ${a.status.toLowerCase().replace(" ","_")}`,children:a.status})]})})]}),e.jsxs("div",{className:"operation-columns",children:[e.jsx("div",{className:"operation-row",children:a.v2g_support==="V2G"?e.jsx(h,{placeholder:"Select",value:a.charge_mode,style:{width:"100%"},onChange:n=>K(a,n),children:ee.map(n=>e.jsx(h.Option,{value:n.value,children:e.jsx("span",{className:n.value,children:n.label})},n.value))}):e.jsx("div",{className:"status charge_mode",children:e.jsx("span",{children:"Charge Mode"})})}),e.jsxs("div",{className:"operation-row btns",children:[a.v2g_support==="V2G"?e.jsx(y,{title:"Start",color:a.charge_mode==="discharge_mode"?"#1B6EF3":"#1CAE70",placement:"bottom",children:e.jsx(c,{type:"link",onClick:()=>Y(a),icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`})})}):e.jsx(_,{title:"Confirm start?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>O(a),children:e.jsx(y,{title:"Start",color:a.charge_mode==="discharge_mode"?"#1B6EF3":"#1CAE70",placement:"bottom",children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`})})})}),e.jsx("div",{className:"split"}),e.jsx(_,{title:"Confirm stop?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>A(a),children:e.jsx(y,{title:"Stop",color:a.charge_mode==="discharge_mode"?"#1B6EF3":"#1CAE70",placement:"bottom",children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Stop",size:"20"}),children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`})})})}),e.jsx("div",{className:"split"}),e.jsx(y,{title:"Advance Start",color:a.charge_mode==="discharge_mode"?"#1B6EF3":"#1CAE70",placement:"bottom",children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"AStart",size:"20"}),onClick:()=>{x(a),C(!0)},children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`})})}),e.jsx("div",{className:"split"}),e.jsx(y,{title:"Set Profile",color:a.charge_mode==="discharge_mode"?"#1B6EF3":"#1CAE70",placement:"bottom",children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Set",size:"20"}),onClick:()=>{x(a),W()},children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`})})})]})]})]},a.key))})]})]},s.key)}))})]}),e.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:e.jsx(Ge,{total:he,showSizeChanger:!1,showQuickJumper:!0,onChange:we})}),e.jsx(Fe,{visible:le,connector:f,onCancel:()=>N(!1),onConfirm:()=>{N(!1),p(Date.now()),k&&F(Date.now())}}),e.jsx(Te,{visible:re,connector:f,onCancel:()=>D(!1),onConfirm:()=>{D(!1)}}),e.jsx(Ke,{visible:oe,connector:f,onCancel:()=>w(!1),onConfirm:()=>{w(!1),k&&F(Date.now())}}),k?e.jsx($e,{onCancel:()=>{E(null),$(!1),p(Date.now())},detailUpdate:pe,chargePoint:T,onChangeChargeMode:(s,a)=>{K(s,a)},handleV2gStart:s=>{x(s),w(!0)},onStart:s=>{x(s),C(!0)},onUpdate:()=>{p(Date.now())},onSetChargeProfile:s=>{x(s),N(!0)},onEditConnector:s=>{x(s),D(!0)}}):null,e.jsx(ze,{visible:ie,connector:f,onCancel:()=>C(!1),onConfirm:()=>{C(!1),p(Date.now()),k&&F(Date.now())}})]})}export{ts as default};

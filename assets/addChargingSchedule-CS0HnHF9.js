import{j as e,S as j}from"./index-cql_hjB4.js";import{r as l}from"./vendor-react-DcqtUZ_G.js";import{s as Q}from"./scheduleService-BDYnA8sc.js";import{d as w,b as J,r as U}from"./options-CwsqYUdd.js";import{H as s,E as X,i as g,w as o,k as O,Q as C,$ as E,o as Z,x as S,j as ee,s as N}from"./vendor-antd-BiNc4BQP.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DcB4TerO.js";function oe({visible:f,chargePoints:b,onCancel:A,onConfirm:T}){const[u]=s.useForm(),[Y,y]=l.useState(!1),[p,q]=l.useState(!1),[d,m]=l.useState([{limit:"",startAfter:"",time:0}]),[_,F]=l.useState("current"),[v,I]=l.useState(!1),[k,H]=l.useState(null),[x,M]=l.useState(95),[n,D]=l.useState("charge_mode"),[V,L]=l.useState([w[0]]),R=()=>{I(!0),m([...d,{limit:"",startAfter:"",time:Date.now()}])},B=t=>{q(t)},z=t=>{F(t),m([{limit:"",startAfter:"",time:Date.now()}])},W=t=>{const a=d.filter((r,i)=>i!==t);m([...a])},$=(t,a)=>{const r=[...d],i=r.map((c,h)=>h===t?{...r[t]||{limit:"",startAfter:"",time:Date.now()},limit:a}:c);m(i)},G=(t,a)=>{const r=[...d],i=r.map((c,h)=>h===t?{...r[t]||{limit:"",startAfter:"",time:Date.now()},startAfter:a}:c);m(i)},K=async()=>{let t=!0;const a=p?d.map(r=>((r.limit===""||r.startAfter==="")&&(t=!1),{limit:r.limit,startPeriod:r.startAfter*60})):[];if(p&&(!t||a.length===0)){N.error("Please Input Limit and Start After");return}if(v&&!x){N.error("Please Enter Soc");return}u.validateFields().then(async r=>{let i={max:.92};k.v2g_support==="V2G"&&(i=n==="charge_mode"?{max:(x||0)/100}:{min:(x||0)/100});let c={charge_point_id:k.id,connector_id:r.connector_id,mode:n==="charge_mode"?"default":"v2g",soc:i,ocpp_charging_schedule_period:a};c={...c,smart_charge:!0,profile_start_datetime:new Date(r.start_time).toISOString(),profile_end_datetime:new Date(r.end_time).toISOString(),ocpp_charging_profile_id:1,ocpp_stack_level:2,ocpp_charging_profile_purpose:"TxProfile",ocpp_charging_profile_kind:"Relative",ocpp_charging_rate_unit:_==="current"?"A":"B",ocpp_recurrency_kind:r.repeat_kind},y(!0);const h=[c],P=await Q.add({...h});y(!1),P?.code===200&&(N.success(P.message),T())})};return l.useEffect(()=>{f||(u.resetFields(),m([{limit:"",startAfter:"",time:0}]))},[f]),e.jsx(X,{title:"Add Schedule",open:f,onCancel:A,footer:[e.jsxs("div",{className:"footer-normal-btns",children:[e.jsx(g,{onClick:A,children:"Cancel"},"cancel"),e.jsx(g,{type:"primary",loading:Y,onClick:K,children:"Add"},"confirm")]},"add-schedule-footer")],children:e.jsx("div",{className:`modal-form ${n}_form`,children:e.jsxs(s,{form:u,layout:"vertical",children:[e.jsx(s.Item,{name:"charge_point_id",label:"Charge Point",rules:[{required:!0}],children:e.jsx(o,{className:"w-full",allowClear:!0,onChange:t=>{const a=b.find(r=>r.id_tag===t);H(a),I(a?.v2g_support||!1),M(95),u.setFieldValue("connector_id",""),u.setFieldValue("mode","charge_mode"),D("charge_mode"),L(a?.connector_no===2?w:[w[0]])},placeholder:"Select",children:b.map(t=>e.jsx(o.Option,{value:t.id_tag,children:t.id_tag},t.id_tag))})}),e.jsxs("div",{className:"two-column",children:[e.jsx(s.Item,{name:"connector_id",label:"Connector",rules:[{required:!0}],children:e.jsx(o,{className:"w-full",allowClear:!0,placeholder:"Select",children:V.map(t=>e.jsx(o.Option,{value:t.value,children:t.label},t.value))})}),e.jsx(s.Item,{label:""})]}),e.jsxs("div",{className:"two-column",children:[e.jsx(s.Item,{name:"mode",label:"Energy Mode",rules:[{required:!0}],children:v?e.jsx(o,{placeholder:"Select",value:n,style:{width:"100%"},onChange:t=>D(t),children:J.map(t=>e.jsx(o.Option,{value:t.value,children:e.jsx("span",{className:t.value,children:t.label})},t.value))}):e.jsx("div",{className:"form-status charge_mode",children:"Charge Mode"})}),v?e.jsx(s.Item,{label:"",children:e.jsxs("div",{className:"soc-form-wrapper",children:[e.jsx("label",{children:n==="charge_mode"?e.jsxs("div",{className:"icon-label",children:[e.jsx("span",{children:"Max Soc(%)"}),e.jsx(O,{title:"Maximum Charge Limit Is 95%",placement:"top",children:e.jsx("span",{className:"svg-wrapper",children:e.jsx(j,{className:"ml-1",icon:"Help",size:"20"})})})]}):e.jsxs("div",{className:"icon-label",children:[e.jsx("span",{children:"Min Soc(%)"}),e.jsx(O,{title:"Minimum Discharge Limit Is 20%",placement:"top",children:e.jsx("span",{children:e.jsx(j,{className:"ml-1",icon:"Help",size:"20"})})})]})}),e.jsx(C,{min:n==="charge_mode"?1:20,max:n==="charge_mode"?95:1e4,placeholder:"Enter",value:x,onChange:t=>M(t)})]})}):e.jsx(s.Item,{label:""})]}),e.jsxs("div",{className:"two-column",children:[e.jsx(s.Item,{name:"start_time",label:"Start Time",rules:[{required:!0}],children:e.jsx(E,{showTime:!0,format:"YYYY-MM-DD HH:mm"})}),e.jsx(s.Item,{name:"end_time",label:"End Time",rules:[{required:!0}],children:e.jsx(E,{showTime:!0,format:"YYYY-MM-DD HH:mm"})})]}),e.jsxs("div",{className:"two-column",children:[e.jsx(s.Item,{name:"repeat_kind",label:"Repeat Kind",children:e.jsx(o,{defaultValue:"No",allowClear:!0,children:U.map(t=>e.jsx(o.Option,{value:t.value,children:t.label},t.value))})}),e.jsx(s.Item,{label:""})]}),e.jsxs("div",{className:"between-wrapper mt-2",children:[e.jsx("span",{}),e.jsxs("div",{className:"switch",children:["With Profile",e.jsx(Z,{checked:p,onChange:B})]})]}),p&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"between-wrapper",children:[e.jsxs(S.Group,{optionType:"button",value:_,onChange:t=>z(t.target.value),className:"my-4",children:[e.jsx(S.Button,{value:"current",children:"Current"}),e.jsx(S.Button,{value:"power",children:"Power"})]}),e.jsx(g,{type:"link",icon:e.jsx(j,{icon:n==="discharge_mode"?"Add2":"Add",color:n==="discharge_mode"?"#1B6EF3":"currentColor",size:"28"}),onClick:()=>R()})]}),e.jsx(ee,{children:d.map((t,a)=>e.jsxs("div",{className:"advance-start-row",children:[e.jsx("div",{className:"close-row",children:e.jsx(g,{type:"link",onClick:()=>W(a),icon:e.jsx(j,{icon:"Close",size:"20",color:"#C3C3C3"})})}),e.jsxs("div",{className:"label-value-split ",children:[e.jsxs("div",{className:"mock-column",children:[e.jsx("div",{className:"required label",children:"Limit(W)"}),e.jsx(C,{min:1,max:1e5,value:t.limit,placeholder:_==="current"?"Current limit":"Power limit",onChange:r=>$(a,r)})]}),e.jsxs("div",{className:"mock-column",children:[e.jsx("div",{className:"required label",children:"Duration(Minutes)"}),e.jsx(C,{min:1,max:1e5,placeholder:"Input",value:t.startAfter,onChange:r=>G(a,r)})]})]},a)]},`setting-${t.time}`))})]})]})})})}export{oe as default};

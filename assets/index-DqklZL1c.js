import{h as se,j as e,S as m,f as k}from"./index-D-fi11Kk.js";import{r as l}from"./vendor-react-BcJS7s_i.js";import{c as _}from"./commonService-374mgtb2.js";import{c as M}from"./cpManagementService-Bq71P9DC.js";import{c as le}from"./chargepoint-wPlJlVYc.js";import{c as ne}from"./options-DbBeB8Zg.js";import te from"./addChargepoint-qB2Ga0bC.js";import re from"./detail-I8Ke-_BA.js";import{K as oe,w as d,i as c,x as b,P as v,F as ce,y as B,j as de,I as ie,z as he,s as me}from"./vendor-antd-B62eGpCx.js";import"./vendor-ui-DPkccqlC.js";import"./vendor-utils-CtEfXJzW.js";const{Option:D}=d;function we(){const[t,x]=l.useState([]),[p,I]=l.useState([]),[P,A]=l.useState(0),[f,z]=l.useState("list"),[T,y]=l.useState(!1),[$,C]=l.useState(!1),[u,R]=l.useState("id_tag"),[n,h]=l.useState({page:1}),[E,i]=l.useState(0),[O,N]=l.useState(null),[g,F]=l.useState([]),[K,V]=l.useState(null),L=se(),q=[{title:"Charge Point",dataIndex:"id_tag",key:"id_tag",className:"bold",render:(a,s)=>e.jsx(c,{type:"link",onClick:()=>w(s),children:a})},{title:"SN",dataIndex:"sn",key:"sn"},{title:"Brand",dataIndex:"brand",key:"brand"},{title:"Brand Model",dataIndex:"brand_model",key:"brand_model"},{title:"Charge Model",dataIndex:"charge_model",key:"charge_model"},{title:"Operation",width:"140px",key:"operation",render:(a,s)=>e.jsx("div",{className:"operations",children:e.jsx(v,{title:"Confirm delete?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>{j(s.id)},children:e.jsx(c,{type:"link",danger:!0,icon:e.jsx(m,{icon:"Delete",size:"20",color:"#FF4747"}),children:"Delete"})})})}],G={selectedRowKeys:t,onChange:a=>{x(a)}},w=a=>{N(a),y(!0)},U=e.jsxs(d,{value:u,onChange:R,style:{width:156},children:[e.jsx(D,{value:"id_tag",children:"Charge Point"}),e.jsx(D,{value:"sn",children:"SN"})]}),J=()=>{t.length===p.length?x([]):x(p.map(a=>a.key))},Q=()=>t.map(a=>a.split(_.rowKeySplit)[0]),j=async a=>{try{const s=await M.del({charge_point_ids:a?[a]:Q()});s?.code===200&&(me.success(s.message),i(Date.now()))}catch{}},H=()=>{i(Date.now())},W=a=>{h({...n,page:a}),i(Date.now())},X=async()=>{const{detail:a}=await _.getBrands(),s={},o={};a.forEach(r=>{s[r.brand]=r.id;const S=[];r.chargepointbrandmodel_set&&r.chargepointbrandmodel_set.forEach(ae=>{S.push(ae.brand_model)}),o[r.brand]=S}),V(s),F(o)},Y=a=>a.map(s=>{const{id:o,sn:r}=s;return{id:o,sn:r,key:`${s.id}${_.rowKeySplit}${s.id_tag}`,id_tag:s.id_tag,brand:s.brand_model.brand,brand_model:s.brand_model.brand_model,charge_model:s.brand_model.charge_model,connector_no:s.brand_model.connector_no,ocpp:s.brand_model.ocpp,phase:s.brand_model.phase,picture:s.brand_model.picture,out_current_max:parseInt(`${s.brand_model.out_current_max}`,10),out_current_min:parseInt(`${s.brand_model.out_current_min}`,10),out_power_max:parseInt(`${s.brand_model.out_power_max}`,10),out_power_min:parseInt(`${s.brand_model.out_power_min}`,10),out_voltage_max:parseInt(`${s.brand_model.out_voltage_max}`,10),out_voltage_min:parseInt(`${s.brand_model.out_voltage_min}`,10),connector_type:s.brand_model.charge_model==="AC"?"ac - type2":"dc - ccs2"}}),Z=()=>{h({}),i(Date.now())},ee=async()=>{const a=await M.queryAll(n),{results:s,count:o}=a.detail;I(Y(s||[])),A(o)};return l.useEffect(()=>{ee()},[E]),l.useEffect(()=>{X(),i(Date.now())},[]),e.jsxs("div",{className:"main-content",children:[e.jsxs("div",{className:"search-area flex items-center justify-start",children:[e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Enter"}),e.jsx(oe,{addonBefore:U,placeholder:u==="id_tag"?"Charge Point":"SN",allowClear:!0,value:n[u],onChange:a=>h({...n,[u]:a.target.value})})]}),e.jsxs("div",{className:"search-item ",children:[e.jsx("div",{className:"label",children:"Brand"}),e.jsx(d,{placeholder:"Brand",allowClear:!0,className:"w-full",style:{width:"150px"},value:n.brand,onChange:a=>h({...n,brand:a,brand_model:""}),children:Object.keys(g).map(a=>e.jsx(d.Option,{value:a,children:a},a))})]}),e.jsxs("div",{className:"search-item ",children:[e.jsx("div",{className:"label",children:"Brand Model"}),e.jsx(d,{value:n.brand_model,placeholder:"Brand Model",disabled:!n.brand,allowClear:!0,style:{width:"160px"},className:"w-full",onChange:a=>h({...n,brand_model:a}),children:n.brand&&g[n.brand].map(a=>e.jsx(d.Option,{value:a,children:a},a))})]}),e.jsxs("div",{className:"search-item ",children:[e.jsx("div",{className:"label",children:"Charge Model"}),e.jsx(d,{style:{width:"160px"},value:n.charge_model,allowClear:!0,placeholder:"Charge Model",className:"w-full",onChange:a=>h({...n,charge_model:a}),children:ne.map(a=>e.jsx(d.Option,{value:a,children:a},a))})]}),e.jsx("div",{className:"search-btn",children:e.jsx(c,{icon:e.jsx(m,{icon:"Search",size:"20"}),type:"primary",onClick:H})}),e.jsx("div",{className:"search-btn clear",children:e.jsx(c,{icon:e.jsx(m,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:Z})})]}),e.jsxs("div",{className:"operation-area flex items-center justify-start",children:[e.jsxs(b.Group,{className:"layout-switch",value:f,onChange:a=>z(a.target.value),children:[e.jsx(b.Button,{value:"list",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(k,{icon:"mynaui:list",size:20}),"List"]})}),e.jsx(b.Button,{value:"grid",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(k,{icon:"proicons:grid",size:20}),"Grid"]})})]}),e.jsx(c,{className:"ml-3 mr-3",type:"primary",icon:e.jsx(m,{icon:"Add",size:"20"}),onClick:()=>C(!0),children:"Add Charge Point"}),e.jsx(v,{title:"Confirm delete?",onConfirm:()=>{j()},placement:"bottom",okText:"Confirm",cancelText:"Cancel",children:e.jsx(c,{disabled:t.length===0,danger:!0,icon:e.jsx(m,{icon:"Delete",size:"20",color:t.length===0?"#999":"currentColor"}),children:"Bulk Delete"})})]}),f==="list"?e.jsx(ce,{bordered:!0,rowSelection:G,columns:q,dataSource:p,pagination:!1}):e.jsxs("div",{className:"grid-wrapper",children:[e.jsx(B,{className:"check-all",checked:p.length===t.length,onChange:J}),e.jsx("div",{className:"grid",children:p.map(a=>e.jsx("div",{className:"grid-item",children:e.jsxs(de,{hoverable:!0,className:"flex flex-col",children:[e.jsxs("div",{className:"grid-top with-image flex items-center",children:[e.jsx(B,{checked:t.includes(a.id),onChange:s=>{const o=s.target.checked?[...t,a.id]:t.filter(r=>r!==a.id);x(o)}}),e.jsx(ie,{src:le,preview:!1,height:184,className:"entity-image object-cover"})]}),e.jsxs("div",{className:"grid-bottom",children:[e.jsx("div",{className:"display-item",children:e.jsx(c,{type:"link",className:"detail-link",onClick:()=>{w(a)},children:a.id_tag})}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"SN:"})," ",e.jsx("span",{className:"value",children:a.sn})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand:"})," ",e.jsx("span",{className:"value",children:a.brand})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand Model:"})," ",e.jsx("span",{className:"value",children:a.brand_model})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Charge Model:"})," ",e.jsx("span",{className:"value",children:a.charge_model.toUpperCase()})]}),e.jsx("div",{className:"operation-rows",children:e.jsx(v,{title:"Confirm delete?",onConfirm:()=>{j(a.id)},placement:"bottom",okText:"Confirm",cancelText:"Cancel",children:e.jsx(c,{type:"link",danger:!0,icon:e.jsx(m,{icon:"Delete",size:"20",color:"#FF4747"}),children:"Delete"})})})]})]},a.id)}))})]}),e.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:e.jsx(he,{total:P,showQuickJumper:!0,onChange:W})}),e.jsx(re,{visible:T,onClose:()=>y(!1),onDelete:()=>{i(Date.now())},record:O,isAdmin:L}),e.jsx(te,{visible:$,onClose:()=>C(!1),brandModels:g,brandMap:K,onSave:()=>{i(Date.now()),N(null)}})]})}export{we as default};

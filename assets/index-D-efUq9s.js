import{j as e,S as d,f as M}from"./index-dV3J0R65.js";import{r as a}from"./vendor-react-DcqtUZ_G.js";import{c as L}from"./commonService-CRH6k3gI.js";import{c as ue}from"./cpMonitorService-D4hyAguQ.js";import{c as P}from"./cpUserManagementService-Cm1phOae.js";import{c as pe}from"./chargepoint-wPlJlVYc.js";import he from"./addChargepoint-CoYJ3lKD.js";import xe from"./chargepointUserDetail-BZUQRq5b.js";import je from"./editLocation-CRsN3KQ0.js";import _e from"./unbindUser-BR0aI7T2.js";import{K as fe,w as v,i as c,x as f,P as g,F as ge,y as z,j as be,I as ve,k as Ce,z as ye,s as we}from"./vendor-antd-BiNc4BQP.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DcB4TerO.js";import"./index-GeeErg0D.js";import"./index.modern-DDXp5BPH.js";import"./vendor-charts-CCrp_OZH.js";import"./index-DcX75npX.js";const{Option:b}=v;function qe(){const[T,h]=a.useState(1),[r,m]=a.useState({page:1}),[B,l]=a.useState(0),[R,V]=a.useState(null),[x,A]=a.useState("id_tag"),[C,E]=a.useState([]),[u,K]=a.useState([]),[q,O]=a.useState(0),[F,y]=a.useState(!1),[G,J]=a.useState([]),[w,Q]=a.useState("list"),[o,p]=a.useState([]),[H,S]=a.useState(!1),[W,N]=a.useState(!1),[X,k]=a.useState(!1);a.useState(!1);const[Y,$]=a.useState(!1),U=s=>{V(s),S(!0)},Z=[{title:"Charge Point",dataIndex:"id_tag",key:"id_tag",className:"bold",render:(s,t)=>e.jsx(c,{type:"link",onClick:()=>U(t),children:s})},{title:"User",dataIndex:"user",key:"user"},{title:"Location",dataIndex:"location",key:"location",render:s=>e.jsx("div",{className:"display-row location",children:e.jsx("div",{className:"row-item",children:`
            ${s?.cp_address||""}
            ${s?.cp_address?",":""}
            ${s?.cp_suburb||""}
            ${s?.cp_suburb?",":""}
            ${s?.cp_state||""}
            ${s?.cp_state?",":""}
            ${s?.cp_postcode||""}`})})},{title:"Operation",width:"140px",key:"operation",render:(s,t)=>e.jsx("div",{className:"operations",children:e.jsx(g,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm unbind?",onConfirm:()=>j(t.id),children:e.jsx(c,{type:"link",icon:e.jsx(d,{icon:"Unbind",size:"20"}),children:"Unbind"})})})}],ee=()=>{k(!0)},se={selectedRowKeys:o,onChange:s=>{p(s)}},te=e.jsxs(v,{value:x,onChange:A,style:{width:156},children:[e.jsx(b,{value:"id_tag",children:"Charge Point"}),e.jsx(b,{value:"sn",children:"SN"})]}),ae=()=>{o.length===u.length?p([]):p(u.map(s=>s.key))},j=async s=>{try{const t=await P.unbind({charge_point_user_ids:s?[s]:o});t?.code===200&&(we.success(t.message),l(Date.now()))}catch{}},ne=()=>{const s={...r};h(1),delete s.page,m(s),l(Date.now())},ie=s=>{h(s),m({...r,page:s}),l(Date.now())},oe=async()=>{const{detail:s}=await L.getUsers({num:100});E(s.results.map(i=>({name:`${i.first_name} ${i.last_name}`,phone:i.phone,email:i.email,user_id:i.user_id})));const t=await ue.queryAll({num:100});J(t.detail.results.map(i=>({sn:i.sn})))},le=s=>s.map(t=>{const{id:i,first_name:_,last_name:de,charge_point:I}=t,{charge_point_detail:D,brand_model:n,sn:me}=I;return{id:i,user:`${_} ${de}`,picture:n.picture,location:D,latlng:D?.latlng,key:`${t.id}${L.rowKeySplit}${t.charge_point_id}`,sn:me,id_tag:I.id_tag,brand:n.brand,brand_model:n.brand_model,charge_model:n.charge_model,connector_no:n.connector_no,ocpp:n.ocpp,phase:n.phase,out_current_max:parseInt(`${n.out_current_max}`,10),out_current_min:parseInt(`${n.out_current_min}`,10),out_power_max:parseInt(`${n.out_power_max}`,10),out_power_min:parseInt(`${n.out_power_min}`,10),out_voltage_max:parseInt(`${n.out_voltage_max}`,10),out_voltage_min:parseInt(`${n.out_voltage_min}`,10),connector_type:n.charge_model==="AC"?"ac - type2":"dc - ccs2"}}),ce=()=>{h(1),m({}),l(Date.now())},re=async()=>{y(!0);const s=await P.queryAll(r),{results:t,count:i}=s.detail;K(le(t||[])),O(i),y(!1)};return a.useEffect(()=>{re()},[B]),a.useEffect(()=>{oe(),l(Date.now())},[]),e.jsxs("div",{className:"main-content",children:[e.jsxs("div",{className:"search-area flex items-center justify-start",children:[e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:" "}),e.jsx(fe,{addonBefore:te,placeholder:"Enter",style:{width:"360px"},allowClear:!0,value:r[x],onChange:s=>{let t={...r};delete t.id_tag,delete t.sn,t={...t,[x]:s.target.value},m(t)}})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"User"}),e.jsx(v,{className:"w-full",allowClear:!0,value:r.user_id,style:{width:"150px"},onChange:s=>{m({...r,user_id:s})},placeholder:"Select",children:C.map(s=>e.jsx(b,{value:s.user_id,children:s.name},s.user_id))})]}),e.jsx("div",{className:"search-btn",children:e.jsx(c,{icon:e.jsx(d,{icon:"Search",size:"20"}),type:"primary",loading:F,onClick:ne})}),e.jsx("div",{className:"search-btn clear",children:e.jsx(c,{icon:e.jsx(d,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:ce})})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"operation-area flex items-center justify-start",children:[e.jsxs(f.Group,{className:"layout-switch",value:w,onChange:s=>Q(s.target.value),children:[e.jsx(f.Button,{value:"list",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(M,{icon:"mynaui:list",size:20}),"List"]})}),e.jsx(f.Button,{value:"grid",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(M,{icon:"proicons:grid",size:20}),"Grid"]})})]}),e.jsx(c,{icon:e.jsx(d,{icon:"Bind",size:"20"}),type:"primary",onClick:ee,className:"ml-3 mr-3",children:"Bind User and Charge Point"}),e.jsx(g,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm unbind?",onConfirm:()=>j(),children:e.jsx(c,{disabled:o.length===0,className:"ml-3",icon:e.jsx(d,{icon:"Unbind",size:"20",color:o.length===0?"#999":"currentColor"}),children:"Bulk Unbind"})})]})}),w==="list"?e.jsx(ge,{rowSelection:se,rowKey:"id",columns:Z,bordered:!0,dataSource:u,pagination:!1}):e.jsxs("div",{className:"grid-wrapper",children:[e.jsx(z,{className:"check-all",checked:u.length===o.length,onChange:ae}),e.jsx("div",{className:"grid",children:u.map(s=>e.jsx("div",{className:"grid-item",children:e.jsxs(be,{children:[e.jsxs("div",{className:"grid-top with-image flex items-center",children:[e.jsx(z,{checked:o.includes(s.id),onChange:t=>{const i=t.target.checked?[...o,s.id]:o.filter(_=>_!==s.id);p(i)}}),e.jsx(ve,{src:pe,preview:!1,height:184,className:"entity-image object-cover"})]}),e.jsxs("div",{className:"grid-bottom",children:[e.jsx("div",{className:"display-item",children:e.jsx(c,{type:"link",className:"detail-link",onClick:()=>{U(s)},children:s.id_tag})}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label bold",children:"User:"})," ",e.jsx("span",{className:"value",children:e.jsx("div",{children:e.jsx("div",{children:s.user})})})]}),e.jsxs("div",{className:"display-item location",children:[e.jsx("span",{className:"label",children:"Location:"})," ",e.jsx("span",{className:"value",children:e.jsx(Ce,{placement:"topLeft",title:`${s.location?.cp_address} ${s.location?.cp_suburb} ${s.location?.cp_state} ${s.location?.cp_postcode}`,children:e.jsx("span",{className:"truncated-text mr-1",children:`${s.location?.cp_address} ${s.location?.cp_suburb} ${s.location?.cp_state} ${s.location?.cp_postcode}`})})})]}),e.jsx("div",{className:"operation-rows",children:e.jsx(g,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm unbind?",onConfirm:()=>j(s.id),children:e.jsx(c,{type:"link",icon:e.jsx(d,{icon:"Unbind",size:"20"}),children:"Unbind"})})})]})]},s.id)}))})]}),e.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:e.jsx(ye,{total:q,current:T,showSizeChanger:!1,showQuickJumper:!0,onChange:ie})}),e.jsx(xe,{record:R,visible:H,onClose:()=>{S(!1),l(Date.now())}}),e.jsx(je,{visible:W,onCancel:()=>N(!1),onConfirm:()=>{N(!1),l(Date.now())}}),e.jsx(he,{visible:X,users:C,sns:G,onCancel:()=>k(!1),onConfirm:()=>{l(Date.now())}}),e.jsx(_e,{visible:Y,onCancel:()=>$(!1),onConfirm:()=>$(!1)})]})}export{qe as default};

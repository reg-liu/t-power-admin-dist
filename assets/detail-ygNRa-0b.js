import{j as s,S as c}from"./index-B0WWVFBn.js";import{S as ds,i as l,j as S,P as p,U as os,N as L,O as F,s as x}from"./vendor-antd-DmtkV1Ch.js";import{r as d}from"./vendor-react-BcJS7s_i.js";import{c as h}from"./cpMonitorService-7eD3BGUJ.js";import{R as N,L as v,C as f,X as y,Y as C,T as w,a as g,b as u}from"./LineChart-CMheHx8v.js";import"./vendor-ui-DPkccqlC.js";import"./vendor-utils-BKiv1F2M.js";import"./isEqual-Hc_6Fhhx.js";import"./vendor-charts-Cv5x1InZ.js";import"./index-Dj133iwh.js";function ws({onCancel:H,chargePoint:a,onStart:k,onUpdate:M,onSetChargeProfile:q,onEditConnector:D,updateList:B}){const[E,b]=d.useState([]),[R,G]=d.useState([]),[T,_]=d.useState([]),[z,X]=d.useState([]),[V,W]=d.useState(!0),[J,I]=d.useState(0),[ms,Q]=d.useState({}),[o,Z]=d.useState(null),[r,P]=d.useState(null),$=e=>{a?.status==="Charging"?q(e):x.error("Only the Connector in Charging state supports this operation.")},O=async e=>{const m=[{charge_point_id:e.charge_point_id,connector_id:e.connector_id,mode:"default",soc:{max:.92}}],t=await h.start({cp_id_connector_pairs:m});t?.code===200&&(x.success(t.message),I(Date.now()),M())},K=async e=>{const m=[{charge_point_id:e.charge_point_id,connector_id:e.connector_id}],t=await h.stop({cp_id_connector_pairs:m});t?.code===200&&(x.success(t.message),I(Date.now()),M())},ss=async()=>{const e=await h.getChargeProfile(a?.id);Q(e.detail),W(!1)},es=async(e,m)=>{const t=await h.getRealtimeInfo(e.charge_point_id,{connector_id:e.connector_id,action:"MeterValues"});if(t.code===200){const j=[];t.detail.L1.length&&j.push("L1"),t.detail.L2.length&&j.push("L2"),t.detail.L3.length&&j.push("L3");const i={...t.detail};i.L1.length&&(i.L1Map={},i.L1.forEach(n=>{n.measurand.includes("Power")&&(i.L1Map.power={...n}),n.measurand.includes("Current")&&(i.L1Map.current={...n}),n.measurand.includes("Energy")&&(i.L1Map.energy={...n})}),i.L2.forEach(n=>{n.measurand.includes("Power")&&(i.L2Map.power={...n}),n.measurand.includes("Current")&&(i.L2Map.current={...n}),n.measurand.includes("Energy")&&(i.L2Map.energy={...n})}),i.L3.forEach(n=>{n.measurand.includes("Power")&&(i.L3Map.power={...n}),n.measurand.includes("Current")&&(i.L3Map.current={...n}),n.measurand.includes("Energy")&&(i.L3Map.energy={...n})})),m===0?(Z(i),b(["L1"]),G(j)):(P(i),_(["L1"]),X(j))}else b([]),_([])};d.useEffect(()=>{a?.connectors?.forEach((e,m)=>{es(e,m)}),ss()},[B,J]);const A=[{date:"2023-06-01",energy:120},{date:"2023-06-02",energy:150},{date:"2023-06-03",energy:180},{date:"2023-06-04",energy:200},{date:"2023-06-05",energy:170},{date:"2023-06-06",energy:190},{date:"2023-06-07",energy:210}],as=[{date:"2023-06-01",session:5},{date:"2023-06-02",session:8},{date:"2023-06-03",session:6},{date:"2023-06-04",session:10},{date:"2023-06-05",session:7},{date:"2023-06-06",session:9},{date:"2023-06-07",session:11}],ns=[{type:"Error",num:3},{type:"Warning",num:5},{type:"Info",num:2}],is=[{date:"2023-06-01",online_num:20,offline_num:4},{date:"2023-06-02",online_num:22,offline_num:2},{date:"2023-06-03",online_num:21,offline_num:3},{date:"2023-06-04",online_num:23,offline_num:1},{date:"2023-06-05",online_num:20,offline_num:4},{date:"2023-06-06",online_num:24,offline_num:0},{date:"2023-06-07",online_num:22,offline_num:2}],Y=e=>{e===0?b(R):_(z)},U=e=>{e===0?b([]):_([])},cs=async e=>{const{file:m,onSuccess:t,onError:j}=e;try{const i=new FormData;i.append("file",m),i.append("charge_point_id",a?.id);const n=await h.updateFirmware(i);n?.code===200&&(x.success(n.message),t())}catch{x.error("Image upload failed!"),j()}},ls=async()=>{const e=await h.reset({charge_point_id:a?.id,type:"Soft"});e?.code===200&&x.success(e.message)},ts=async()=>{const e=await h.reset({charge_point_id:a?.id,type:"Hard"});e?.code===200&&x.success(e.message)},rs=async()=>{const e=await h.downloadLog({charge_point_id:a?.id});e?.code===200&&x.success(e.message)};return s.jsx("div",{className:"monitor-detail-page",children:s.jsxs(ds,{tip:"Loading...",spinning:V,children:[s.jsxs("div",{className:"title-wrapper",children:[s.jsx("span",{className:"title",children:"Charge Point Monitering Details"}),s.jsx("span",{className:"close-btn",children:s.jsx(l,{type:"link",onClick:H,icon:s.jsx(c,{icon:"icon_close",size:"20",color:"#999"})})})]}),s.jsxs("div",{className:"content-parts monitor-detail",children:[s.jsxs(S,{title:"Basic Information",className:"basic-card no-border",children:[s.jsxs("div",{className:"basic-card-row",children:[s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"Charge Point"}),s.jsx("div",{className:"value main-value",children:a?.id_tag})]}),s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"SN"}),s.jsx("div",{className:"value",children:a?.sn})]})]}),s.jsxs("div",{className:"basic-card-row",children:[s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"Brand"}),s.jsx("div",{className:"value",children:a?.brand})]}),s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"Brand Model"}),s.jsx("div",{className:"value",children:a?.brand_model})]})]}),s.jsxs("div",{className:"time-row",children:[s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"Repair Schedule"}),s.jsxs("div",{className:"value",children:[s.jsx("div",{className:"sub-label",children:"start:"}),s.jsx("div",{className:"sub-value",children:"2024-12-05"})]})]}),s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"Service Schedule"}),s.jsxs("div",{className:"value",children:[s.jsx("div",{className:"sub-label",children:"start:"}),s.jsx("div",{className:"sub-value",children:"2024-12-05"})]})]})]}),s.jsxs("div",{className:"btns",children:[s.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm remote reset software?",onConfirm:ls,children:s.jsx(l,{icon:s.jsx(c,{icon:"icon_software",size:"20"}),children:"Remote reset software"})}),s.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm remote reset hardware?",onConfirm:ts,children:s.jsx(l,{className:"ml-3",icon:s.jsx(c,{icon:"icon_hardware",size:"20"}),children:"Remote reset hardware"})}),s.jsx(os,{customRequest:cs,showUploadList:!1,children:s.jsx(l,{className:"ml-3",icon:s.jsx(c,{icon:"icon_upload",size:"20"}),children:"Upgrade Firmware"})}),s.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm download log?",onConfirm:rs,children:s.jsx(l,{className:"ml-3",icon:s.jsx(c,{icon:"icon_download",size:"20"}),children:"Download Log"})})]})]}),s.jsx(S,{title:"Realtime Information",className:"realtime-card no-border",children:s.jsxs(L,{column:2,children:[s.jsx(L.Item,{span:2,label:"Charge Point Status",children:s.jsxs("div",{className:`status-item ml-3 ${a?.charge_point_status.toLowerCase()}`,children:[s.jsx("div",{className:"point"}),s.jsx("span",{children:a?.charge_point_status})]})}),s.jsx(L.Item,{span:2,children:s.jsx("div",{className:"flex w-full flex-col",children:s.jsxs("div",{className:"connector-wrapper",children:[a.connectors[0]&&s.jsxs("div",{className:"connector0",children:[s.jsx("div",{className:"part-title",children:a.connectors[0].name}),s.jsxs("div",{className:"part-subtitle",children:[s.jsx("div",{className:"label",children:"Connector Statusï¼š"}),s.jsx("div",{className:`status ${a.connectors[0].status.toLowerCase()}`,children:s.jsx("span",{children:a.connectors[0].status})})]}),E.map(e=>s.jsxs("div",{className:"level-wrapper",children:[s.jsx("div",{className:"part-title",children:e}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Time"}),s.jsx("span",{className:"value",children:F(o?.start_time).format("YYYY-MM-DD HH:mm:ss")})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Sequence"}),s.jsx("span",{className:"value",children:o?.sequence_no})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Transactionid"}),s.jsx("span",{className:"value",children:o?.transaction_id})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"SoC"}),s.jsx("span",{className:"value",children:r?.soc})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Power"}),s.jsxs("span",{className:"value",children:[o?.[`${e}Map`]?.power?.value,o?.[`${e}Map`]?.power?.unit]})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Current"}),s.jsxs("span",{className:"value",children:[o?.[`${e}Map`]?.current?.value,o?.[`${e}Map`]?.current?.unit]})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Energy"}),s.jsxs("span",{className:"value",children:[o?.[`${e}Map`]?.energy?.value,o?.[`${e}Map`]?.energy?.unit]})]}),e==="L1"&&R.length>1?s.jsxs("div",{className:"display-item collapse-item",children:[s.jsx("span",{className:"label"}),s.jsx("span",{className:"value",children:E.length===1?s.jsx(l,{type:"link",onClick:()=>Y(0),icon:s.jsx(c,{icon:"Expand",size:"22"})}):s.jsx(l,{type:"link",onClick:()=>U(0),icon:s.jsx(c,{icon:"Collapse",size:"22"})})})]}):null]},e)),s.jsx("div",{className:"time-row",children:s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"Upcoming Charging Schedule "}),s.jsxs("div",{className:"bottom",children:[s.jsxs("div",{className:"value",children:[s.jsx("div",{className:"sub-label",children:"start:"}),s.jsx("div",{className:"sub-value",children:"2024-12-05 14:30:45"})]}),s.jsxs("div",{className:"value",children:[s.jsx("div",{className:"sub-label",children:"end:"}),s.jsx("div",{className:"sub-value",children:"2024-12-05 14:30:55"})]})]})]})}),s.jsxs("div",{className:"connector-btns",children:[s.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm Stop?",onConfirm:()=>K(a.connectors[0]),children:s.jsx(l,{style:{width:"218px"},type:"primary",icon:s.jsx(c,{icon:"Stop",size:"20"}),children:"Stop"})}),s.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm start?",onConfirm:()=>O(a.connectors[0]),children:s.jsx(l,{style:{width:"218px"},type:"primary",icon:s.jsx(c,{icon:"Start",size:"20"}),children:"Start"})}),s.jsx(l,{style:{width:"158px"},icon:s.jsx(c,{icon:"AStart",size:"20"}),onClick:()=>{k(a.connectors[0])},children:"Advanced Start"}),s.jsx(l,{style:{width:"200px"},icon:s.jsx(c,{icon:"Set",size:"20"}),onClick:()=>{$(a.connectors[0])},children:"Set Charge Profile"}),s.jsx(l,{style:{width:"200px"},icon:s.jsx(c,{icon:"Edit",size:"20"}),onClick:()=>{D(a.connectors[0])},children:"Edit Connector Status"})]})]},a.connectors[0].name),a.connectors[1]&&s.jsxs("div",{className:"connector1",children:[s.jsx("div",{className:"part-title",children:a.connectors[1].name}),s.jsxs("div",{className:"part-subtitle",children:[s.jsx("div",{className:"label",children:"Connector Statusï¼š"}),s.jsx("div",{className:`status ${a.connectors[1].status.toLowerCase()}`,children:s.jsx("span",{children:a.connectors[1].status})})]}),r&&T.map(e=>s.jsxs("div",{className:"level-wrapper",children:[s.jsx("div",{className:"part-title",children:e}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Time"}),s.jsx("span",{className:"value",children:F(r?.start_time).format("YYYY-MM-DD HH:mm:ss")})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Sequence"}),s.jsx("span",{className:"value",children:r?.sequence_no})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Transactionid"}),s.jsx("span",{className:"value",children:r?.transaction_id})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"SoC"}),s.jsx("span",{className:"value",children:r?.soc})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Power"}),s.jsxs("span",{className:"value",children:[r?.[`${e}Map`]?.power?.value,r?.[`${e}Map`]?.power?.unit]})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Current"}),s.jsxs("span",{className:"value",children:[r?.[`${e}Map`]?.current?.value,r?.[`${e}Map`]?.current?.unit]})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Energy"}),s.jsxs("span",{className:"value",children:[r?.[`${e}Map`]?.energy?.value,r?.[`${e}Map`]?.energy?.unit]})]}),e==="L1"&&z.length>1?s.jsxs("div",{className:"display-item collapse-item",children:[s.jsx("span",{className:"label"}),s.jsx("span",{className:"value",children:T.length===1?s.jsx(l,{type:"link",onClick:()=>Y(1),icon:s.jsx(c,{icon:"Expand",size:"22"})}):s.jsx(l,{type:"link",onClick:()=>U(1),icon:s.jsx(c,{icon:"Collapse",size:"22"})})})]}):null]},e)),s.jsx("div",{className:"time-row",children:s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"Upcoming Charging Schedule "}),s.jsxs("div",{className:"bottom",children:[s.jsxs("div",{className:"value",children:[s.jsx("div",{className:"sub-label",children:"start:"}),s.jsx("div",{className:"sub-value",children:"2024-12-05 14:30:45"})]}),s.jsxs("div",{className:"value",children:[s.jsx("div",{className:"sub-label",children:"end:"}),s.jsx("div",{className:"sub-value",children:"2024-12-05 14:30:55"})]})]})]})}),s.jsxs("div",{className:"connector-btns",children:[s.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm Stop?",onConfirm:()=>K(a.connectors[1]),children:s.jsx(l,{style:{width:"218px"},type:"primary",icon:s.jsx(c,{icon:"Stop",size:"20"}),children:"Stop"})}),s.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm start?",onConfirm:()=>O(a.connectors[1]),children:s.jsx(l,{style:{width:"218px"},type:"primary",icon:s.jsx(c,{icon:"Start",size:"20"}),children:"Start"})}),s.jsx(l,{style:{width:"158px"},icon:s.jsx(c,{icon:"AStart",size:"20"}),onClick:()=>{k(a.connectors[1])},children:"Advanced Start"}),s.jsx(l,{style:{width:"200px"},icon:s.jsx(c,{icon:"Set",size:"20"}),onClick:()=>{$(a.connectors[1])},children:"Set Charge Profile"}),s.jsx(l,{style:{width:"200px"},icon:s.jsx(c,{icon:"Edit",size:"20"}),onClick:()=>{D(a.connectors[1])},children:"Edit Connector Status"})]})]},a.connectors[1].name)]})})})]})}),s.jsx(S,{title:"Statistics Graphs/Information (7 days)",className:"chart-card no-border",children:s.jsxs("div",{className:"chart-wrapper",children:[s.jsxs("div",{className:"chart-item",children:[s.jsx("div",{className:"chart-title",children:"Energy Consumption"}),s.jsx("div",{className:"chart-content",children:s.jsx(N,{width:"100%",height:200,children:s.jsxs(v,{data:A,children:[s.jsx(f,{strokeDasharray:"3 3"}),s.jsx(y,{dataKey:"date"}),s.jsx(C,{}),s.jsx(w,{}),s.jsx(g,{}),s.jsx(u,{type:"monotone",dataKey:"energy",stroke:"#8884d8",name:"Charged Energy Per Day"})]})})})]}),s.jsxs("div",{className:"chart-item",children:[s.jsx("div",{className:"chart-title",children:"Charging Session Record"}),s.jsx("div",{className:"chart-content",children:s.jsx(N,{width:"100%",height:200,children:s.jsxs(v,{data:A,children:[s.jsx(f,{strokeDasharray:"3 3"}),s.jsx(y,{dataKey:"date"}),s.jsx(C,{}),s.jsx(w,{}),s.jsx(g,{}),s.jsx(u,{type:"monotone",dataKey:"energy",stroke:"#8884d8",name:"Charged Energy Per Day"})]})})})]}),s.jsxs("div",{className:"chart-item",children:[s.jsx("div",{className:"chart-title",children:"Usage Record"}),s.jsx("div",{className:"chart-content",children:s.jsx(N,{width:"100%",height:200,children:s.jsxs(v,{data:as,children:[s.jsx(f,{strokeDasharray:"3 3"}),s.jsx(y,{dataKey:"date"}),s.jsx(C,{}),s.jsx(w,{}),s.jsx(g,{}),s.jsx(u,{type:"monotone",dataKey:"session",stroke:"#82ca9d",name:"Num Of Charge Session Per Day"})]})})})]}),s.jsxs("div",{className:"chart-item",children:[s.jsx("div",{className:"chart-title",children:"Alert/Fault Record"}),s.jsx("div",{className:"chart-content",children:s.jsx(N,{width:"100%",height:200,children:s.jsxs(v,{data:ns,children:[s.jsx(f,{strokeDasharray:"3 3"}),s.jsx(y,{dataKey:"type"}),s.jsx(C,{}),s.jsx(w,{}),s.jsx(g,{}),s.jsx(u,{type:"monotone",dataKey:"num",stroke:"#ffc658",name:"Num Of Alert/Fault"})]})})})]}),s.jsxs("div",{className:"chart-item",children:[s.jsx("div",{className:"chart-title",children:"Online/Offline Record"}),s.jsx("div",{className:"chart-content",children:s.jsx(N,{width:"100%",height:200,children:s.jsxs(v,{data:is,children:[s.jsx(f,{strokeDasharray:"3 3"}),s.jsx(y,{dataKey:"date"}),s.jsx(C,{}),s.jsx(w,{}),s.jsx(g,{}),s.jsx(u,{type:"monotone",dataKey:"online_num",stroke:"#8884d8",name:"Num Of Online Record Per Day"}),s.jsx(u,{type:"monotone",dataKey:"offline_num",stroke:"#82ca9d",name:"Num Of Offline Record Per Day"})]})})})]})]})})]})]})})}export{ws as default};

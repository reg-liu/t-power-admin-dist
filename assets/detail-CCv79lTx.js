import{j as s,S as i}from"./index-B9brM18d.js";import{S as hs,i as l,j as M,P as p,U as js,N as D,O as k,x as u,s as x}from"./vendor-antd-DmtkV1Ch.js";import{r as o}from"./vendor-react-BcJS7s_i.js";import{c as h}from"./cpMonitorService-C-b0sAUN.js";import{R as v,L as f,C as y,X as b,Y as C,T as _,a as w,b as N}from"./LineChart-9h1fpD2o.js";import"./vendor-ui-DPkccqlC.js";import"./vendor-utils-BKiv1F2M.js";import"./isEqual-Hc_6Fhhx.js";import"./vendor-charts-Cv5x1InZ.js";import"./index-Dj133iwh.js";function gs({onCancel:B,chargePoint:a,onStart:E,handleV2gStart:R,onChangeChargeMode:z,onUpdate:T,onSetChargeProfile:X,onEditConnector:Y,updateList:W}){const[I,g]=o.useState([]),[$,J]=o.useState([]),[O,S]=o.useState([]),[K,Q]=o.useState([]),[Z,P]=o.useState(!0),[ss,A]=o.useState(0),[L,es]=o.useState({}),[m,as]=o.useState(null),[d,ns]=o.useState(null),H=e=>{a?.status==="Charging"?X(e):x.error("Only the Connector in Charging state supports this operation.")},U=async e=>{const t=[{charge_point_id:e.charge_point_id,connector_id:e.connector_id,mode:"default",soc:{max:.92}}],r=await h.start({cp_id_connector_pairs:t});r?.code===200&&(x.success(r.message),A(Date.now()),T())},F=async e=>{const t=[{charge_point_id:e.charge_point_id,connector_id:e.connector_id}],r=await h.stop({cp_id_connector_pairs:t});r?.code===200&&(x.success(r.message),A(Date.now()),T())},cs=async(e,t)=>{const r=await h.getChargeProfile(a?.id,{connector_id:e.connector_id});es({[e.connector_id]:{start:k(r.detail.profile_start_datetime).format("YYYY-MM-DD HH:mm:ss"),end:k(r.detail.profile_end_datetime).format("YYYY-MM-DD HH:mm:ss")}}),t&&P(!1)},is=async(e,t)=>{const r=await h.getRealtimeInfo(e.charge_point_id,{connector_id:e.connector_id,action:"MeterValues"});if(r.code===200){const j=[];r.detail.L1.length&&j.push("L1"),r.detail.L2.length&&j.push("L2"),r.detail.L3.length&&j.push("L3");const c={...r.detail};c.L1.length&&(c.L1Map={},c.L1.forEach(n=>{n.measurand.includes("Power")&&(c.L1Map.power={...n}),n.measurand.includes("Current")&&(c.L1Map.current={...n}),n.measurand.includes("Energy")&&(c.L1Map.energy={...n})}),c.L2.forEach(n=>{n.measurand.includes("Power")&&(c.L2Map.power={...n}),n.measurand.includes("Current")&&(c.L2Map.current={...n}),n.measurand.includes("Energy")&&(c.L2Map.energy={...n})}),c.L3.forEach(n=>{n.measurand.includes("Power")&&(c.L3Map.power={...n}),n.measurand.includes("Current")&&(c.L3Map.current={...n}),n.measurand.includes("Energy")&&(c.L3Map.energy={...n})})),t===0?(as(c),g(["L1"]),J(j)):(ns(c),S(["L1"]),Q(j))}else g([]),S([])};o.useEffect(()=>{const e=(a?.connectors?.length||0)-1;a?.connectors?.forEach((t,r)=>{is(t,r),cs(t,r===e)})},[W,ss]);const G=[{date:"2023-06-01",energy:120},{date:"2023-06-02",energy:150},{date:"2023-06-03",energy:180},{date:"2023-06-04",energy:200},{date:"2023-06-05",energy:170},{date:"2023-06-06",energy:190},{date:"2023-06-07",energy:210}],ls=[{date:"2023-06-01",session:5},{date:"2023-06-02",session:8},{date:"2023-06-03",session:6},{date:"2023-06-04",session:10},{date:"2023-06-05",session:7},{date:"2023-06-06",session:9},{date:"2023-06-07",session:11}],ts=[{type:"Error",num:3},{type:"Warning",num:5},{type:"Info",num:2}],rs=[{date:"2023-06-01",online_num:20,offline_num:4},{date:"2023-06-02",online_num:22,offline_num:2},{date:"2023-06-03",online_num:21,offline_num:3},{date:"2023-06-04",online_num:23,offline_num:1},{date:"2023-06-05",online_num:20,offline_num:4},{date:"2023-06-06",online_num:24,offline_num:0},{date:"2023-06-07",online_num:22,offline_num:2}],q=e=>{e===0?g($):S(K)},V=e=>{e===0?g([]):S([])},ds=async e=>{const{file:t,onSuccess:r,onError:j}=e;try{const c=new FormData;c.append("files",t),c.append("charge_point_id",a?.id);const n=await h.updateFirmware(c);n?.code===200&&(x.success(n.message),r())}catch{x.error("Upgrade Firmware failed!"),j()}},os=async()=>{const e=await h.reset({charge_point_id:a?.id,type:"Soft"});e?.code===200&&x.success(e.message)},ms=async()=>{const e=await h.reset({charge_point_id:a?.id,type:"Hard"});e?.code===200&&x.success(e.message)},xs=async()=>{const e=await h.downloadLog({charge_point_id:a?.id});if(e?.code===200&&(x.success(e.message),e.detail.url)){const t=document.createElement("a");t.download="",t.style.display="none",t.href=e.detail.url,document.body.appendChild(t),t.click(),document.body.removeChild(t)}};return s.jsx("div",{className:"monitor-detail-page",children:s.jsxs(hs,{tip:"Loading...",spinning:Z,children:[s.jsxs("div",{className:"title-wrapper",children:[s.jsx("span",{className:"title",children:"Charge Point Monitering Details"}),s.jsx("span",{className:"close-btn",children:s.jsx(l,{type:"link",onClick:B,icon:s.jsx(i,{icon:"icon_close",size:"20",color:"#999"})})})]}),s.jsxs("div",{className:"content-parts monitor-detail",children:[s.jsx(M,{title:"Basic Information",className:"basic-card no-border",children:s.jsxs("div",{className:"basic-card-inner",children:[s.jsxs("div",{className:"basic-card-row",children:[s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"Charge Point"}),s.jsx("div",{className:"value main-value",children:a?.id_tag})]}),s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"SN"}),s.jsx("div",{className:"value",children:a?.sn})]})]}),s.jsxs("div",{className:"basic-card-row",children:[s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"Brand"}),s.jsx("div",{className:"value",children:a?.brand})]}),s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"Brand Model"}),s.jsx("div",{className:"value",children:a?.brand_model})]})]}),s.jsx("div",{className:"basic-card-row",children:s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"V2G Support"}),s.jsx("div",{className:"value",children:a?.v2g_support})]})}),s.jsxs("div",{className:"time-row cp-time-row",children:[s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"Repair Schedule"}),s.jsxs("div",{className:"value",children:[s.jsx("div",{className:"sub-label",children:"Start:"}),s.jsx("div",{className:"sub-value",children:"2025-3-05"})]})]}),s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"Service Schedule"}),s.jsxs("div",{className:"value",children:[s.jsx("div",{className:"sub-label",children:"Start:"}),s.jsx("div",{className:"sub-value",children:"2025-3-06"})]})]})]}),s.jsxs("div",{className:"btns",children:[s.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm remote reset software?",onConfirm:os,children:s.jsx(l,{className:"baisc-btn",icon:s.jsx(i,{icon:"icon_software",size:"20"}),children:"Remote reset software"})}),s.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm remote reset hardware?",onConfirm:ms,children:s.jsx(l,{className:"baisc-btn ml-3",icon:s.jsx(i,{icon:"icon_hardware",size:"20"}),children:"Remote reset hardware"})}),s.jsx(js,{customRequest:ds,showUploadList:!1,children:s.jsx(l,{className:"baisc-btn ml-3",icon:s.jsx(i,{icon:"icon_upload",size:"20"}),children:"Upgrade Firmware"})}),s.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm download log?",onConfirm:xs,children:s.jsx(l,{className:"baisc-btn ml-3",icon:s.jsx(i,{icon:"icon_download",size:"20"}),children:"Download Log"})})]})]})}),s.jsx(M,{title:"Realtime Information",className:"realtime-card no-border",children:s.jsxs(D,{column:2,children:[s.jsx(D.Item,{span:2,label:"Charge Point Status",children:s.jsxs("div",{className:`status-item ml-3 ${a?.charge_point_status.toLowerCase()}`,children:[s.jsx("div",{className:"point"}),s.jsx("span",{children:a?.charge_point_status})]})}),s.jsx(D.Item,{span:2,children:s.jsx("div",{className:"flex w-full flex-col",children:s.jsxs("div",{className:"connector-wrapper",children:[a.connectors[0]&&s.jsxs("div",{className:"connector0",children:[s.jsx("div",{className:"part-title",children:a.connectors[0].name}),s.jsxs("div",{className:"part-subtitle",children:[s.jsx("div",{className:"label",children:"Connector Status："}),s.jsx("div",{className:`status ${a.connectors[0].status.toLowerCase()}`,children:s.jsx("span",{children:a.connectors[0].status})})]}),I.map(e=>s.jsxs("div",{className:"level-wrapper",children:[s.jsx("div",{className:"part-title",children:e}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Time"}),s.jsx("span",{className:"value",children:k(m?.start_time).format("YYYY-MM-DD HH:mm:ss")})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Sequence"}),s.jsx("span",{className:"value",children:m?.sequence_no})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Transactionid"}),s.jsx("span",{className:"value",children:m?.transaction_id})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"SoC"}),s.jsx("span",{className:"value",children:d?.soc})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Power"}),s.jsxs("span",{className:"value",children:[m?.[`${e}Map`]?.power?.value,m?.[`${e}Map`]?.power?.unit]})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Current"}),s.jsxs("span",{className:"value",children:[m?.[`${e}Map`]?.current?.value,m?.[`${e}Map`]?.current?.unit]})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Energy"}),s.jsxs("span",{className:"value",children:[m?.[`${e}Map`]?.energy?.value,m?.[`${e}Map`]?.energy?.unit]})]}),e==="L1"&&$.length>1?s.jsxs("div",{className:"display-item collapse-item",children:[s.jsx("span",{className:"label"}),s.jsx("span",{className:"value",children:I.length===1?s.jsx(l,{type:"link",onClick:()=>q(0),icon:s.jsx(i,{icon:"Expand",size:"22"})}):s.jsx(l,{type:"link",onClick:()=>V(0),icon:s.jsx(i,{icon:"Collapse",size:"22"})})})]}):null]},e)),s.jsx("div",{className:"time-row connector-time-row",children:s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"Upcoming Charging Schedule "}),s.jsxs("div",{className:"bottom",children:[s.jsx("div",{className:"charge-label",children:"Charge"}),s.jsxs("div",{className:"value",children:[s.jsx("div",{className:"sub-label",children:"Start:"}),s.jsx("div",{className:"sub-value",children:L[a.connectors[0].connector_id]?.start})]}),s.jsxs("div",{className:"value",children:[s.jsx("div",{className:"sub-label",children:"End:"}),s.jsx("div",{className:"sub-value",children:L[a.connectors[0].connector_id]?.end})]})]})]})}),s.jsxs("div",{className:"connector-btns",children:[s.jsx("div",{className:"charge_mode_row",children:s.jsxs(u.Group,{className:"layout-switch",defaultValue:a.connectors[0].charge_mode,onChange:e=>z(e.target.value,a.connectors[0]),children:[s.jsx(u,{value:"charge_mode",children:"Charge Mode"}),s.jsx(u,{value:"discharge_mode",children:"Discharge Mode"})]})}),s.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm Stop?",onConfirm:()=>F(a.connectors[0]),children:s.jsx(l,{className:"detail-btn",type:"primary",icon:s.jsx(i,{icon:"Stop",size:"20"}),children:"Stop"})}),a.connectors[0].v2g_support==="V2G"?s.jsx(l,{className:"detail-btn",type:"primary",icon:s.jsx(i,{icon:"Start",size:"20"}),onClick:()=>R(a.connectors[0]),children:s.jsx("span",{className:"btn",children:"Start"})}):s.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm start?",onConfirm:()=>U(a.connectors[0]),children:s.jsx(l,{className:"detail-btn",type:"primary",icon:s.jsx(i,{icon:"Start",size:"20"}),children:"Start"})}),s.jsx("div",{style:{width:"162px"}}),s.jsx(l,{className:"detail-btn",icon:s.jsx(i,{icon:"AStart",size:"20"}),onClick:()=>{E(a.connectors[0])},children:"Advanced Start"}),s.jsx(l,{className:"detail-btn",icon:s.jsx(i,{icon:"Set",size:"20"}),onClick:()=>{H(a.connectors[0])},children:"Set Profile"}),s.jsx(l,{style:{width:"204px"},icon:s.jsx(i,{icon:"Edit",size:"20"}),onClick:()=>{Y(a.connectors[0])},children:"Edit Connector Status"})]})]},a.connectors[0].name),a.connectors[1]&&s.jsxs("div",{className:"connector1",children:[s.jsx("div",{className:"part-title",children:a.connectors[1].name}),s.jsxs("div",{className:"part-subtitle",children:[s.jsx("div",{className:"label",children:"Connector Status："}),s.jsx("div",{className:`status ${a.connectors[1].status.toLowerCase()}`,children:s.jsx("span",{children:a.connectors[1].status})})]}),d&&O.map(e=>s.jsxs("div",{className:"level-wrapper",children:[s.jsx("div",{className:"part-title",children:e}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Time"}),s.jsx("span",{className:"value",children:k(d?.start_time).format("YYYY-MM-DD HH:mm:ss")})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Sequence"}),s.jsx("span",{className:"value",children:d?.sequence_no})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Transactionid"}),s.jsx("span",{className:"value",children:d?.transaction_id})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"SoC"}),s.jsx("span",{className:"value",children:d?.soc})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Power"}),s.jsxs("span",{className:"value",children:[d?.[`${e}Map`]?.power?.value,d?.[`${e}Map`]?.power?.unit]})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Current"}),s.jsxs("span",{className:"value",children:[d?.[`${e}Map`]?.current?.value,d?.[`${e}Map`]?.current?.unit]})]}),s.jsxs("div",{className:"display-item",children:[s.jsx("span",{className:"label",children:"Energy"}),s.jsxs("span",{className:"value",children:[d?.[`${e}Map`]?.energy?.value,d?.[`${e}Map`]?.energy?.unit]})]}),e==="L1"&&K.length>1?s.jsxs("div",{className:"display-item collapse-item",children:[s.jsx("span",{className:"label"}),s.jsx("span",{className:"value",children:O.length===1?s.jsx(l,{type:"link",onClick:()=>q(1),icon:s.jsx(i,{icon:"Expand",size:"22"})}):s.jsx(l,{type:"link",onClick:()=>V(1),icon:s.jsx(i,{icon:"Collapse",size:"22"})})})]}):null]},e)),s.jsx("div",{className:"time-row connector-time-row",children:s.jsxs("div",{className:"item",children:[s.jsx("div",{className:"label",children:"Upcoming Charging Schedule "}),s.jsxs("div",{className:"bottom",children:[s.jsx("div",{className:"charge-label",children:"Charge"}),s.jsxs("div",{className:"value",children:[s.jsx("div",{className:"sub-label",children:"Start:"}),s.jsx("div",{className:"sub-value",children:L[a.connectors[1].connector_id]?.start})]}),s.jsxs("div",{className:"value",children:[s.jsx("div",{className:"sub-label",children:"End:"}),s.jsx("div",{className:"sub-value",children:L[a.connectors[1].connector_id]?.end})]})]})]})}),s.jsxs("div",{className:"connector-btns",children:[s.jsx("div",{className:"charge_mode_row",children:s.jsxs(u.Group,{className:"layout-switch",defaultValue:a.connectors[1].charge_mode,onChange:e=>z(e.target.value,a.connectors[1]),children:[s.jsx(u,{value:"charge_mode",children:"Charge Mode"}),s.jsx(u,{value:"discharge_mode",children:"Discharge Mode"})]})}),s.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm Stop?",onConfirm:()=>F(a.connectors[1]),children:s.jsx(l,{className:"detail-btn",type:"primary",icon:s.jsx(i,{icon:"Stop",size:"20"}),children:"Stop"})}),a.connectors[1].v2g_support==="V2G"?s.jsx(l,{className:"detail-btn",type:"primary",icon:s.jsx(i,{icon:"Start",size:"20"}),onClick:()=>R(a.connectors[1]),children:s.jsx("span",{className:"btn",children:"Start"})}):s.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm start?",onConfirm:()=>U(a.connectors[1]),children:s.jsx(l,{className:"detail-btn",type:"primary",icon:s.jsx(i,{icon:"Start",size:"20"}),children:"Start"})}),s.jsx("div",{style:{width:"162px"}}),s.jsx(l,{className:"detail-btn",icon:s.jsx(i,{icon:"AStart",size:"20"}),onClick:()=>{E(a.connectors[1])},children:"Advanced Start"}),s.jsx(l,{className:"detail-btn",icon:s.jsx(i,{icon:"Set",size:"20"}),onClick:()=>{H(a.connectors[1])},children:"Set Profile"}),s.jsx(l,{style:{width:"204px"},icon:s.jsx(i,{icon:"Edit",size:"20"}),onClick:()=>{Y(a.connectors[1])},children:"Edit Connector Status"})]})]},a.connectors[1].name)]})})})]})}),s.jsx(M,{title:"Statistics Graphs/Information (7 days)",className:"chart-card no-border",children:s.jsxs("div",{className:"chart-wrapper",children:[s.jsxs("div",{className:"chart-item",children:[s.jsx("div",{className:"chart-title",children:"Energy Consumption"}),s.jsx("div",{className:"chart-content",children:s.jsx(v,{width:"100%",height:200,children:s.jsxs(f,{data:G,children:[s.jsx(y,{strokeDasharray:"3 3"}),s.jsx(b,{dataKey:"date"}),s.jsx(C,{}),s.jsx(_,{}),s.jsx(w,{}),s.jsx(N,{type:"monotone",dataKey:"energy",stroke:"#8884d8",name:"Charged Energy Per Day"})]})})})]}),s.jsxs("div",{className:"chart-item",children:[s.jsx("div",{className:"chart-title",children:"Charging Session Record"}),s.jsx("div",{className:"chart-content",children:s.jsx(v,{width:"100%",height:200,children:s.jsxs(f,{data:G,children:[s.jsx(y,{strokeDasharray:"3 3"}),s.jsx(b,{dataKey:"date"}),s.jsx(C,{}),s.jsx(_,{}),s.jsx(w,{}),s.jsx(N,{type:"monotone",dataKey:"energy",stroke:"#8884d8",name:"Charged Energy Per Day"})]})})})]}),s.jsxs("div",{className:"chart-item",children:[s.jsx("div",{className:"chart-title",children:"Usage Record"}),s.jsx("div",{className:"chart-content",children:s.jsx(v,{width:"100%",height:200,children:s.jsxs(f,{data:ls,children:[s.jsx(y,{strokeDasharray:"3 3"}),s.jsx(b,{dataKey:"date"}),s.jsx(C,{}),s.jsx(_,{}),s.jsx(w,{}),s.jsx(N,{type:"monotone",dataKey:"session",stroke:"#82ca9d",name:"Num Of Charge Session Per Day"})]})})})]}),s.jsxs("div",{className:"chart-item",children:[s.jsx("div",{className:"chart-title",children:"Alert/Fault Record"}),s.jsx("div",{className:"chart-content",children:s.jsx(v,{width:"100%",height:200,children:s.jsxs(f,{data:ts,children:[s.jsx(y,{strokeDasharray:"3 3"}),s.jsx(b,{dataKey:"type"}),s.jsx(C,{}),s.jsx(_,{}),s.jsx(w,{}),s.jsx(N,{type:"monotone",dataKey:"num",stroke:"#ffc658",name:"Num Of Alert/Fault"})]})})})]}),s.jsxs("div",{className:"chart-item",children:[s.jsx("div",{className:"chart-title",children:"Online/Offline Record"}),s.jsx("div",{className:"chart-content",children:s.jsx(v,{width:"100%",height:200,children:s.jsxs(f,{data:rs,children:[s.jsx(y,{strokeDasharray:"3 3"}),s.jsx(b,{dataKey:"date"}),s.jsx(C,{}),s.jsx(_,{}),s.jsx(w,{}),s.jsx(N,{type:"monotone",dataKey:"online_num",stroke:"#8884d8",name:"Num Of Online Record Per Day"}),s.jsx(N,{type:"monotone",dataKey:"offline_num",stroke:"#82ca9d",name:"Num Of Offline Record Per Day"})]})})})]})]})})]})]})})}export{gs as default};

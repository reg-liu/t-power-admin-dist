import{j as e,S as l}from"./index-KosxAGm1.js";import{S as je,i as t,j as D,P as p,U as pe,N as M,O as v,x as u,s as j}from"./vendor-antd-DmtkV1Ch.js";import{r as o}from"./vendor-react-BcJS7s_i.js";import{c as h}from"./cpMonitorService-DoXxt-Ur.js";import{R as f,L as y,C as _,X as b,Y as C,T as g,a as w,b as N}from"./LineChart-3CsdUjaQ.js";import"./vendor-ui-DPkccqlC.js";import"./vendor-utils-BKiv1F2M.js";import"./isEqual-Hc_6Fhhx.js";import"./vendor-charts-Cv5x1InZ.js";import"./index-Dj133iwh.js";function Se({onCancel:B,chargePoint:a,onStart:E,handleV2gStart:Y,onChangeChargeMode:R,onUpdate:z,onSetChargeProfile:X,onEditConnector:T,updateList:W}){const[$,S]=o.useState([]),[I,J]=o.useState([]),[O,L]=o.useState([]),[K,Q]=o.useState([]),[Z,P]=o.useState(!0),[ee,A]=o.useState(0),[k,se]=o.useState({}),[m,ae]=o.useState(null),[d,ne]=o.useState(null),H=s=>{a?.status==="Charging"?X(s):j.error("Only the Connector in Charging state supports this operation.")},U=async s=>{const r=[{charge_point_id:s.charge_point_id,connector_id:s.connector_id,mode:"default",soc:{max:.92}}],i=await h.start({cp_id_connector_pairs:r});i?.code===200&&(j.success(i.message),A(Date.now()),z())},F=async s=>{const r=[{charge_point_id:s.charge_point_id,connector_id:s.connector_id}],i=await h.stop({cp_id_connector_pairs:r});i?.code===200&&(j.success(i.message),A(Date.now()),z())},ce=async(s,r)=>{const i=await h.getChargeProfile(a?.id,{connector_id:s.connector_id});se({[s.connector_id]:{start:v(i.detail.profile_start_datetime).format("YYYY-MM-DD HH:mm:ss"),end:v(i.detail.profile_end_datetime).format("YYYY-MM-DD HH:mm:ss")}}),r&&P(!1)},ie=async(s,r)=>{const i=await h.getRealtimeInfo(s.charge_point_id,{connector_id:s.connector_id,action:"MeterValues"});if(i.code===200){const x=[];i.detail.L1.length&&x.push("L1"),i.detail.L2.length&&x.push("L2"),i.detail.L3.length&&x.push("L3");const c={...i.detail};c.L1.length&&(c.L1Map={},c.L1.forEach(n=>{n.measurand.includes("Power")&&(c.L1Map.power={...n}),n.measurand.includes("Current")&&(c.L1Map.current={...n}),n.measurand.includes("Energy")&&(c.L1Map.energy={...n})}),c.L2.forEach(n=>{n.measurand.includes("Power")&&(c.L2Map.power={...n}),n.measurand.includes("Current")&&(c.L2Map.current={...n}),n.measurand.includes("Energy")&&(c.L2Map.energy={...n})}),c.L3.forEach(n=>{n.measurand.includes("Power")&&(c.L3Map.power={...n}),n.measurand.includes("Current")&&(c.L3Map.current={...n}),n.measurand.includes("Energy")&&(c.L3Map.energy={...n})})),r===0?(ae(c),S(["L1"]),J(x)):(ne(c),L(["L1"]),Q(x))}else S([]),L([])},le=async()=>{const s=v(),i=s.subtract(7,"day").startOf("day").format("YYYY-MM-DD"),x=s.endOf("day").format("YYYY-MM-DD");(await h.getChartInfo({charge_point_id:a?.id,start_date:i,end_date:x,mode:"default"})).code};o.useEffect(()=>{const s=(a?.connectors?.length||0)-1;a?.connectors?.forEach((r,i)=>{ie(r,i),ce(r,i===s)}),le()},[W,ee]);const G=[{date:"2023-06-01",energy:120},{date:"2023-06-02",energy:150},{date:"2023-06-03",energy:180},{date:"2023-06-04",energy:200},{date:"2023-06-05",energy:170},{date:"2023-06-06",energy:190},{date:"2023-06-07",energy:210}],te=[{date:"2023-06-01",session:5},{date:"2023-06-02",session:8},{date:"2023-06-03",session:6},{date:"2023-06-04",session:10},{date:"2023-06-05",session:7},{date:"2023-06-06",session:9},{date:"2023-06-07",session:11}],re=[{type:"Error",num:3},{type:"Warning",num:5},{type:"Info",num:2}],de=[{date:"2023-06-01",online_num:20,offline_num:4},{date:"2023-06-02",online_num:22,offline_num:2},{date:"2023-06-03",online_num:21,offline_num:3},{date:"2023-06-04",online_num:23,offline_num:1},{date:"2023-06-05",online_num:20,offline_num:4},{date:"2023-06-06",online_num:24,offline_num:0},{date:"2023-06-07",online_num:22,offline_num:2}],q=s=>{s===0?S(I):L(K)},V=s=>{s===0?S([]):L([])},oe=async s=>{const{file:r,onSuccess:i,onError:x}=s;try{const c=new FormData;c.append("files",r),c.append("charge_point_id",a?.id);const n=await h.updateFirmware(c);n?.code===200&&(j.success(n.message),i())}catch{j.error("Upgrade Firmware failed!"),x()}},me=async()=>{const s=await h.reset({charge_point_id:a?.id,type:"Soft"});s?.code===200&&j.success(s.message)},xe=async()=>{const s=await h.reset({charge_point_id:a?.id,type:"Hard"});s?.code===200&&j.success(s.message)},he=async()=>{const s=await h.downloadLog({charge_point_id:a?.id});if(s?.code===200&&(j.success(s.message),s.detail.url)){const r=document.createElement("a");r.download="",r.style.display="none",r.href=s.detail.url,document.body.appendChild(r),r.click(),document.body.removeChild(r)}};return e.jsx("div",{className:"monitor-detail-page",children:e.jsxs(je,{tip:"Loading...",spinning:Z,children:[e.jsxs("div",{className:"title-wrapper",children:[e.jsx("span",{className:"title",children:"Charge Point Monitering Details"}),e.jsx("span",{className:"close-btn",children:e.jsx(t,{type:"link",onClick:B,icon:e.jsx(l,{icon:"icon_close",size:"20",color:"#999"})})})]}),e.jsxs("div",{className:"content-parts monitor-detail",children:[e.jsx(D,{title:"Basic Information",className:"basic-card no-border",children:e.jsxs("div",{className:"basic-card-inner",children:[e.jsxs("div",{className:"basic-card-row",children:[e.jsxs("div",{className:"item",children:[e.jsx("div",{className:"label",children:"Charge Point"}),e.jsx("div",{className:"value main-value",children:a?.id_tag})]}),e.jsxs("div",{className:"item",children:[e.jsx("div",{className:"label",children:"SN"}),e.jsx("div",{className:"value",children:a?.sn})]})]}),e.jsxs("div",{className:"basic-card-row",children:[e.jsxs("div",{className:"item",children:[e.jsx("div",{className:"label",children:"Brand"}),e.jsx("div",{className:"value",children:a?.brand})]}),e.jsxs("div",{className:"item",children:[e.jsx("div",{className:"label",children:"Brand Model"}),e.jsx("div",{className:"value",children:a?.brand_model})]})]}),e.jsx("div",{className:"basic-card-row",children:e.jsxs("div",{className:"item",children:[e.jsx("div",{className:"label",children:"V2G Support"}),e.jsx("div",{className:"value",children:a?.v2g_support})]})}),e.jsxs("div",{className:"time-row cp-time-row",children:[e.jsxs("div",{className:"item",children:[e.jsx("div",{className:"label",children:"Repair Schedule"}),e.jsxs("div",{className:"value",children:[e.jsx("div",{className:"sub-label",children:"Start:"}),e.jsx("div",{className:"sub-value",children:"2025-3-05"})]})]}),e.jsxs("div",{className:"item",children:[e.jsx("div",{className:"label",children:"Service Schedule"}),e.jsxs("div",{className:"value",children:[e.jsx("div",{className:"sub-label",children:"Start:"}),e.jsx("div",{className:"sub-value",children:"2025-3-06"})]})]})]}),e.jsxs("div",{className:"btns",children:[e.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm remote reset software?",onConfirm:me,children:e.jsx(t,{className:"baisc-btn",icon:e.jsx(l,{icon:"icon_software",size:"20"}),children:"Remote reset software"})}),e.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm remote reset hardware?",onConfirm:xe,children:e.jsx(t,{className:"baisc-btn ml-3",icon:e.jsx(l,{icon:"icon_hardware",size:"20"}),children:"Remote reset hardware"})}),e.jsx(pe,{customRequest:oe,showUploadList:!1,children:e.jsx(t,{className:"baisc-btn ml-3",icon:e.jsx(l,{icon:"icon_upload",size:"20"}),children:"Upgrade Firmware"})}),e.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm download log?",onConfirm:he,children:e.jsx(t,{className:"baisc-btn ml-3",icon:e.jsx(l,{icon:"icon_download",size:"20"}),children:"Download Log"})})]})]})}),e.jsx(D,{title:"Realtime Information",className:"realtime-card no-border",children:e.jsxs(M,{column:2,children:[e.jsx(M.Item,{span:2,label:"Charge Point Status",children:e.jsxs("div",{className:`status-item ml-3 ${a?.charge_point_status.toLowerCase()}`,children:[e.jsx("div",{className:"point"}),e.jsx("span",{children:a?.charge_point_status})]})}),e.jsx(M.Item,{span:2,children:e.jsx("div",{className:"flex w-full flex-col",children:e.jsxs("div",{className:"connector-wrapper",children:[a.connectors[0]&&e.jsxs("div",{className:"connector0",children:[e.jsx("div",{className:"part-title",children:a.connectors[0].name}),e.jsxs("div",{className:"part-subtitle",children:[e.jsx("div",{className:"label",children:"Connector Statusï¼š"}),e.jsx("div",{className:`status ${a.connectors[0].status.toLowerCase()}`,children:e.jsx("span",{children:a.connectors[0].status})})]}),$.map(s=>e.jsxs("div",{className:"level-wrapper",children:[e.jsx("div",{className:"part-title",children:s}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Time"}),e.jsx("span",{className:"value",children:v(m?.start_time).format("YYYY-MM-DD HH:mm:ss")})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Sequence"}),e.jsx("span",{className:"value",children:m?.sequence_no})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Transactionid"}),e.jsx("span",{className:"value",children:m?.transaction_id})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"SoC"}),e.jsx("span",{className:"value",children:d?.soc})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Power"}),e.jsxs("span",{className:"value",children:[m?.[`${s}Map`]?.power?.value,m?.[`${s}Map`]?.power?.unit]})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Current"}),e.jsxs("span",{className:"value",children:[m?.[`${s}Map`]?.current?.value,m?.[`${s}Map`]?.current?.unit]})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Energy"}),e.jsxs("span",{className:"value",children:[m?.[`${s}Map`]?.energy?.value,m?.[`${s}Map`]?.energy?.unit]})]}),s==="L1"&&I.length>1?e.jsxs("div",{className:"display-item collapse-item",children:[e.jsx("span",{className:"label"}),e.jsx("span",{className:"value",children:$.length===1?e.jsx(t,{type:"link",onClick:()=>q(0),icon:e.jsx(l,{icon:"Expand",size:"22"})}):e.jsx(t,{type:"link",onClick:()=>V(0),icon:e.jsx(l,{icon:"Collapse",size:"22"})})})]}):null]},s)),e.jsx("div",{className:"time-row connector-time-row",children:e.jsxs("div",{className:"item",children:[e.jsx("div",{className:"label",children:"Upcoming Charging Schedule "}),e.jsxs("div",{className:"bottom",children:[e.jsx("div",{className:`charge-label ${a.connectors[0].charge_mode}`,children:a.connectors[0].charge_mode==="charge_mode"?"Charge":"Discharge"}),e.jsxs("div",{className:"value",children:[e.jsx("div",{className:"sub-label",children:"Start:"}),e.jsx("div",{className:"sub-value",children:k[a.connectors[0].connector_id]?.start})]}),e.jsxs("div",{className:"value",children:[e.jsx("div",{className:"sub-label",children:"End:"}),e.jsx("div",{className:"sub-value",children:k[a.connectors[0].connector_id]?.end})]})]})]})}),e.jsxs("div",{className:`connector-btns ${a.connectors[0].charge_mode}`,children:[e.jsx("div",{className:"charge_mode_row",children:e.jsxs(u.Group,{className:"layout-switch",defaultValue:a.connectors[0].charge_mode,onChange:s=>R(s.target.value,a.connectors[0]),children:[e.jsx(u,{value:"charge_mode",children:"Charge Mode"}),e.jsx(u,{value:"discharge_mode",children:"Discharge Mode"})]})}),e.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm Stop?",onConfirm:()=>F(a.connectors[0]),children:e.jsx(t,{className:"detail-btn",type:"primary",icon:e.jsx(l,{icon:"Stop",size:"20"}),children:"Stop"})}),a.connectors[0].v2g_support==="V2G"?e.jsx(t,{className:"detail-btn",type:"primary",icon:e.jsx(l,{icon:"Start",size:"20"}),onClick:()=>Y(a.connectors[0]),children:e.jsx("span",{className:"btn",children:"Start"})}):e.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm start?",onConfirm:()=>U(a.connectors[0]),children:e.jsx(t,{className:"detail-btn",type:"primary",icon:e.jsx(l,{icon:"Start",size:"20"}),children:"Start"})}),e.jsx("div",{style:{width:"162px"}}),e.jsx(t,{className:"detail-btn",icon:e.jsx(l,{icon:"AStart",size:"20"}),onClick:()=>{E(a.connectors[0])},children:"Advanced Start"}),e.jsx(t,{className:"detail-btn",icon:e.jsx(l,{icon:"Set",size:"20"}),onClick:()=>{H(a.connectors[0])},children:"Set Profile"}),e.jsx(t,{style:{width:"204px"},icon:e.jsx(l,{icon:"Edit",size:"20"}),onClick:()=>{T(a.connectors[0])},children:"Edit Connector Status"})]})]},a.connectors[0].name),a.connectors[1]&&e.jsxs("div",{className:"connector1",children:[e.jsx("div",{className:"part-title",children:a.connectors[1].name}),e.jsxs("div",{className:"part-subtitle",children:[e.jsx("div",{className:"label",children:"Connector Statusï¼š"}),e.jsx("div",{className:`status ${a.connectors[1].status.toLowerCase()}`,children:e.jsx("span",{children:a.connectors[1].status})})]}),d&&O.map(s=>e.jsxs("div",{className:"level-wrapper",children:[e.jsx("div",{className:"part-title",children:s}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Time"}),e.jsx("span",{className:"value",children:v(d?.start_time).format("YYYY-MM-DD HH:mm:ss")})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Sequence"}),e.jsx("span",{className:"value",children:d?.sequence_no})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Transactionid"}),e.jsx("span",{className:"value",children:d?.transaction_id})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"SoC"}),e.jsx("span",{className:"value",children:d?.soc})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Power"}),e.jsxs("span",{className:"value",children:[d?.[`${s}Map`]?.power?.value,d?.[`${s}Map`]?.power?.unit]})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Current"}),e.jsxs("span",{className:"value",children:[d?.[`${s}Map`]?.current?.value,d?.[`${s}Map`]?.current?.unit]})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Energy"}),e.jsxs("span",{className:"value",children:[d?.[`${s}Map`]?.energy?.value,d?.[`${s}Map`]?.energy?.unit]})]}),s==="L1"&&K.length>1?e.jsxs("div",{className:"display-item collapse-item",children:[e.jsx("span",{className:"label"}),e.jsx("span",{className:"value",children:O.length===1?e.jsx(t,{type:"link",onClick:()=>q(1),icon:e.jsx(l,{icon:"Expand",size:"22"})}):e.jsx(t,{type:"link",onClick:()=>V(1),icon:e.jsx(l,{icon:"Collapse",size:"22"})})})]}):null]},s)),e.jsx("div",{className:"time-row connector-time-row",children:e.jsxs("div",{className:"item",children:[e.jsx("div",{className:"label",children:"Upcoming Charging Schedule "}),e.jsxs("div",{className:"bottom",children:[e.jsx("div",{className:`charge-label ${a.connectors[1].charge_mode}`,children:a.connectors[1].charge_mode==="charge_mode"?"Charge":"Discharge"}),e.jsxs("div",{className:"value",children:[e.jsx("div",{className:"sub-label",children:"Start:"}),e.jsx("div",{className:"sub-value",children:k[a.connectors[1].connector_id]?.start})]}),e.jsxs("div",{className:"value",children:[e.jsx("div",{className:"sub-label",children:"End:"}),e.jsx("div",{className:"sub-value",children:k[a.connectors[1].connector_id]?.end})]})]})]})}),e.jsxs("div",{className:`connector-btns ${a.connectors[1].charge_mode}`,children:[e.jsx("div",{className:"charge_mode_row",children:e.jsxs(u.Group,{className:"layout-switch",defaultValue:a.connectors[1].charge_mode,onChange:s=>R(s.target.value,a.connectors[1]),children:[e.jsx(u,{value:"charge_mode",children:"Charge Mode"}),e.jsx(u,{value:"discharge_mode",children:"Discharge Mode"})]})}),e.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm Stop?",onConfirm:()=>F(a.connectors[1]),children:e.jsx(t,{className:"detail-btn",type:"primary",icon:e.jsx(l,{icon:"Stop",size:"20"}),children:"Stop"})}),a.connectors[1].v2g_support==="V2G"?e.jsx(t,{className:"detail-btn",type:"primary",icon:e.jsx(l,{icon:"Start",size:"20"}),onClick:()=>Y(a.connectors[1]),children:e.jsx("span",{className:"btn",children:"Start"})}):e.jsx(p,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm start?",onConfirm:()=>U(a.connectors[1]),children:e.jsx(t,{className:"detail-btn",type:"primary",icon:e.jsx(l,{icon:"Start",size:"20"}),children:"Start"})}),e.jsx("div",{style:{width:"162px"}}),e.jsx(t,{className:"detail-btn",icon:e.jsx(l,{icon:"AStart",size:"20"}),onClick:()=>{E(a.connectors[1])},children:"Advanced Start"}),e.jsx(t,{className:"detail-btn",icon:e.jsx(l,{icon:"Set",size:"20"}),onClick:()=>{H(a.connectors[1])},children:"Set Profile"}),e.jsx(t,{style:{width:"204px"},icon:e.jsx(l,{icon:"Edit",size:"20"}),onClick:()=>{T(a.connectors[1])},children:"Edit Connector Status"})]})]},a.connectors[1].name)]})})})]})}),e.jsx(D,{title:"Statistics Graphs/Information (7 days)",className:"chart-card no-border",children:e.jsxs("div",{className:"chart-wrapper",children:[e.jsxs("div",{className:"chart-item",children:[e.jsx("div",{className:"chart-title",children:"Energy Consumption"}),e.jsx("div",{className:"chart-content",children:e.jsx(f,{width:"100%",height:200,children:e.jsxs(y,{data:G,children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"date"}),e.jsx(C,{}),e.jsx(g,{}),e.jsx(w,{}),e.jsx(N,{type:"monotone",dataKey:"energy",stroke:"#8884d8",name:"Charged Energy Per Day"})]})})})]}),e.jsxs("div",{className:"chart-item",children:[e.jsx("div",{className:"chart-title",children:"Charging Session Record"}),e.jsx("div",{className:"chart-content",children:e.jsx(f,{width:"100%",height:200,children:e.jsxs(y,{data:G,children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"date"}),e.jsx(C,{}),e.jsx(g,{}),e.jsx(w,{}),e.jsx(N,{type:"monotone",dataKey:"energy",stroke:"#8884d8",name:"Charged Energy Per Day"})]})})})]}),e.jsxs("div",{className:"chart-item",children:[e.jsx("div",{className:"chart-title",children:"Usage Record"}),e.jsx("div",{className:"chart-content",children:e.jsx(f,{width:"100%",height:200,children:e.jsxs(y,{data:te,children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"date"}),e.jsx(C,{}),e.jsx(g,{}),e.jsx(w,{}),e.jsx(N,{type:"monotone",dataKey:"session",stroke:"#82ca9d",name:"Num Of Charge Session Per Day"})]})})})]}),e.jsxs("div",{className:"chart-item",children:[e.jsx("div",{className:"chart-title",children:"Alert/Fault Record"}),e.jsx("div",{className:"chart-content",children:e.jsx(f,{width:"100%",height:200,children:e.jsxs(y,{data:re,children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"type"}),e.jsx(C,{}),e.jsx(g,{}),e.jsx(w,{}),e.jsx(N,{type:"monotone",dataKey:"num",stroke:"#ffc658",name:"Num Of Alert/Fault"})]})})})]}),e.jsxs("div",{className:"chart-item",children:[e.jsx("div",{className:"chart-title",children:"Online/Offline Record"}),e.jsx("div",{className:"chart-content",children:e.jsx(f,{width:"100%",height:200,children:e.jsxs(y,{data:de,children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"date"}),e.jsx(C,{}),e.jsx(g,{}),e.jsx(w,{}),e.jsx(N,{type:"monotone",dataKey:"online_num",stroke:"#8884d8",name:"Num Of Online Record Per Day"}),e.jsx(N,{type:"monotone",dataKey:"offline_num",stroke:"#82ca9d",name:"Num Of Offline Record Per Day"})]})})})]})]})})]})]})})}export{Se as default};

import{d as y,j as a,S as m}from"./index-D_a7UJeS.js";import{K as F,w as l,i as u,F as L,z as O,$ as R,s as U,O as h}from"./vendor-antd-BiNc4BQP.js";import{r as n}from"./vendor-react-DcqtUZ_G.js";import{c as A}from"./commonService-DDRzK25x.js";import{e as q}from"./options-DHqL16EA.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DcB4TerO.js";const K=i=>y.get({url:"/charge-sessions/",params:i}),B=i=>y.post({url:"/history-download/",data:i}),x={queryAll:K,download:B},{RangePicker:J}=R,{Option:Q}=l;function se(){const[i,c]=n.useState(1),[t,r]=n.useState({}),[f,d]=n.useState(0),[_,g]=n.useState([]),[j,w]=n.useState([]),[v,p]=n.useState(!1),[C,S]=n.useState(0),D=()=>{const e={...t};c(1),delete e.page,r(e),d(Date.now())},N=[{title:"Record ID",dataIndex:"id",key:"id"},{title:"Charge Point",dataIndex:"id_tag",key:"id_tag"},{title:"Start Time",dataIndex:"start_time",key:"start_time"},{title:"End Time",dataIndex:"end_time",key:"end_time"},{title:"Duration",dataIndex:"duration",key:"duration"},{title:"Energy Type",dataIndex:"session_mode",key:"session_mode"},{title:"Amount(Wh)",dataIndex:"amount",key:"amount"},{title:"User",dataIndex:"user",key:"user"}],b=e=>{c(e),r({...t,page:e}),d(Date.now())},k=()=>{r({}),c(1),d(Date.now())},Y=async()=>{const{detail:e}=await A.getUsers({num:100});g(e.results.map(s=>({name:`${s.first_name} ${s.last_name}`,phone:s.phone,email:s.email,user_id:s.user_id})))},I=async()=>{const e=await x.download({start_date:t.start_date,end_date:t.end_date,id_tag:t.id_tag,energy_type:t.energy_type,user_id:t.user_id});if(e.code===200&&(U.success(e.message),e.detail.url)){const s=document.createElement("a");s.download=e.detail.filename,s.style.display="none",s.href=e.detail.url,document.body.appendChild(s),s.click(),document.body.removeChild(s)}},M=e=>e.map(s=>{const o=parseFloat(s.duration),H=Math.floor(o/3600),T=Math.floor(o%3600/60),$=Math.floor(o%60),z=h().startOf("day").add(H,"hour").add(T,"minute").add($,"second").format("HH:mm:ss");return{...s,amount:s.cs_energy,user:`${s.user_firstname} ${s.user_lastname}`,session_mode:s.session_mode===1?"Charge":"Discharge",duration:z,start_time:h(s.cs_start_datetime).format("YYYY-MM-DD HH:mm:ss"),end_time:h(s.cs_end_datetime).format("YYYY-MM-DD HH:mm:ss")}}),P=async()=>{p(!0);const e=await x.queryAll(t),{results:s,count:o}=e.detail;w(M(s||[])),S(o),p(!1)},E=e=>{const s=new Date;return s.setHours(23,59,59,999),e&&e>s};return n.useEffect(()=>{P()},[f]),n.useEffect(()=>{Y(),d(Date.now())},[]),a.jsxs("div",{className:"main-content",children:[a.jsxs("div",{className:"search-area flex items-center justify-start",children:[a.jsxs("div",{className:"search-item",children:[a.jsx("div",{className:"label mb-2",children:"Time Range"}),a.jsx(J,{disabledDate:E,className:"w-full",format:"YYYY-MM-DD",onChange:(e,[s,o])=>{r({...t,start_date:s,end_date:o})}})]}),a.jsxs("div",{className:"search-item",children:[a.jsx("div",{className:"label mb-2",children:"Charge Point"}),a.jsx(F,{className:"w-full",placeholder:"Enter",onChange:e=>{r({...t,id_tag:e.target.value})}})]}),a.jsxs("div",{className:"search-item",children:[a.jsx("div",{className:"label",children:"Energy Type"}),a.jsx(l,{placeholder:"Select",allowClear:!0,style:{width:"210px"},onChange:e=>{r({...t,mode:e})},children:q.map(e=>a.jsx(l.Option,{value:e.value,children:e.label},e.value))})]}),a.jsxs("div",{className:"search-item",children:[a.jsx("div",{className:"label",children:"User"}),a.jsx(l,{className:"w-full",allowClear:!0,value:t.user_name,style:{width:"150px"},onChange:e=>{r({...t,user_name:e})},placeholder:"Select",children:_.map(e=>a.jsx(Q,{value:e.name,children:e.name},e.user_id))})]}),a.jsx("div",{className:"search-btn",children:a.jsx(u,{icon:a.jsx(m,{icon:"Search",size:"20"}),type:"primary",loading:v,onClick:D})}),a.jsx("div",{className:"search-btn clear",children:a.jsx(u,{icon:a.jsx(m,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:k})})]}),a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"operation-area flex items-center justify-start",children:[a.jsx("span",{className:"mr-4 font-bold",children:"Charge Point Record"}),a.jsx(u,{type:"primary",icon:a.jsx(m,{icon:"Download",size:"20",color:"#FF4747"}),onClick:I,children:"Download"})]})}),a.jsx(L,{columns:N,bordered:!0,rowKey:"id",pagination:!1,dataSource:j}),a.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:a.jsx(O,{total:C,current:i,showSizeChanger:!1,showQuickJumper:!0,onChange:b})})]})}export{se as default};

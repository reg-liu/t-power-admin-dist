import{j as e,S as w}from"./index-BPVsLZ7e.js";import{r as d}from"./vendor-react-BcJS7s_i.js";import{c as A}from"./cpMonitorService-Cx5PzkKd.js";import{E,i as h,o as M,x as p,j as B,H as C,O as S,s as v}from"./vendor-antd-B62eGpCx.js";import"./vendor-ui-DPkccqlC.js";import"./vendor-utils-CtEfXJzW.js";function W({visible:l,onCancel:g,connector:m,onConfirm:P}){const[u,x]=d.useState(!1),[o,s]=d.useState([{limit:"",startAfter:"",time:0}]),[f,j]=d.useState("current");d.useEffect(()=>{l||s([{limit:"",startAfter:"",time:0}])},[l]);const y=()=>{s([...o,{limit:"",startAfter:"",time:Date.now()}])},_=t=>{const a=o.filter((r,n)=>n!==t);s([...a])},N=(t,a)=>{const r=[...o],n=r.map((c,i)=>i===t?{...r[t]||{limit:"",startAfter:"",time:Date.now()},limit:a}:c);s(n)},I=(t,a)=>{const r=[...o],n=r.map((c,i)=>i===t?{...r[t]||{limit:"",startAfter:"",time:Date.now()},startAfter:a}:c);s(n)},k=t=>{x(t)},R=t=>{j(t),s([{limit:"",startAfter:"",time:Date.now()}])},b=async()=>{let t=!0;const a=o.map(i=>((i.limit===""||i.startAfter==="")&&(t=!1),{limit:i.limit,startPeriod:i.startAfter}));let r={charge_point_id:m.charge_point_id,connector_id:m.connector_id};if(u){if(!t||a.length===0){v.error("Please Input Limit and Start After");return}r={...r,mode:"default",charging_profile:{chargingProfileId:1,chargingProfileKind:"Relative",chargingProfilePurpose:"TxProfile",stackLevel:1,chargingSchedule:{chargingRateUnit:f==="current"?"A":"B",chargingSchedulePeriod:a}}}}const n=[r],c=await A.start({cp_id_connector_pairs:n});c?.code===200&&(v.success(c.message),P())},D=async()=>{(await A.getRealtimeInfo(m.charge_point_id,{connector_id:m.connector_id,action:"MeterValues"}))?.code};return d.useEffect(()=>{l&&(s([{limit:"",startAfter:"",time:Date.now()}]),x(!1),j("current"),D())},[l]),e.jsx(E,{title:"Advanced Start",open:l,onCancel:g,zIndex:1001,footer:[e.jsxs("div",{className:"footer-normal-btns",children:[e.jsx(h,{onClick:g,children:"Cancel"},"cancel"),e.jsx(h,{type:"primary",onClick:b,children:"Start"},"confirm")]},"start-footer")],width:500,children:e.jsxs("div",{className:"modal-form one-column",children:[e.jsxs("div",{className:"between-wrapper",children:[e.jsx("div",{className:"title",children:m?.name}),e.jsxs("div",{className:"switch",children:["With Charge Profile",e.jsx(M,{checked:u,onChange:k})]})]}),e.jsxs("div",{className:u?"mt-4":"pointer-events-none mt-4 opacity-50",children:[e.jsxs("div",{className:"between-wrapper",children:[e.jsxs(p.Group,{optionType:"button",value:f,onChange:t=>R(t.target.value),className:"my-4",children:[e.jsx(p.Button,{value:"current",children:"Current"}),e.jsx(p.Button,{value:"power",children:"Power"})]}),e.jsx(h,{type:"link",icon:e.jsx(w,{icon:"Add",size:"28"}),onClick:()=>y()})]}),e.jsx(B,{children:o.map((t,a)=>e.jsxs("div",{className:"advance-start-row",children:[e.jsx("div",{className:"close-row",children:e.jsx(h,{type:"link",onClick:()=>_(a),icon:e.jsx(w,{icon:"Close",size:"20",color:"#C3C3C3"})})}),e.jsxs("div",{className:"label-value-split ",children:[e.jsx(C.Item,{name:"limit",label:"Limit",rules:[{required:!0,message:f==="current"?"Current limit":"Power limit"}],children:e.jsx(S,{min:1,max:1e5,defaultValue:t.limit,placeholder:f==="current"?"Current limit":"Power limit",onChange:r=>N(a,r)})}),e.jsx(C.Item,{name:"startAfter",label:"Start After(Minutes)",rules:[{required:!0,message:"Start After"}],children:e.jsx(S,{min:1,max:1e5,placeholder:"Start After",defaultValue:t.startAfter,onChange:r=>I(a,r)})})]},a)]},`setting-${t.time}`))})]})]})})}export{W as default};

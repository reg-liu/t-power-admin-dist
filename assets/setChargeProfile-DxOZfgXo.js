import{j as e,S as u}from"./index-Bj4-Cj9m.js";import{r as n}from"./vendor-react-DcqtUZ_G.js";import{c as S}from"./cpMonitorService-CgsmQ05K.js";import{E as z,i as g,k as P,Q as x,x as _,j as B,H as N,s as j}from"./vendor-antd-DNjhvzFa.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DuhXCHR2.js";function K({visible:m,onCancel:A,connector:r,onConfirm:y}){const[o,l]=n.useState([{limit:"",startAfter:"",time:0}]),[v,I]=n.useState(),[f,b]=n.useState(),[M,w]=n.useState("Set Charge Profile"),[h,C]=n.useState("current");n.useEffect(()=>{m||l([{limit:"",startAfter:"",time:0}])},[m]);const R=()=>{l([...o,{limit:"",startAfter:"",time:Date.now()}])},V=t=>{const a=o.filter((s,i)=>i!==t);l([...a])},k=(t,a)=>{const s=[...o],i=s.map((d,c)=>c===t?{...s[t]||{limit:"",startAfter:"",time:Date.now()},limit:a}:d);l(i)},E=(t,a)=>{const s=[...o],i=s.map((d,c)=>c===t?{...s[t]||{limit:"",startAfter:"",time:Date.now()},startAfter:a}:d);l(i)},D=t=>{C(t),l([{limit:"",startAfter:"",time:Date.now()}])},T=async()=>{if(r.v2g_support==="V2G"&&!f){j.error("Please Enter Soc");return}let t=!0;const a=o.map(p=>((p.limit===""||p.startAfter==="")&&(t=!1),{limit:p.limit,startPeriod:p.startAfter*60}));if(!t||a.length===0){j.error("Please Input Limit and Start After");return}let s={max:.92};r.v2g_support==="V2G"&&(s=r?.charge_mode==="charge_mode"?{max:(f||0)/100}:{min:(f||0)/100});let i={charge_point_id:r.charge_point_id,connector_id:r.connector_id,transaction_id:v,mode:r?.charge_mode==="charge_mode"?"default":"v2g",soc:s};i={...i,cs_charging_profiles:{chargingProfileId:1,transaction_id:v,stackLevel:2,chargingProfilePurpose:"TxProfile",chargingProfileKind:"Relative",chargingSchedule:{chargingRateUnit:h==="current"?"A":"B",chargingSchedulePeriod:a}}};const d=[i],c=await S.setChargingProfile({charge_profiles:d});c?.code===200&&(j.success(c.message),y())},L=async()=>{const t=await S.getRealtimeInfo(r.charge_point_id,{connector_id:r.connector_id,action:"MeterValues"});I(t.detail.transaction_id)};return n.useEffect(()=>{m&&(l([{limit:"",startAfter:"",time:Date.now()}]),C("current"),L(),r?.v2g_support==="V2G"&&(r?.charge_mode==="charge_mode"?w("Set Charge Profile"):w("Set Discharge Profile")))},[m]),e.jsx(z,{title:M,open:m,onCancel:A,zIndex:1001,footer:[e.jsxs("div",{className:`footer-normal-btns ${r?.charge_mode}_form`,children:[e.jsx(g,{onClick:A,children:"Cancel"},"cancel"),e.jsx(g,{type:"primary",onClick:T,children:"Confirm"},"confirm")]},"set-charge-footer")],width:500,children:e.jsxs("div",{className:`modal-form one-column ${r?.charge_mode}_form`,children:[e.jsx("div",{className:"between-wrapper",children:e.jsx("div",{className:"title",children:r?.name})}),r?.v2g_support==="V2G"&&e.jsxs("div",{className:"soc-wrapper label-value-split mt-2",children:[e.jsx("label",{children:r?.charge_mode==="charge_mode"?e.jsxs("div",{className:"icon-label",children:[e.jsx("span",{children:"Max Soc(%)"}),e.jsx(P,{title:"Maximum Charge Limit Is 95%",placement:"top",children:e.jsx("span",{className:"svg-wrapper",children:e.jsx(u,{className:"ml-1",icon:"Help",size:"20"})})})]}):e.jsxs("div",{className:"icon-label",children:[e.jsx("span",{children:"Min Soc(%)"}),e.jsx(P,{title:"Minimum Discharge Limit Is 20%",placement:"top",children:e.jsx("span",{children:e.jsx(u,{className:"ml-1",icon:"Help",size:"20"})})})]})}),e.jsx(x,{min:r?.charge_mode==="charge_mode"?1:20,max:r?.charge_mode==="charge_mode"?95:1e4,placeholder:"Enter",onChange:t=>b(t)})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"between-wrapper",children:[e.jsxs(_.Group,{optionType:"button",value:h,onChange:t=>D(t.target.value),className:"my-4",children:[e.jsx(_.Button,{value:"current",children:"Current"}),e.jsx(_.Button,{value:"power",children:"Power"})]}),e.jsx(g,{type:"link",icon:e.jsx(u,{icon:r?.charge_mode==="discharge_mode"?"Add2":"Add",color:r?.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",size:"28"}),onClick:()=>R()})]}),e.jsx(B,{children:o.map((t,a)=>e.jsxs("div",{className:"advance-start-row",children:[e.jsx("div",{className:"close-row",children:e.jsx(g,{type:"link",onClick:()=>V(a),icon:e.jsx(u,{icon:"Close",size:"20",color:"#C3C3C3"})})}),e.jsxs("div",{className:"label-value-split ",children:[e.jsx(N.Item,{name:"limit",label:"Limit",rules:[{required:!0,message:h==="current"?"Current limit":"Power limit"}],children:e.jsx(x,{min:1,max:1e5,defaultValue:t.limit,placeholder:h==="current"?"Current limit":"Power limit",onChange:s=>k(a,s)})}),e.jsx(N.Item,{name:"startAfter",label:"Start After(Minutes)",rules:[{required:!0,message:"Start After"}],children:e.jsx(x,{min:1,max:1e5,placeholder:"Start After",defaultValue:t.startAfter,onChange:s=>E(a,s)})})]},a)]},`setting-${t.time}`))})]})]})})}export{K as default};

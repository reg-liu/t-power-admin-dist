import{j as e,S as r,f as D}from"./index-D6b1pHay.js";import{r as a}from"./vendor-react-DcqtUZ_G.js";import{c as M}from"./commonService-Cazkjq9B.js";import{c as L}from"./cpUserManagementService-CnXNT7d8.js";import{c as ce}from"./chargepoint-wPlJlVYc.js";import re from"./addChargepoint-Cg-tB588.js";import de from"./chargepointUserDetail-u_Cwq0gw.js";import me from"./editLocation-Dj7SnaX5.js";import ue from"./unbindUser-CCxtzCP3.js";import{K as pe,w as b,i as l,x as _,P as f,F as he,y as P,j as xe,I as je,k as _e,z as fe,s as ge}from"./vendor-antd-BiNc4BQP.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DcB4TerO.js";import"./index-CIHbDLlH.js";import"./index.modern-DDXp5BPH.js";import"./vendor-charts-CCrp_OZH.js";import"./index-DcX75npX.js";const{Option:g}=b;function Be(){const[c,d]=a.useState({page:1}),[T,o]=a.useState(0),[z,B]=a.useState(null),[h,V]=a.useState("id_tag"),[v,E]=a.useState([]),[m,R]=a.useState([]),[A,K]=a.useState(0),[O,C]=a.useState(!1),[y,q]=a.useState("list"),[i,p]=a.useState([]),[F,w]=a.useState(!1),[G,N]=a.useState(!1),[J,S]=a.useState(!1);a.useState(!1);const[Q,k]=a.useState(!1),$=s=>{B(s),w(!0)},H=[{title:"Charge Point",dataIndex:"id_tag",key:"id_tag",className:"bold",render:(s,t)=>e.jsx(l,{type:"link",onClick:()=>$(t),children:s})},{title:"User",dataIndex:"user",key:"user"},{title:"Location",dataIndex:"location",key:"location",render:s=>e.jsx("div",{className:"display-row location",children:e.jsx("div",{className:"row-item",children:`${s?.cp_address||""} ${s?.cp_suburb||""} ${s?.cp_state||""} ${s?.cp_postcode||""}`})})},{title:"Operation",width:"140px",key:"operation",render:(s,t)=>e.jsx("div",{className:"operations",children:e.jsx(f,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm unbind?",onConfirm:()=>x(t.id),children:e.jsx(l,{type:"link",icon:e.jsx(r,{icon:"Unbind",size:"20"}),children:"Unbind"})})})}],W=()=>{S(!0)},X={selectedRowKeys:i,onChange:s=>{p(s)}},Y=e.jsxs(b,{value:h,onChange:V,style:{width:156},children:[e.jsx(g,{value:"id_tag",children:"Charge Point"}),e.jsx(g,{value:"sn",children:"SN"})]}),Z=()=>{i.length===m.length?p([]):p(m.map(s=>s.key))},x=async s=>{try{const t=await L.unbind({charge_point_user_ids:s?[s]:i});t?.code===200&&(ge.success(t.message),o(Date.now()))}catch{}},ee=()=>{const s={...c};delete s.page,d(s),o(Date.now())},se=s=>{d({...c,page:s}),o(Date.now())},te=async()=>{const{detail:s}=await M.getUsers({num:100});E(s.results.map(t=>({name:`${t.first_name} ${t.last_name}`,phone:t.phone,email:t.email,user_id:t.user_id})))},ae=s=>s.map(t=>{const{id:u,first_name:j,last_name:oe,charge_point:U}=t,{charge_point_detail:I,brand_model:n,sn:le}=U;return{id:u,user:`${j} ${oe}`,picture:n.picture,location:I,latlng:I?.latlng,key:`${t.id}${M.rowKeySplit}${t.charge_point_id}`,sn:le,id_tag:U.id_tag,brand:n.brand,brand_model:n.brand_model,charge_model:n.charge_model,connector_no:n.connector_no,ocpp:n.ocpp,phase:n.phase,out_current_max:parseInt(`${n.out_current_max}`,10),out_current_min:parseInt(`${n.out_current_min}`,10),out_power_max:parseInt(`${n.out_power_max}`,10),out_power_min:parseInt(`${n.out_power_min}`,10),out_voltage_max:parseInt(`${n.out_voltage_max}`,10),out_voltage_min:parseInt(`${n.out_voltage_min}`,10),connector_type:n.charge_model==="AC"?"ac - type2":"dc - ccs2"}}),ne=()=>{d({}),o(Date.now())},ie=async()=>{C(!0);const s=await L.queryAll(c),{results:t,count:u}=s.detail;R(ae(t||[])),K(u),C(!1)};return a.useEffect(()=>{ie()},[T]),a.useEffect(()=>{te(),o(Date.now())},[]),e.jsxs("div",{className:"main-content",children:[e.jsxs("div",{className:"search-area flex items-center justify-start",children:[e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:" "}),e.jsx(pe,{addonBefore:Y,placeholder:"Enter",style:{width:"360px"},allowClear:!0,value:c[h],onChange:s=>{let t={...c};delete t.id_tag,delete t.sn,t={...t,[h]:s.target.value},d(t)}})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"User"}),e.jsx(b,{className:"w-full",allowClear:!0,value:c.user_id,style:{width:"150px"},onChange:s=>{d({...c,user_id:s})},placeholder:"Select",children:v.map(s=>e.jsx(g,{value:s.user_id,children:s.name},s.name))})]}),e.jsx("div",{className:"search-btn",children:e.jsx(l,{icon:e.jsx(r,{icon:"Search",size:"20"}),type:"primary",loading:O,onClick:ee})}),e.jsx("div",{className:"search-btn clear",children:e.jsx(l,{icon:e.jsx(r,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:ne})})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"operation-area flex items-center justify-start",children:[e.jsxs(_.Group,{className:"layout-switch",value:y,onChange:s=>q(s.target.value),children:[e.jsx(_.Button,{value:"list",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(D,{icon:"mynaui:list",size:20}),"List"]})}),e.jsx(_.Button,{value:"grid",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(D,{icon:"proicons:grid",size:20}),"Grid"]})})]}),e.jsx(l,{icon:e.jsx(r,{icon:"Bind",size:"20"}),type:"primary",onClick:W,className:"ml-3 mr-3",children:"Bind User and Charge Point"}),e.jsx(f,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm unbind?",onConfirm:()=>x(),children:e.jsx(l,{disabled:i.length===0,className:"ml-3",icon:e.jsx(r,{icon:"Unbind",size:"20",color:i.length===0?"#999":"currentColor"}),children:"Bulk Unbind"})})]})}),y==="list"?e.jsx(he,{rowSelection:X,rowKey:"id",columns:H,bordered:!0,dataSource:m,pagination:!1}):e.jsxs("div",{className:"grid-wrapper",children:[e.jsx(P,{className:"check-all",checked:m.length===i.length,onChange:Z}),e.jsx("div",{className:"grid",children:m.map(s=>e.jsx("div",{className:"grid-item",children:e.jsxs(xe,{children:[e.jsxs("div",{className:"grid-top with-image flex items-center",children:[e.jsx(P,{checked:i.includes(s.id),onChange:t=>{const u=t.target.checked?[...i,s.id]:i.filter(j=>j!==s.id);p(u)}}),e.jsx(je,{src:ce,preview:!1,height:184,className:"entity-image object-cover"})]}),e.jsxs("div",{className:"grid-bottom",children:[e.jsx("div",{className:"display-item",children:e.jsx(l,{type:"link",className:"detail-link",onClick:()=>{$(s)},children:s.id_tag})}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label bold",children:"User:"})," ",e.jsx("span",{className:"value",children:e.jsx("div",{children:e.jsx("div",{children:s.user})})})]}),e.jsxs("div",{className:"display-item location",children:[e.jsx("span",{className:"label",children:"Location:"})," ",e.jsx("span",{className:"value",children:e.jsx(_e,{placement:"topLeft",title:`${s.location?.cp_address} ${s.location?.cp_suburb} ${s.location?.cp_state} ${s.location?.cp_postcode}`,children:e.jsx("span",{className:"truncated-text mr-1",children:`${s.location?.cp_address} ${s.location?.cp_suburb} ${s.location?.cp_state} ${s.location?.cp_postcode}`})})})]}),e.jsx("div",{className:"operation-rows",children:e.jsx(f,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm unbind?",onConfirm:()=>x(s.id),children:e.jsx(l,{type:"link",icon:e.jsx(r,{icon:"Unbind",size:"20"}),children:"Unbind"})})})]})]},s.id)}))})]}),e.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:e.jsx(fe,{total:A,showQuickJumper:!0,onChange:se})}),e.jsx(de,{record:z,visible:F,onClose:()=>{w(!1),o(Date.now())}}),e.jsx(me,{visible:G,onCancel:()=>N(!1),onConfirm:()=>{N(!1),o(Date.now())}}),e.jsx(re,{visible:J,users:v,onCancel:()=>S(!1),onConfirm:()=>{o(Date.now())}}),e.jsx(ue,{visible:Q,onCancel:()=>k(!1),onConfirm:()=>k(!1)})]})}export{Be as default};

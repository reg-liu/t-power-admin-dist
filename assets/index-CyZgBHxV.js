import{g as T,j as e,S as c,f as V}from"./index-DGG3uvmK.js";import{r as l}from"./vendor-react-BcJS7s_i.js";import{c as M}from"./commonService-BLSpsRcW.js";import{c as ye}from"./chargepoint-wPlJlVYc.js";import Se from"./detail-79VlPq8G.js";import ve from"./editConnector-DtAYk215.js";import be from"./setChargeProfile-CNvIdquO.js";import Ne from"./start-qTVv-Msg.js";import{F as N,i as r,K as ke,w as p,x as I,P as C,y as O,j as we,I as _e,D as A,z as Ee,s as Be}from"./vendor-antd-B62eGpCx.js";import"./vendor-ui-DPkccqlC.js";import"./vendor-utils-CtEfXJzW.js";import"./LineChart-BAumMwBz.js";import"./isEqual-Hc_6Fhhx.js";import"./vendor-charts-Cv5x1InZ.js";import"./index-Dj133iwh.js";const Me=i=>T.get({url:"/charge-points/",params:i}),Ie=()=>"TODO",Oe=i=>T.post({url:"/remote-get-log/",data:i}),Te=()=>"TODO",De=()=>T.get({url:"/charge-point-full-status/"}),F={queryAll:Me,queryById:Ie,downloadLog:Oe,upgradeFireware:Te,getStatus:De},{Option:k}=p,U={1:"Online",2:"Offline",3:"Unknown"},q={1:"Available",2:"Unavailable",3:"Preparing",4:"Starting",5:"Stopping",6:"Charging",7:"Suspended EV",8:"Suspended EVSE",9:"Finishing",10:"Reserved",11:"Faulted",12:"Unknown"};function Xe(){const[i,u]=l.useState({}),[f,G]=l.useState("name"),[d,D]=l.useState([]),[m,w]=l.useState([]),[z,H]=l.useState("list"),[J,g]=l.useState(!1),[Q,y]=l.useState(!1),[X,_]=l.useState(!1),[W,S]=l.useState(!1),[Y,K]=l.useState(null),[E,Z]=l.useState(null),[ee,$]=l.useState([]),[x,se]=l.useState([]),[te,ae]=l.useState(0),[ne,v]=l.useState(0),[P,le]=l.useState({}),[L,ie]=l.useState(null);l.useEffect(()=>{const s=x.filter(t=>d.includes(t.key)).flatMap(t=>t.connectors.map(a=>a.key));w(s)},[d]);const j=s=>{},B=s=>{D(s)},oe=s=>{w(s)},re=()=>{d.length===x.length?B([]):B(x.map(s=>s.key))},ce=()=>{E?.status==="Charging"?g(!0):Be.error("Only the Connector in Charging state supports this operation.")},de=[N.SELECTION_COLUMN,N.EXPAND_COLUMN,{title:"Charge Point",dataIndex:"id_tag",className:"bold",key:"id_tag",render:(s,t)=>e.jsx(r,{type:"link",onClick:()=>{K(t),_(!0)},children:s})},{title:"Status",dataIndex:"charge_point_status",key:"charge_point_status",render:s=>e.jsxs("div",{className:`status-item ${s.toLowerCase()}`,children:[e.jsx("div",{className:"point"}),e.jsx("span",{children:s})]})},{title:"SN",dataIndex:"sn",key:"sn"},{title:"Brand",dataIndex:"brand",key:"brand"},{title:"Brand Model",dataIndex:"brand_model",key:"brand_model"}],R=[{key:"0",label:e.jsx(r,{type:"link",className:" operation-row-item",icon:e.jsx(c,{icon:"AStart",size:"20"}),onClick:()=>S(!0),children:"Advance Start"})},{key:"1",label:e.jsx(r,{type:"link",icon:e.jsx(c,{icon:"Set",size:"20"}),onClick:()=>ce(),children:"Set Charge Profile"})},{key:"2",label:e.jsx(r,{type:"link",icon:e.jsx(c,{icon:"Edit",size:"20"}),onClick:()=>y(!0),children:"Edit Connector Status"})}],me=s=>{const t=[{title:"ID",className:"bold",width:"210px",dataIndex:"name",key:"name"},{title:"Status",width:"240px",dataIndex:"status",key:"status",render:a=>e.jsx("div",{className:`status ${a.toLowerCase()}`,children:e.jsx("span",{children:a})})},{title:"Operation",width:"340px",key:"operation",render:(a,o)=>e.jsxs("div",{className:"operations end",children:[e.jsx(C,{title:"Confirm start?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>j(),children:e.jsx(r,{type:"link",icon:e.jsx(c,{icon:"Start",size:"20"}),children:"Start"})}),e.jsx(C,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm stop?",onConfirm:()=>j(),children:e.jsx(r,{type:"link",icon:e.jsx(c,{icon:"Stop",size:"20"}),children:"Stop"})}),e.jsx(A,{menu:{items:R},trigger:["click"],children:e.jsx("div",{children:e.jsx(r,{onClick:()=>Z(o),type:"link",icon:e.jsx(c,{icon:"Ellipsis",size:"20"})})})})]})}];return e.jsx(N,{columns:t,showHeader:!1,dataSource:s.connectors,pagination:!1,rowKey:"key",bordered:!0,rowSelection:{selectedRowKeys:m,onChange:oe}})},he=e.jsxs(p,{value:f,onChange:G,style:{width:156},children:[e.jsx(k,{value:"name",children:"Charge Point"}),e.jsx(k,{value:"sn",children:"SN"})]}),pe=s=>{const{expanded:t,onExpand:a,record:o}=s;return e.jsx("span",{onClick:n=>a(o,n),children:e.jsx(c,{icon:t?"Down":"Right",size:"17",color:"#d9d9d9",style:{marginTop:"-2px"}})})},ue=()=>{v(Date.now())},xe=s=>{u({...i,page:s}),v(Date.now())},je=async()=>{const{detail:s}=await M.getBrands(),t={},a={};s.forEach(o=>{t[o.brand]=o.id;const n=[];o.chargepointbrandmodel_set.forEach(h=>{n.push(h.brand_model)}),a[o.brand]=n}),ie(t),le(a)},Ce=(s,t)=>{const a={},o={0:"Connector A",1:"Connector B",2:"Connector C",3:"Connector D",4:"Connector E",5:"Connector F",6:"Connector G",7:"Connector H",8:"Connector I",9:"Connector J"};return t.forEach(n=>{a[n.charge_point_id]={charge_point_status:U[n.charge_point_status],connector_statuses:n.connector_statuses.map((h,b)=>({key:`${h.connector_id}${M.rowKeySplit}${b}`,name:o[`${b}`],connector_id:h.connector_id,status:q[h.status]}))}}),s.map(n=>({key:`${n.id}${M.rowKeySplit}${n.id_tag}`,id:n.id,id_tag:n.id_tag,sn:n.sn,brand:n.brand_model.brand,brand_model:n.brand_model.brand_model,charge_point_status:a[n.id].charge_point_status,picture:n.brand_model.picture,connectors:a[n.id].connector_statuses}))},fe=()=>{u({}),v(Date.now())},ge=async()=>{const s={...i};L&&(s.brand_id=L[s.brand],delete s.brand,s.brand_model||delete s.brand_model);const t=await F.queryAll(s),{results:a,count:o}=t.detail,n=await F.getStatus(),h=Ce(a||[],n.detail.results);se(h),$(h.map(b=>b.key)),ae(o)};return l.useEffect(()=>{ge()},[ne]),l.useEffect(()=>{je(),v(Date.now())},[]),e.jsxs("div",{className:"main-content",children:[e.jsxs("div",{className:"search-area flex items-center justify-start",children:[e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Enter"}),e.jsx(ke,{addonBefore:he,placeholder:f==="name"?"Charge Point":"SN",allowClear:!0,value:i[f],onChange:s=>u({...i,[f]:s.target.value})})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Brand"}),e.jsx(p,{className:"w-full",placeholder:"Brand",allowClear:!0,value:i.brand,style:{width:"150px"},onChange:s=>{u({...i,brand:s,brand_model:void 0})},children:Object.keys(P).map(s=>e.jsx(p.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Brand Model"}),e.jsx(p,{className:"w-full",allowClear:!0,disabled:!i.brand,placeholder:"Brand Model",style:{width:"160px"},value:i.brand_model,onChange:s=>u({...i,brand_model:s}),children:i.brand&&P[i.brand].map(s=>e.jsx(p.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Charge Point Status"}),e.jsx(p,{className:"w-full",style:{width:"210px"},allowClear:!0,value:i.charge_point_status,placeholder:"Charge Point Status",onChange:s=>u({...i,charge_point_status:s}),children:Object.entries(U).map(([s,t])=>e.jsx(k,{value:s,children:`${t}`}))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Connector Status"}),e.jsx(p,{className:"w-full",style:{width:"190px"},allowClear:!0,placeholder:"Connector Status",value:i.connector_status,onChange:s=>u({...i,connector_status:s}),children:Object.entries(q).map(([s,t])=>e.jsx(k,{value:s,children:`${t}`}))})]}),e.jsx("div",{className:"search-btn",children:e.jsx(r,{icon:e.jsx(c,{icon:"Search",size:"20"}),type:"primary",onClick:ue})}),e.jsx("div",{className:"search-btn clear",children:e.jsx(r,{icon:e.jsx(c,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:fe})})]}),e.jsxs("div",{className:"operation-area flex items-center justify-start",children:[e.jsxs(I.Group,{className:"layout-switch",value:z,onChange:s=>H(s.target.value),children:[e.jsx(I.Button,{value:"list",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(V,{icon:"mynaui:list",size:20}),"List"]})}),e.jsx(I.Button,{value:"grid",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(V,{icon:"proicons:grid",size:20}),"Grid"]})})]}),e.jsx(C,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm Start?",onConfirm:()=>j(),children:e.jsx(r,{className:"ml-3 mr-3",disabled:m.length===0,icon:e.jsx(c,{icon:"Start",size:"20",color:m.length===0?"#999":"currentColor"}),children:"Bulk Start"})}),e.jsx(C,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm stop?",onConfirm:()=>j(),children:e.jsx(r,{disabled:m.length===0,className:"mr-3",icon:e.jsx(c,{color:m.length===0?"#999":"currentColor",icon:"Stop",size:"20"}),children:"Bulk Stop"})})]}),z==="list"?e.jsx(N,{columns:de,dataSource:x,rowHoverable:!1,bordered:!0,rowKey:"key",pagination:!1,expandable:{expandedRowRender:me,expandIcon:pe,expandedRowKeys:ee,onExpand:(s,t)=>{$(a=>s?[...a,t.key]:a.filter(o=>o!==t.key))}},rowSelection:{selectedRowKeys:d,onChange:B}}):e.jsxs("div",{className:"grid-wrapper",children:[e.jsx(O,{className:"check-all",checked:x.length===d.length,onChange:re}),e.jsx("div",{className:"grid",children:x.map(s=>e.jsx("div",{className:"grid-item",children:e.jsxs(we,{children:[e.jsxs("div",{className:"grid-top with-image flex items-center",children:[e.jsx(O,{checked:d.includes(s.key),onChange:t=>{const a=t.target.checked?[...d,s.key]:d.filter(o=>o!==s.key);D(a)}}),e.jsx(_e,{src:ye,preview:!1,height:184,className:"entity-image object-cover"})]}),e.jsxs("div",{className:"grid-bottom monitor-bottom",children:[e.jsx("div",{className:"display-item",children:e.jsx(r,{type:"link",className:"detail-link",onClick:()=>{K(s),_(!0)},children:s.name})}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Status:"})," ",e.jsx("span",{className:"value",children:e.jsxs("div",{className:`status-item ${s.charge_point_status.toLowerCase()}`,children:[e.jsx("div",{className:"point"}),e.jsx("span",{children:s.charge_point_status})]})})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"SN:"})," ",e.jsx("span",{className:"value",children:s.sn})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand:"})," ",e.jsx("span",{className:"value",children:s.brand})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand Model:"})," ",e.jsx("span",{className:"value",children:s.brand_model})]}),s.charge_point_status!=="Offline"&&e.jsx("div",{className:"display-item  !mb-0 flex-col !items-start gap-2 !px-0",children:s.connectors.map(t=>e.jsxs("div",{className:"connector-wrapper w-full",children:[e.jsxs("div",{className:"connectors",children:[e.jsx(O,{checked:m.includes(t.key),onChange:a=>{const o=a.target.checked?[...m,t.key]:m.filter(n=>n!==t.key);w(o)}}),e.jsx("div",{className:"items flex-auto",children:e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:t.name})," ",e.jsx("span",{className:`value status ${t.status.toLowerCase()}`,children:t.status})]})})]}),e.jsx("div",{className:"operation-columns",children:e.jsxs("div",{className:"operation-row",children:[e.jsx(C,{title:"Confirm start?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>j(),children:e.jsx(r,{type:"link",className:" operation-row-item",icon:e.jsx(c,{icon:"Start",size:"20"}),children:"Start"})}),e.jsx("div",{className:"split"}),e.jsx(C,{title:"Confirm stop?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>j(),children:e.jsx(r,{className:"operation-row-item",type:"link",icon:e.jsx(c,{icon:"Stop",size:"20"}),children:"Stop"})}),e.jsx("div",{className:"split"}),e.jsx(A,{menu:{items:R},children:e.jsx("div",{className:"operation-row-item",children:e.jsx(r,{type:"link",icon:e.jsx(c,{icon:"Ellipsis",size:"20"})})})})]})})]},t.key))})]})]},s.key)}))})]}),e.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:e.jsx(Ee,{total:te,showQuickJumper:!0,onChange:xe})}),e.jsx(be,{visible:J,connector:E,onCancel:()=>g(!1),onConfirm:()=>{g(!1)}}),e.jsx(ve,{visible:Q,onCancel:()=>y(!1),onConfirm:s=>{y(!1)}}),X?e.jsx(Se,{onCancel:()=>_(!1),chargePoint:Y,onStart:()=>S(!0),onSetChargeProfile:()=>g(!0),onEditConnector:()=>y(!0)}):null,e.jsx(Ne,{visible:W,connector:E,onCancel:()=>S(!1),onConfirm:()=>{S(!1)}})]})}export{Xe as default};

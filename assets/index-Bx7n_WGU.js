import{g as x,j as e,S as d}from"./index-PVkWanS8.js";import{K as E,w as i,i as m,F as P,z as M,a1 as T,s as $,O as u}from"./vendor-antd-DmtkV1Ch.js";import{r as n}from"./vendor-react-BcJS7s_i.js";import{c as F}from"./commonService-DKHWxMZS.js";import{e as R}from"./options-BdxPQc9L.js";import"./vendor-ui-DPkccqlC.js";import"./vendor-utils-BKiv1F2M.js";const U=t=>x.get({url:"/charge-sessions/",params:t}),z=t=>x.post({url:"/statements/",data:t}),h={queryAll:U,download:z},{RangePicker:A}=T,{Option:H}=i;function V(){const[t,r]=n.useState({}),[p,o]=n.useState(0),[y,j]=n.useState([]),[_,f]=n.useState([]),[g,l]=n.useState(!1),[v,w]=n.useState(0),C=()=>{l(!0)},N=[{title:"Record ID",dataIndex:"id",key:"id"},{title:"Charge Point",dataIndex:"id_tag",key:"id_tag"},{title:"Start Time",dataIndex:"start_time",key:"start_time"},{title:"End Time",dataIndex:"end_time",key:"end_time"},{title:"Duration",dataIndex:"duration",key:"duration"},{title:"Energy Type",dataIndex:"session_mode",key:"session_mode"},{title:"Amount(kWh)",dataIndex:"amount",key:"amount"},{title:"User",dataIndex:"user",key:"user"}],S=a=>{r({...t,page:a}),o(Date.now())},k=()=>{r({}),o(Date.now())},D=async()=>{const{detail:a}=await F.getUsers({num:100});j(a.results.map(s=>({name:`${s.first_name} ${s.last_name}`,phone:s.phone,email:s.email,user_id:s.user_id})))},b=async()=>{const a=await h.download({start_date:t.start_date,end_date:t.end_date});if(a.code===200&&($.success(a.message),a.detail.url)){const s=document.createElement("a");s.download="",s.style.display="none",s.href=a.detail.url,document.body.appendChild(s),s.click(),document.body.removeChild(s)}},Y=a=>a.map(s=>({...s,amount:s.cs_energy,user:`${s.user_firstname} ${s.user_lastname}`,session_mode:s.session_mode===1?"Charge":"Discharge",duration:`${Number(s.duration).toFixed(2)}h`,start_time:u(s.cs_start_datetime).format("YYYY-MM-DD HH:mm:ss"),end_time:u(s.cs_end_datetime).format("YYYY-MM-DD HH:mm:ss")})),I=async()=>{l(!0);const a=await h.queryAll(t),{results:s,count:c}=a.detail;f(Y(s||[])),w(c),l(!1)};return n.useEffect(()=>{I()},[p]),n.useEffect(()=>{D(),o(Date.now())},[]),e.jsxs("div",{className:"main-content",children:[e.jsxs("div",{className:"search-area flex items-center justify-start",children:[e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"mb-2",children:"Time Range"}),e.jsx(A,{className:"w-full",format:"YYYY-MM-DD",onChange:(a,[s,c])=>{r({...t,start_date:s,end_date:c})}})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"mb-2",children:"Charge Point"}),e.jsx(E,{className:"w-full",placeholder:"Enter",onChange:a=>{r({...t,id_tag:a.target.value})}})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Energy Type"}),e.jsx(i,{placeholder:"Select",allowClear:!0,style:{width:"210px"},onChange:a=>r({...t,energe_type:a}),children:R.map(a=>e.jsx(i.Option,{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"User"}),e.jsx(i,{className:"w-full",allowClear:!0,value:t.user_id,style:{width:"150px"},onChange:a=>{r({...t,user_id:a})},placeholder:"Select",children:y.map(a=>e.jsx(H,{value:a.user_id,children:a.name},a.user_id))})]}),e.jsx("div",{className:"search-btn",children:e.jsx(m,{icon:e.jsx(d,{icon:"Search",size:"20"}),type:"primary",loading:g,onClick:C})}),e.jsx("div",{className:"search-btn clear",children:e.jsx(m,{icon:e.jsx(d,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:k})})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"operation-area flex items-center justify-start",children:[e.jsx("span",{className:"mr-4 font-bold",children:"Charge Point Record"}),e.jsx(m,{type:"primary",icon:e.jsx(d,{icon:"Download",size:"20",color:"#FF4747"}),onClick:b,children:"Download"})]})}),e.jsx(P,{columns:N,bordered:!0,rowKey:"key",pagination:!1,dataSource:_}),e.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:e.jsx(M,{total:v,showQuickJumper:!0,onChange:S})})]})}export{V as default};

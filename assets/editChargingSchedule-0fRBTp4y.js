import{j as e,S as p}from"./index-Z7dEZYu4.js";import{r as l}from"./vendor-react-DcqtUZ_G.js";import{c as z}from"./cpMonitorService-jOLq67KX.js";import{b as K,r as F}from"./options-MDMYukvs.js";import{H as a,E as W,i as x,K as $,w as c,k as S,Q as g,$ as b,o as G,x as f,j as Q,s as A}from"./vendor-antd-BiNc4BQP.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DcB4TerO.js";function le({visible:j,onCancel:v,record:N,onConfirm:I}){const[P]=a.useForm(),[w,y]=l.useState(!1),[U,M]=l.useState(null),[J,_]=l.useState(null),[d,m]=l.useState([{limit:"",startAfter:"",time:0}]),[h,D]=l.useState("current"),[C,T]=l.useState(!0),[k,E]=l.useState(),[n,V]=l.useState("charge_mode"),Y=()=>{T(!0),m([...d,{limit:"",startAfter:"",time:Date.now()}])},q=t=>{y(t)},H=t=>{D(t),m([{limit:"",startAfter:"",time:Date.now()}])},R=t=>{const s=d.filter((r,o)=>o!==t);m([...s])},L=(t,s)=>{const r=[...d],o=r.map((u,i)=>i===t?{...r[t]||{limit:"",startAfter:"",time:Date.now()},limit:s}:u);m(o)},O=(t,s)=>{const r=[...d],o=r.map((u,i)=>i===t?{...r[t]||{limit:"",startAfter:"",time:Date.now()},startAfter:s}:u);m(o)},B=async()=>{let t=!0;const s=d.map(i=>((i.limit===""||i.startAfter==="")&&(t=!1),{limit:i.limit,startPeriod:i.startAfter*60}));if(!t||s.length===0){A.error("Please Input Limit and Start After");return}let r={};r={...r,cs_charging_profiles:{chargingProfileId:1,stackLevel:2,chargingProfilePurpose:"TxProfile",chargingProfileKind:"Relative",chargingSchedule:{chargingRateUnit:h==="current"?"A":"B",chargingSchedulePeriod:s}}};const o=[r],u=await z.setChargingProfile({charge_profiles:o});u?.code===200&&(A.success(u.message),I())};return l.useEffect(()=>{j||m([{limit:"",startAfter:"",time:0}])},[j]),e.jsx(W,{title:"Edit Schedule",open:j,onCancel:v,footer:[e.jsxs("div",{className:"footer-normal-btns",children:[e.jsx(x,{onClick:v,children:"Cancel"},"cancel"),e.jsx(x,{type:"primary",onClick:B,children:"Add"},"confirm")]},"add-schedule-footer")],children:e.jsx("div",{className:`modal-form ${n}_form`,children:e.jsxs(a,{form:P,layout:"vertical",children:[e.jsx(a.Item,{name:"chargepoint",label:"Charge Point",rules:[{required:!0}],children:e.jsx($,{placeholder:"Enter",defaultValue:N?.id_tag,disabled:!0})}),e.jsxs("div",{className:"two-column",children:[e.jsx(a.Item,{name:"connector",label:"Connector",rules:[{required:!0}],children:e.jsxs(c,{defaultValue:"a",allowClear:!0,children:[e.jsx(c.Option,{value:"a",children:"Connector A"}),e.jsx(c.Option,{value:"b",children:"Connector A"})]})}),e.jsx(a.Item,{label:""})]}),e.jsxs("div",{className:"two-column",children:[e.jsx(a.Item,{name:"mode",label:"Energy Mode",rules:[{required:!0}],children:C?e.jsx(c,{placeholder:"Select",value:n,style:{width:"100%"},onChange:t=>V(t),children:K.map(t=>e.jsx(c.Option,{value:t.value,children:e.jsx("span",{className:t.value,children:t.label})},t.value))}):e.jsx("div",{className:"form-status charge_mode",children:"Charge Mode"})}),C?e.jsx(a.Item,{label:"",children:e.jsxs("div",{className:"soc-form-wrapper",children:[e.jsx("label",{children:n==="charge_mode"?e.jsxs("div",{className:"icon-label",children:[e.jsx("span",{children:"Max Soc(%)"}),e.jsx(S,{title:"Maximum Charge Limit Is 95%",placement:"top",children:e.jsx("span",{className:"svg-wrapper",children:e.jsx(p,{className:"ml-1",icon:"Help",size:"20"})})})]}):e.jsxs("div",{className:"icon-label",children:[e.jsx("span",{children:"Min Soc(%)"}),e.jsx(S,{title:"Minimum Discharge Limit Is 20%",placement:"top",children:e.jsx("span",{children:e.jsx(p,{className:"ml-1",icon:"Help",size:"20"})})})]})}),e.jsx(g,{min:n==="charge_mode"?1:20,max:n==="charge_mode"?95:1e4,placeholder:"Enter",value:k,onChange:t=>E(t)})]})}):e.jsx(a.Item,{label:""})]}),e.jsxs("div",{className:"two-column",children:[e.jsx(a.Item,{name:"start_time",label:"Start Time",rules:[{required:!0}],children:e.jsx(b,{showTime:!0,format:"YYYY-MM-DD HH:mm",onChange:t=>M(t)})}),e.jsx(a.Item,{name:"end_time",label:"End Time",rules:[{required:!0}],children:e.jsx(b,{showTime:!0,format:"YYYY-MM-DD HH:mm",onChange:t=>_(t)})})]}),e.jsxs("div",{className:"two-column",children:[e.jsx(a.Item,{name:"repeat_kind",label:"Repeat Kind",children:e.jsx(c,{defaultValue:"no",allowClear:!0,children:F.map(t=>e.jsx(c.Option,{value:t.value,children:t.label},t.value))})}),e.jsx(a.Item,{label:""})]}),e.jsxs("div",{className:"between-wrapper mt-2",children:[e.jsx("span",{}),e.jsxs("div",{className:"switch",children:["With Profile",e.jsx(G,{checked:w,onChange:q})]})]}),w&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"between-wrapper",children:[e.jsxs(f.Group,{optionType:"button",value:h,onChange:t=>H(t.target.value),className:"my-4",children:[e.jsx(f.Button,{value:"current",children:"Current"}),e.jsx(f.Button,{value:"power",children:"Power"})]}),e.jsx(x,{type:"link",icon:e.jsx(p,{icon:n==="discharge_mode"?"Add2":"Add",color:n==="discharge_mode"?"#1B6EF3":"currentColor",size:"28"}),onClick:()=>Y()})]}),e.jsx(Q,{children:d.map((t,s)=>e.jsxs("div",{className:"advance-start-row",children:[e.jsx("div",{className:"close-row",children:e.jsx(x,{type:"link",onClick:()=>R(s),icon:e.jsx(p,{icon:"Close",size:"20",color:"#C3C3C3"})})}),e.jsxs("div",{className:"label-value-split ",children:[e.jsx(a.Item,{name:"limit",label:"Limit(W)",rules:[{required:!0,message:h==="current"?"Current limit":"Power limit"}],children:e.jsx(g,{min:1,max:1e5,defaultValue:t.limit,placeholder:h==="current"?"Current limit":"Power limit",onChange:r=>L(s,r)})}),e.jsx(a.Item,{name:"duration",label:"Duration(Minutes)",rules:[{required:!0,message:"Duration"}],children:e.jsx(g,{min:1,max:1e5,placeholder:"Input",defaultValue:t.duration,onChange:r=>O(s,r)})})]},s)]},`setting-${t.time}`))})]})]})})})}export{le as default};

import{j as t,S as u}from"./index-BnnhTYue.js";import{i as l,P as w,s as ae,K as ne,w as h,J as oe,F as re,z as le,O as c}from"./vendor-antd-BiNc4BQP.js";import{r as n}from"./vendor-react-DcqtUZ_G.js";import{c as D}from"./commonService-BFK-GaI3.js";import{c as ie}from"./cpMonitorService-DSYHoixP.js";import{s as v}from"./scheduleService-BhpdH6kG.js";import{e as ce}from"./options-DHqL16EA.js";import de from"./addChargingSchedule-C0ZqHWQe.js";import me from"./detail-DFwret8N.js";import ue from"./editChargingSchedule-idfQs8M7.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DcB4TerO.js";function Me(){const[M,p]=n.useState(!1),[b,f]=n.useState(!1),[d,k]=n.useState([]),[N,g]=n.useState(!1),[x,S]=n.useState(null),[o,r]=n.useState({}),[Y,i]=n.useState(0),[I,T]=n.useState([]),[m,P]=n.useState([]),[E,A]=n.useState([]),[H,C]=n.useState(!1),[R,$]=n.useState(0),K=e=>e.split(" ").map(s=>s.charAt(0).toUpperCase()).join(""),z=[{title:"Charge Point",dataIndex:"id_tag",key:"id_tag",render:(e,s)=>t.jsx(l,{type:"link",onClick:()=>V(s),children:e})},{title:`Scheduled Time(${(()=>{const e={timeZoneName:"long"},j=new Intl.DateTimeFormat("en-US",e).formatToParts(new Date).find(y=>y.type==="timeZoneName").value;return K(j)})()})`,dataIndex:"scheduled_time",key:"scheduled_time"},{title:"Energy Mode",dataIndex:"mode",key:"mode",render:e=>t.jsx("span",{className:e==="Discharge"?"discharge_mode":"charge_mode",children:e})},{title:"Duration",dataIndex:"duration",key:"duration"},{title:"Repeat Kind",dataIndex:"repeat_kind",key:"repeat_kind"},{title:"Operation",width:"140px",key:"operation",render:(e,s)=>t.jsx("div",{className:"operations",children:t.jsx(w,{title:"Confirm delete?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>{_(s.id)},children:t.jsx(l,{type:"link",danger:!0,icon:t.jsx(u,{icon:"Delete",size:"20"}),children:"Delete"})})})}],O=()=>{p(!0)},U=e=>{S(e),f(!0)},V=e=>{S(e),g(!0)},F=e=>{k(e)},Z=()=>{const e={...o};delete e.page,r(e),i(Date.now())},L=e=>{r({...o,page:e}),i(Date.now())},q=()=>{r({}),i(Date.now())},B=async()=>{const{detail:e}=await D.getUsers({num:100});T(e.results.map(a=>({name:`${a.first_name} ${a.last_name}`,phone:a.phone,email:a.email,user_id:a.user_id})));const s=await ie.queryAll({num:100});P(s.detail.results.map(a=>({id:a.id,id_tag:a.id_tag,v2g_support:a.v2g_support,connector_no:a.brand_model.connector_no})))},J=e=>e.map(s=>{const a=(new Date(s.profile_end_datetime).getTime()-new Date(s.profile_start_datetime).getTime())/1e3,j=Math.floor(a/3600),y=Math.floor(a%3600/60),W=Math.floor(a%60),{id:X,last_name:ee,first_name:te}=s,se=c().startOf("day").add(j,"hour").add(y,"minute").add(W,"second").format("HH:mm:ss");return{...s,key:X,user:`${ee} ${te}`,repeat_kind:s.ocpp_recurrency_kind||"None",mode:s.mode==="1"?"Charge":"Discharge",duration:se,start_time:c(s.profile_start_datetime).format("YYYY-MM-DD HH:mm:ss"),end_time:c(s.profile_end_datetime).format("YYYY-MM-DD HH:mm:ss"),scheduled_time:`${c(s.profile_start_datetime).format("YYYY-MM-DD HH:mm:ss")} - ${c(s.profile_end_datetime).format("YYYY-MM-DD HH:mm:ss")}`}}),Q=async()=>{C(!0);const e=await v.queryAll(o),{results:s,count:a}=e.detail;A(J(s||[])),$(a),C(!1)},G=()=>d.map(e=>e.split(D.rowKeySplit)[0]),_=async e=>{try{const s=await v.del({charge_profile_ids:e?[e]:G()});s?.code===200&&(ae.success(s.message),i(Date.now()))}catch{}};return n.useEffect(()=>{Q()},[Y]),n.useEffect(()=>{B(),i(Date.now())},[]),t.jsxs("div",{className:"main-content",children:[t.jsxs("div",{className:"search-area flex items-center justify-start",children:[t.jsxs("div",{className:"search-item",children:[t.jsx("div",{className:"label mb-2",children:"Charge Point"}),t.jsx(ne,{className:"w-full",placeholder:"Enter",onChange:e=>{r({...o,id_tag:e.target.value})}})]}),t.jsxs("div",{className:"search-item",children:[t.jsx("div",{className:"label",children:"User"}),t.jsx(h,{className:"w-full",allowClear:!0,value:o.user_id,style:{width:"150px"},onChange:e=>{r({...o,user_id:e})},placeholder:"Select",children:I.map(e=>t.jsx(h.Option,{value:e.user_id,children:e.name},e.user_id))})]}),t.jsxs("div",{className:"search-item",children:[t.jsx("div",{className:"label",children:"Energy Mode"}),t.jsx(h,{placeholder:"Select",allowClear:!0,style:{width:"210px"},onChange:e=>{r({...o,mode:e})},children:ce.map(e=>t.jsx(h.Option,{value:e.value,children:e.label},e.value))})]}),t.jsx("div",{className:"search-btn",children:t.jsx(l,{icon:t.jsx(u,{icon:"Search",size:"20"}),type:"primary",loading:H,onClick:Z})}),t.jsx("div",{className:"search-btn clear",children:t.jsx(l,{icon:t.jsx(u,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:q})})]}),t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"operation-area flex items-center justify-start",children:[t.jsx(l,{type:"primary",icon:t.jsx(oe,{}),onClick:O,children:"Add Schedule"}),t.jsx(w,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm delete?",onConfirm:()=>{_()},children:t.jsx(l,{disabled:d.length===0,className:"ml-3",icon:t.jsx(u,{color:d.length===0?"#999":"currentColor",icon:"Delete",size:"20"}),children:"Bulk Delete"})})]})}),t.jsx(re,{columns:z,dataSource:E,pagination:!1,rowKey:"key",rowSelection:{selectedRowKeys:d,onChange:F}}),t.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:t.jsx(le,{total:R,showSizeChanger:!1,showQuickJumper:!0,onChange:L})}),m.length>0&&t.jsx(de,{visible:M,onCancel:()=>p(!1),onConfirm:()=>p(!1),chargePoints:m}),m.length>0&&x&&t.jsx(ue,{visible:b,chargePoints:m,onCancel:()=>f(!1),onConfirm:()=>f(!1),record:x}),t.jsx(me,{visible:N,onCancel:()=>g(!1),record:x,onDelete:e=>{_(e),g(!1)},onEdit:U})]})}export{Me as default};

import{j as e,S as d,f as Y}from"./index-C7am5DnG.js";import{r as o}from"./vendor-react-BcJS7s_i.js";import{c as S}from"./commonService-Dnp2opcF.js";import{c as k}from"./cpMonitorService-B31i7Jgz.js";import{c as Be}from"./chargepoint-wPlJlVYc.js";import{v as Ie,b as Z}from"./options-yFwWHVHa.js";import Me from"./detail-VMcun3yH.js";import Ve from"./editConnector-Biq5Qdxm.js";import $e from"./setChargeProfile-DOA2IdS3.js";import De from"./start-kTIJ2KU2.js";import Te from"./v2gStart-Cter3ZXX.js";import{F as E,i as c,K as ze,w as h,x as O,P as _,y as F,j as Ke,I as Oe,z as Fe,s as P}from"./vendor-antd-DmtkV1Ch.js";import"./vendor-ui-DPkccqlC.js";import"./vendor-utils-BKiv1F2M.js";import"./LineChart-B3QMz7OF.js";import"./isEqual-Hc_6Fhhx.js";import"./vendor-charts-Cv5x1InZ.js";import"./index-Dj133iwh.js";const{Option:B}=h,ee={1:"Online",2:"Offline",3:"Unknown"},se={1:"Available",2:"Unavailable",3:"Preparing",4:"Starting",5:"Stopping",6:"Charging",7:"Suspended EV",8:"Suspended EVSE",9:"Finishing",10:"Reserved",11:"Faulted",12:"Unknown",13:"Discharging"};function ns(){const[i,u]=o.useState({page:1}),[I,ae]=o.useState("id_tag"),[g,G]=o.useState([]),[m,y]=o.useState([]),[L,te]=o.useState("list"),[ne,b]=o.useState(!1),[le,M]=o.useState(!1),[re,N]=o.useState(!1),[oe,V]=o.useState(!1),[ie,C]=o.useState(!1),[$,w]=o.useState(null),[f,x]=o.useState(null),[ce,R]=o.useState([]),[j,A]=o.useState([]),[de,U]=o.useState(!1),[he,me]=o.useState(0),[q,p]=o.useState(0),[H,pe]=o.useState({}),[J,ue]=o.useState(null);o.useEffect(()=>{const s=j.filter(a=>g.includes(a.key)).flatMap(a=>a.connectors.map(n=>n.key));y(s)},[g]);const xe=()=>{const s=m.map(a=>{const[n,t]=a.split(S.rowKeySplit);return{charge_point_id:n,connector_id:t}});z(s,!0)},ge=()=>{const s=m.map(a=>{const[n,t]=a.split(S.rowKeySplit);return{charge_point_id:n,connector_id:t}});K(s,!0)},D=s=>{G(s)},je=s=>{if(m.includes(s.key)){const a=m.filter(n=>n!==s.key);y(a)}else y([...m,s.key])},_e=()=>{g.length===j.length?D([]):D(j.map(s=>s.key))},Q=()=>{f?.status==="Charging"?b(!0):P.error("Only the Connector in Charging state supports this operation.")},T=(s,a)=>{const n=[...j];n.map(t=>(s.charge_point_id===t.id&&(t.connectors=t.connectors.map(r=>(s.connector_id===r.connector_id&&(r.charge_mode=a),r))),t)),A(n)},Ce=[E.SELECTION_COLUMN,E.EXPAND_COLUMN,{title:"Charge Point",dataIndex:"id_tag",className:"bold",key:"id_tag",render:(s,a)=>e.jsx(c,{type:"link",onClick:()=>{w(a),V(!0)},children:s})},{title:"Status",dataIndex:"charge_point_status",key:"charge_point_status",render:s=>e.jsxs("div",{className:`status-item ${s.toLowerCase()}`,children:[e.jsx("div",{className:"point"}),e.jsx("span",{children:s})]})},{title:"SN",dataIndex:"sn",key:"sn"},{title:"Brand",dataIndex:"brand",key:"brand"},{title:"Brand Model",dataIndex:"brand_model",key:"brand_model"},{title:"V2G Support",dataIndex:"v2g_support",key:"v2g_support"}],fe=s=>{const a=[{title:"ID",className:"bold",width:"220px",dataIndex:"name",key:"name"},{title:"Status",width:"240px",dataIndex:"status",key:"status",render:n=>e.jsx("div",{className:`status ${n.toLowerCase().replace(" ","_")}`,children:e.jsx("span",{children:n})})},{title:"Charge Mode",width:"160px",dataIndex:"charge_mode",key:"charge_mode",render:(n,t)=>t.v2g_support==="V2G"?e.jsx("div",{className:"change-charge-mode ",children:e.jsx(h,{placeholder:"Select",allowClear:!0,value:n,style:{width:"160px"},onChange:r=>T(t,r),children:Z.map(r=>e.jsx(h.Option,{value:r.value,children:e.jsx("span",{className:r.value,children:r.label})},r.value))})}):e.jsx("div",{className:"status charge_mode",children:e.jsx("span",{children:"Charge Mode"})})},{title:"Operation",width:"340px",key:"operation",render:(n,t)=>e.jsxs("div",{className:"operations end",children:[t.v2g_support==="V2G"?e.jsx(c,{type:"link",onClick:()=>X(t),icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Start"})}):e.jsx(_,{title:"Confirm start?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>z(t),children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Start"})})}),e.jsx(_,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm stop?",onConfirm:()=>K(t),children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Stop",size:"20"}),children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Stop"})})}),e.jsx(c,{type:"link",className:"operation-row-item",icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"AStart",size:"20"}),onClick:()=>{x(t),C(!0)},children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Advance Start"})}),e.jsx(c,{type:"link",icon:e.jsx(d,{color:t.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Set",size:"20"}),onClick:()=>{x(t),Q()},children:e.jsx("span",{className:`btn ${t.charge_mode}`,children:"Set Profile"})})]})}];return e.jsx(E,{columns:a,showHeader:!1,dataSource:s.connectors,pagination:!1,rowKey:"key",bordered:!0,rowSelection:{selectedRowKeys:m,onSelect:je}})},ve=e.jsxs(h,{value:I,onChange:ae,style:{width:156},children:[e.jsx(B,{value:"id_tag",children:"Charge Point"}),e.jsx(B,{value:"sn",children:"SN"})]}),Se=s=>{const{expanded:a,onExpand:n,record:t}=s;return e.jsx("span",{onClick:r=>n(t,r),children:e.jsx(d,{icon:a?"Down":"Right",size:"17",color:"#d9d9d9",style:{marginTop:"-2px"}})})},X=s=>{x(s),N(!0)},z=async(s,a)=>{const n=a?s:[{charge_point_id:s.charge_point_id,connector_id:s.connector_id,mode:"default",soc:{max:.92}}],t=await k.start({cp_id_connector_pairs:n});t?.code===200&&(P.success(t.message),p(Date.now()))},K=async(s,a)=>{const n=a?s:[{charge_point_id:s.charge_point_id,connector_id:s.connector_id}],t=await k.stop({cp_id_connector_pairs:n});t?.code===200&&(P.success(t.message),p(Date.now()))},ye=()=>{const s={...i};delete s.page,u(s),p(Date.now())},be=s=>{u({...i,page:s}),p(Date.now())},Ne=async()=>{const{detail:s}=await S.getBrands({num:100}),a={},n={};s.results.forEach(t=>{a[t.brand]=t.id;const r=[];t.chargepointbrandmodel_set&&t.chargepointbrandmodel_set.forEach(l=>{r.push(l.brand_model)}),n[t.brand]=r}),ue(a),pe(n)},we=(s,a)=>{const n={},t={0:"Connector A",1:"Connector B",2:"Connector C",3:"Connector D",4:"Connector E",5:"Connector F",6:"Connector G",7:"Connector H",8:"Connector I",9:"Connector J"};return a.forEach(l=>{n[l.charge_point_id]={charge_point_status:ee[l.charge_point_status],connector_statuses:l.connector_statuses.map((v,W)=>({key:`${l.charge_point_id}${S.rowKeySplit}${v.connector_id}`,name:t[`${W}`],charge_point_id:l.charge_point_id,connector_id:v.connector_id,charge_mode:"charge_mode",status:se[W%2===1?13:v.status]}))}}),s.filter(l=>n[l.id]).map(l=>({key:`${l.id}${S.rowKeySplit}${l.id_tag}`,id:l.id,id_tag:l.id_tag,sn:l.sn,brand:l.brand_model.brand,brand_model:l.brand_model.brand_model,v2g_support:l.v2g_support?"V2G":"Non-V2G",charge_point_status:n[l.id].charge_point_status,picture:l.brand_model.picture,connectors:n[l.id].connector_statuses.map(v=>({...v,v2g_support:l.v2g_support?"V2G":"Non-V2G"}))}))},ke=()=>{u({}),p(Date.now())},Ee=async()=>{const s={...i};J&&(s.brand_id=J[s.brand],delete s.brand,s.brand_model||delete s.brand_model),U(!0);const a=await k.queryAll({num:100}),{results:n}=a.detail,t=await k.getStatus(s),r=we(n||[],t.detail.results);A(r),$&&r.length&&r.forEach(l=>{l.key===$.key&&w(l)}),R(r.map(l=>l.key)),me(t.detail.count),U(!1)};return o.useEffect(()=>{Ee()},[q]),o.useEffect(()=>{Ne(),p(Date.now())},[]),e.jsxs("div",{className:"main-content",children:[e.jsxs("div",{className:"search-area flex items-center justify-start",children:[e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:" "}),e.jsx(ze,{addonBefore:ve,placeholder:"Enter",allowClear:!0,value:i[I],onChange:s=>{let a={...i};delete a.id_tag,delete a.sn,a={...a,[I]:s.target.value},u(a)}})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Brand"}),e.jsx(h,{className:"w-full",placeholder:"Select",allowClear:!0,value:i.brand,style:{width:"150px"},onChange:s=>{u({...i,brand:s,brand_model:void 0})},children:Object.keys(H).map(s=>e.jsx(h.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Brand Model"}),e.jsx(h,{className:"w-full",allowClear:!0,disabled:!i.brand,placeholder:"Select",style:{width:"160px"},value:i.brand_model,onChange:s=>u({...i,brand_model:s}),children:i.brand&&H[i.brand].map(s=>e.jsx(h.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"V2G Support"}),e.jsx(h,{placeholder:"Select",allowClear:!0,style:{width:"160px"},onChange:s=>{u({...i,v2g_support:!!s})},children:Ie.map(s=>e.jsx(h.Option,{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Charge Point Status"}),e.jsx(h,{className:"w-full",style:{width:"210px"},allowClear:!0,value:i.charge_point_status,placeholder:"Select",onChange:s=>u({...i,charge_point_status:s}),children:Object.entries(ee).map(([s,a])=>e.jsx(B,{value:s,children:`${a}`},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Connector Status"}),e.jsx(h,{className:"w-full",style:{width:"190px"},allowClear:!0,placeholder:"Select",value:i.connector_status,onChange:s=>u({...i,connector_status:s}),children:Object.entries(se).map(([s,a])=>e.jsx(B,{value:s,children:`${a}`},s))})]}),e.jsx("div",{className:"search-btn",children:e.jsx(c,{icon:e.jsx(d,{icon:"Search",size:"20"}),type:"primary",loading:de,onClick:ye})}),e.jsx("div",{className:"search-btn clear",children:e.jsx(c,{icon:e.jsx(d,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:ke})})]}),e.jsxs("div",{className:"operation-area flex items-center justify-start",children:[e.jsxs(O.Group,{className:"layout-switch",value:L,onChange:s=>te(s.target.value),children:[e.jsx(O.Button,{value:"list",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(Y,{icon:"mynaui:list",size:20}),"List"]})}),e.jsx(O.Button,{value:"grid",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(Y,{icon:"proicons:grid",size:20}),"Grid"]})})]}),e.jsx(_,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm Start?",onConfirm:()=>xe(),children:e.jsx(c,{className:"ml-3 mr-3",disabled:m.length===0,icon:e.jsx(d,{icon:"Start",size:"20",color:m.length===0?"#999":"currentColor"}),children:"Bulk Start"})}),e.jsx(_,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm stop?",onConfirm:()=>ge(),children:e.jsx(c,{disabled:m.length===0,className:"mr-3",icon:e.jsx(d,{color:m.length===0?"#999":"currentColor",icon:"Stop",size:"20"}),children:"Bulk Stop"})})]}),L==="list"?e.jsx(E,{columns:Ce,dataSource:j,rowHoverable:!1,bordered:!0,rowKey:"key",pagination:!1,expandable:{expandedRowRender:fe,expandIcon:Se,expandedRowKeys:ce,onExpand:(s,a)=>{R(n=>s?[...n,a.key]:n.filter(t=>t!==a.key))}},rowSelection:{selectedRowKeys:g,onChange:D}}):e.jsxs("div",{className:"grid-wrapper",children:[e.jsx(F,{className:"check-all",checked:j.length===g.length,onChange:_e}),e.jsx("div",{className:"grid",children:j.map(s=>e.jsx("div",{className:"grid-item",children:e.jsxs(Ke,{children:[e.jsxs("div",{className:"grid-top with-image flex items-center",children:[e.jsx(F,{checked:g.includes(s.key),onChange:a=>{const n=a.target.checked?[...g,s.key]:g.filter(t=>t!==s.key);G(n)}}),e.jsx(Oe,{src:Be,preview:!1,height:184,className:"entity-image object-cover"})]}),e.jsxs("div",{className:"grid-bottom monitor-bottom",children:[e.jsx("div",{className:"display-item",children:e.jsx(c,{type:"link",className:"detail-link",onClick:()=>{w(s),V(!0)},children:s.id_tag})}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Status:"})," ",e.jsx("span",{className:"value",children:e.jsxs("div",{className:`status-item ${s.charge_point_status.toLowerCase().replace(" ","_")}`,children:[e.jsx("div",{className:"point"}),e.jsx("span",{children:s.charge_point_status})]})})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"SN:"})," ",e.jsx("span",{className:"value",children:s.sn})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand:"})," ",e.jsx("span",{className:"value",children:s.brand})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand Model:"})," ",e.jsx("span",{className:"value",children:s.brand_model})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"V2G Support:"})," ",e.jsx("span",{className:"value",children:s.v2g_support})]}),s.charge_point_status!=="Offline"&&e.jsx("div",{className:"display-item  !mb-0 flex-col !items-start gap-2 !px-0",children:s.connectors.map(a=>e.jsxs("div",{className:"connector-wrapper w-full",children:[e.jsxs("div",{className:"connectors",children:[e.jsx(F,{checked:m.includes(a.key),onChange:n=>{const t=n.target.checked?[...m,a.key]:m.filter(r=>r!==a.key);y(t)}}),e.jsx("div",{className:"items flex-auto",children:e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:a.name})," ",e.jsx("span",{className:`value status ${a.status.toLowerCase().replace(" ","_")}`,children:a.status})]})})]}),e.jsxs("div",{className:"operation-columns",children:[e.jsxs("div",{className:"operation-row",children:[a.v2g_support==="V2G"?e.jsx(h,{placeholder:"Select",allowClear:!0,value:a.charge_mode,style:{width:"160px"},onChange:n=>T(a,n),children:Z.map(n=>e.jsx(h.Option,{value:n.value,children:e.jsx("span",{className:n.value,children:n.label})},n.value))}):e.jsx("div",{className:"status charge_mode",children:e.jsx("span",{children:"Charge Mode"})}),e.jsxs("div",{className:"btns",children:[a.v2g_support==="V2G"?e.jsx(c,{type:"link",onClick:()=>X(a),icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`,children:"Start"})}):e.jsx(_,{title:"Confirm start?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>z(a),children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`,children:"Start"})})}),e.jsx("div",{className:"split"}),e.jsx(_,{title:"Confirm stop?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>K(a),children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Stop",size:"20"}),children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`,children:"Stop"})})})]})]}),e.jsxs("div",{className:"operation-row",children:[e.jsx(c,{type:"link",className:"operation-row-item",icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"AStart",size:"20"}),onClick:()=>{x(a),C(!0)},children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`,children:"Advance Start"})}),e.jsx(c,{type:"link",icon:e.jsx(d,{color:a.charge_mode==="discharge_mode"?"#1B6EF3":"currentColor",icon:"Set",size:"20"}),onClick:()=>{x(a),Q()},children:e.jsx("span",{className:`btn ${a.charge_mode==="discharge_mode"?"discharging":"'"}`,children:"Set Profile"})})]})]})]},a.key))})]})]},s.key)}))})]}),e.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:e.jsx(Fe,{total:he,showQuickJumper:!0,onChange:be})}),e.jsx($e,{visible:ne,connector:f,onCancel:()=>b(!1),onConfirm:()=>{b(!1),p(Date.now())}}),e.jsx(Ve,{visible:le,connector:f,onCancel:()=>M(!1),onConfirm:()=>{M(!1)}}),e.jsx(Te,{visible:re,connector:f,onCancel:()=>N(!1),onConfirm:()=>{N(!1)}}),oe?e.jsx(Me,{onCancel:()=>{w(null),V(!1),p(Date.now())},updateList:q,chargePoint:$,onChangeChargeMode:(s,a)=>{T(s,a)},handleV2gStart:s=>{x(s),N(!0)},onStart:s=>{x(s),C(!0)},onUpdate:()=>{p(Date.now())},onSetChargeProfile:s=>{x(s),b(!0)},onEditConnector:s=>{x(s),M(!0)}}):null,e.jsx(De,{visible:ie,connector:f,onCancel:()=>C(!1),onConfirm:()=>{C(!1),p(Date.now())}})]})}export{ns as default};

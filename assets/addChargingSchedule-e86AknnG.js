import{j as e,S as p}from"./index-x526v5wV.js";import{r as l}from"./vendor-react-DcqtUZ_G.js";import{c as B}from"./cpMonitorService-B1l_pe55.js";import{b as z,r as K}from"./options-MDMYukvs.js";import{H as s,E as F,i as x,K as W,w as c,k as S,Q as g,$ as A,o as $,x as f,j as G,s as b}from"./vendor-antd-BiNc4BQP.js";import"./vendor-ui-BASYQBt4.js";import"./vendor-utils-DcB4TerO.js";function ae({visible:j,onCancel:v,onConfirm:N}){const[I]=s.useForm(),[Q,P]=l.useState(null),[w,y]=l.useState(!1),[U,M]=l.useState(null),[d,m]=l.useState([{limit:"",startAfter:"",time:0}]),[h,_]=l.useState("current"),[C,D]=l.useState(!0),[T,k]=l.useState(),[i,E]=l.useState("charge_mode"),Y=()=>{D(!0),m([...d,{limit:"",startAfter:"",time:Date.now()}])},q=r=>{y(r)},H=r=>{_(r),m([{limit:"",startAfter:"",time:Date.now()}])},R=r=>{const a=d.filter((t,o)=>o!==r);m([...a])},V=(r,a)=>{const t=[...d],o=t.map((u,n)=>n===r?{...t[r]||{limit:"",startAfter:"",time:Date.now()},limit:a}:u);m(o)},L=(r,a)=>{const t=[...d],o=t.map((u,n)=>n===r?{...t[r]||{limit:"",startAfter:"",time:Date.now()},startAfter:a}:u);m(o)},O=async()=>{let r=!0;const a=d.map(n=>((n.limit===""||n.startAfter==="")&&(r=!1),{limit:n.limit,startPeriod:n.startAfter*60}));if(!r||a.length===0){b.error("Please Input Limit and Start After");return}let t={};t={...t,cs_charging_profiles:{chargingProfileId:1,stackLevel:2,chargingProfilePurpose:"TxProfile",chargingProfileKind:"Relative",chargingSchedule:{chargingRateUnit:h==="current"?"A":"B",chargingSchedulePeriod:a}}};const o=[t],u=await B.setChargingProfile({charge_profiles:o});u?.code===200&&(b.success(u.message),N())};return l.useEffect(()=>{j||m([{limit:"",startAfter:"",time:0}])},[j]),e.jsx(F,{title:"Add Schedule",open:j,onCancel:v,footer:[e.jsxs("div",{className:"footer-normal-btns",children:[e.jsx(x,{onClick:v,children:"Cancel"},"cancel"),e.jsx(x,{type:"primary",onClick:O,children:"Add"},"confirm")]},"add-schedule-footer")],children:e.jsx("div",{className:`modal-form ${i}_form`,children:e.jsxs(s,{form:I,layout:"vertical",children:[e.jsx(s.Item,{name:"chargepoint",label:"Charge Point",rules:[{required:!0}],children:e.jsx(W,{placeholder:"Enter"})}),e.jsxs("div",{className:"two-column",children:[e.jsx(s.Item,{name:"connector",label:"Connector",rules:[{required:!0}],children:e.jsxs(c,{defaultValue:"a",allowClear:!0,children:[e.jsx(c.Option,{value:"a",children:"Connector A"}),e.jsx(c.Option,{value:"b",children:"Connector A"})]})}),e.jsx(s.Item,{label:""})]}),e.jsxs("div",{className:"two-column",children:[e.jsx(s.Item,{name:"mode",label:"Energy Mode",rules:[{required:!0}],children:C?e.jsx(c,{placeholder:"Select",value:i,style:{width:"100%"},onChange:r=>E(r),children:z.map(r=>e.jsx(c.Option,{value:r.value,children:e.jsx("span",{className:r.value,children:r.label})},r.value))}):e.jsx("div",{className:"form-status charge_mode",children:"Charge Mode"})}),C?e.jsx(s.Item,{label:"",children:e.jsxs("div",{className:"soc-form-wrapper",children:[e.jsx("label",{children:i==="charge_mode"?e.jsxs("div",{className:"icon-label",children:[e.jsx("span",{children:"Max Soc(%)"}),e.jsx(S,{title:"Maximum Charge Limit Is 95%",placement:"top",children:e.jsx("span",{className:"svg-wrapper",children:e.jsx(p,{className:"ml-1",icon:"Help",size:"20"})})})]}):e.jsxs("div",{className:"icon-label",children:[e.jsx("span",{children:"Min Soc(%)"}),e.jsx(S,{title:"Minimum Discharge Limit Is 20%",placement:"top",children:e.jsx("span",{children:e.jsx(p,{className:"ml-1",icon:"Help",size:"20"})})})]})}),e.jsx(g,{min:i==="charge_mode"?1:20,max:i==="charge_mode"?95:1e4,placeholder:"Enter",value:T,onChange:r=>k(r)})]})}):e.jsx(s.Item,{label:""})]}),e.jsxs("div",{className:"two-column",children:[e.jsx(s.Item,{name:"start_time",label:"Start Time",rules:[{required:!0}],children:e.jsx(A,{showTime:!0,format:"YYYY-MM-DD HH:mm",onChange:r=>P(r)})}),e.jsx(s.Item,{name:"end_time",label:"End Time",rules:[{required:!0}],children:e.jsx(A,{showTime:!0,format:"YYYY-MM-DD HH:mm",onChange:r=>M(r)})})]}),e.jsxs("div",{className:"two-column",children:[e.jsx(s.Item,{name:"repeat_kind",label:"Repeat Kind",children:e.jsx(c,{defaultValue:"no",allowClear:!0,children:K.map(r=>e.jsx(c.Option,{value:r.value,children:r.label},r.value))})}),e.jsx(s.Item,{label:""})]}),e.jsxs("div",{className:"between-wrapper mt-2",children:[e.jsx("span",{}),e.jsxs("div",{className:"switch",children:["With Profile",e.jsx($,{checked:w,onChange:q})]})]}),w&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"between-wrapper",children:[e.jsxs(f.Group,{optionType:"button",value:h,onChange:r=>H(r.target.value),className:"my-4",children:[e.jsx(f.Button,{value:"current",children:"Current"}),e.jsx(f.Button,{value:"power",children:"Power"})]}),e.jsx(x,{type:"link",icon:e.jsx(p,{icon:i==="discharge_mode"?"Add2":"Add",color:i==="discharge_mode"?"#1B6EF3":"currentColor",size:"28"}),onClick:()=>Y()})]}),e.jsx(G,{children:d.map((r,a)=>e.jsxs("div",{className:"advance-start-row",children:[e.jsx("div",{className:"close-row",children:e.jsx(x,{type:"link",onClick:()=>R(a),icon:e.jsx(p,{icon:"Close",size:"20",color:"#C3C3C3"})})}),e.jsxs("div",{className:"label-value-split ",children:[e.jsx(s.Item,{name:"limit",label:"Limit(W)",rules:[{required:!0,message:h==="current"?"Current limit":"Power limit"}],children:e.jsx(g,{min:1,max:1e5,defaultValue:r.limit,placeholder:h==="current"?"Current limit":"Power limit",onChange:t=>V(a,t)})}),e.jsx(s.Item,{name:"duration",label:"Duration(Minutes)",rules:[{required:!0,message:"Duration"}],children:e.jsx(g,{min:1,max:1e5,placeholder:"Input",defaultValue:r.duration,onChange:t=>L(a,t)})})]},a)]},`setting-${r.time}`))})]})]})})})}export{ae as default};

import{j as e,S as d,f as Y}from"./index-B9brM18d.js";import{r}from"./vendor-react-BcJS7s_i.js";import{c as y}from"./commonService-D-DJLYtp.js";import{c as E}from"./cpMonitorService-C-b0sAUN.js";import{c as Le}from"./chargepoint-wPlJlVYc.js";import{v as Be,b as Z}from"./options-BdxPQc9L.js";import Ie from"./detail-CCv79lTx.js";import Ve from"./editConnector-BQW8Rd_7.js";import Me from"./setChargeProfile-DW3EAW8B.js";import $e from"./start-BPzFWtwf.js";import De from"./v2gStart-D-ZvZLst.js";import{F as L,i as c,K as Te,w as h,x as O,P as f,y as F,j as ze,I as Ke,z as Oe,s as G}from"./vendor-antd-DmtkV1Ch.js";import"./vendor-ui-DPkccqlC.js";import"./vendor-utils-BKiv1F2M.js";import"./LineChart-9h1fpD2o.js";import"./isEqual-Hc_6Fhhx.js";import"./vendor-charts-Cv5x1InZ.js";import"./index-Dj133iwh.js";const{Option:B}=h,ee={1:"Online",2:"Offline",3:"Unknown"},se={1:"Available",2:"Unavailable",3:"Preparing",4:"Starting",5:"Stopping",6:"Charging",7:"Suspended EV",8:"Suspended EVSE",9:"Finishing",10:"Reserved",11:"Faulted",12:"Unknown",13:"Discharging"};function ns(){const[o,x]=r.useState({page:1}),[I,ae]=r.useState("id_tag"),[g,P]=r.useState([]),[p,w]=r.useState([]),[R,te]=r.useState("list"),[ne,b]=r.useState(!1),[le,V]=r.useState(!1),[ie,N]=r.useState(!1),[re,M]=r.useState(!1),[oe,_]=r.useState(!1),[$,k]=r.useState(null),[S,u]=r.useState(null),[ce,A]=r.useState([]),[C,U]=r.useState([]),[de,q]=r.useState(!1),[he,pe]=r.useState(0),[H,m]=r.useState(0),[J,me]=r.useState({}),[Q,ue]=r.useState(null);r.useEffect(()=>{const s=C.filter(a=>g.includes(a.key)).flatMap(a=>a.connectors.map(n=>n.key));w(s)},[g]);const xe=()=>{const s=p.map(a=>{const[n,t]=a.split(y.rowKeySplit);return{charge_point_id:n,connector_id:t}});z(s,!0)},ge=()=>{const s=p.map(a=>{const[n,t]=a.split(y.rowKeySplit);return{charge_point_id:n,connector_id:t}});K(s,!0)},D=s=>{P(s)},Ce=s=>{if(p.includes(s.key)){const a=p.filter(n=>n!==s.key);w(a)}else w([...p,s.key])},je=()=>{g.length===C.length?D([]):D(C.map(s=>s.key))},X=()=>{S?.status==="Charging"?b(!0):G.error("Only the Connector in Charging state supports this operation.")},T=(s,a)=>{const n=[...C];n.map(t=>(s.charge_point_id===t.id&&(t.connectors=t.connectors.map(i=>(s.connector_id===i.connector_id&&(i.charge_mode=a),i))),t)),U(n)},fe=[L.SELECTION_COLUMN,L.EXPAND_COLUMN,{title:"Charge Point",dataIndex:"id_tag",className:"bold",key:"id_tag",render:(s,a)=>e.jsx(c,{type:"link",onClick:()=>{k(a),M(!0)},children:s})},{title:"Status",dataIndex:"charge_point_status",key:"charge_point_status",render:s=>e.jsxs("div",{className:`status-item ${s.toLowerCase()}`,children:[e.jsx("div",{className:"point"}),e.jsx("span",{children:s})]})},{title:"SN",dataIndex:"sn",key:"sn"},{title:"Brand",dataIndex:"brand",key:"brand"},{title:"Brand Model",dataIndex:"brand_model",key:"brand_model"},{title:"V2G Support",dataIndex:"v2g_support",key:"v2g_support"}],_e=s=>{const a=[{title:"ID",className:"bold",width:"280px",dataIndex:"name",key:"name"},{title:"Status",width:"240px",dataIndex:"status",key:"status",render:n=>e.jsx("div",{className:`status ${n.toLowerCase().replace(" ","_")}`,children:e.jsx("span",{children:n})})},{title:"Charge Mode",width:"160px",dataIndex:"charge_mode",key:"charge_mode",render:(n,t)=>e.jsx("div",{className:"change-charge-mode ",children:e.jsx(h,{placeholder:"Select",allowClear:!0,disabled:t.v2g_support==="Non-V2G",value:n,style:{width:"160px"},onChange:i=>T(t,i),children:Z.map(i=>e.jsx(h.Option,{value:i.value,children:e.jsx("span",{className:i.value,children:i.label})},i.value))})})},{title:"Operation",width:"340px",key:"operation",render:(n,t)=>e.jsxs("div",{className:"operations end",children:[t.v2g_support==="V2G"?e.jsx(c,{type:"link",onClick:()=>W(t),icon:e.jsx(d,{color:t.status.toLowerCase()==="discharging"?"1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${t.status.toLowerCase()}`,children:"Start"})}):e.jsx(f,{title:"Confirm start?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>z(t),children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:t.status.toLowerCase()==="discharging"?"1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${t.status.toLowerCase()}`,children:"Start"})})}),e.jsx(f,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm stop?",onConfirm:()=>K(t),children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:t.status.toLowerCase()==="discharging"?"1B6EF3":"currentColor",icon:"Stop",size:"20"}),children:e.jsx("span",{className:`btn ${t.status.toLowerCase()}`,children:"Stop"})})}),e.jsx(c,{type:"link",className:"operation-row-item",icon:e.jsx(d,{color:t.status.toLowerCase()==="discharging"?"1B6EF3":"currentColor",icon:"AStart",size:"20"}),onClick:()=>{u(t),_(!0)},children:e.jsx("span",{className:`btn ${t.status.toLowerCase()}`,children:"Advance Start"})}),e.jsx(c,{type:"link",icon:e.jsx(d,{color:t.status.toLowerCase()==="discharging"?"1B6EF3":"currentColor",icon:"Set",size:"20"}),onClick:()=>{u(t),X()},children:e.jsx("span",{className:`btn ${t.status.toLowerCase()}`,children:"Set Profile"})})]})}];return e.jsx(L,{columns:a,showHeader:!1,dataSource:s.connectors,pagination:!1,rowKey:"key",bordered:!0,rowSelection:{selectedRowKeys:p,onSelect:Ce}})},Se=e.jsxs(h,{value:I,onChange:ae,style:{width:156},children:[e.jsx(B,{value:"id_tag",children:"Charge Point"}),e.jsx(B,{value:"sn",children:"SN"})]}),ve=s=>{const{expanded:a,onExpand:n,record:t}=s;return e.jsx("span",{onClick:i=>n(t,i),children:e.jsx(d,{icon:a?"Down":"Right",size:"17",color:"#d9d9d9",style:{marginTop:"-2px"}})})},W=s=>{u(s),N(!0)},z=async(s,a)=>{const n=a?s:[{charge_point_id:s.charge_point_id,connector_id:s.connector_id,mode:"default",soc:{max:.92}}],t=await E.start({cp_id_connector_pairs:n});t?.code===200&&(G.success(t.message),m(Date.now()))},K=async(s,a)=>{const n=a?s:[{charge_point_id:s.charge_point_id,connector_id:s.connector_id}],t=await E.stop({cp_id_connector_pairs:n});t?.code===200&&(G.success(t.message),m(Date.now()))},ye=()=>{m(Date.now())},we=s=>{x({...o,page:s}),m(Date.now())},be=async()=>{const{detail:s}=await y.getBrands({num:100}),a={},n={};s.results.forEach(t=>{a[t.brand]=t.id;const i=[];t.chargepointbrandmodel_set&&t.chargepointbrandmodel_set.forEach(l=>{i.push(l.brand_model)}),n[t.brand]=i}),ue(a),me(n)},Ne=(s,a)=>{const n={},t={0:"Connector A",1:"Connector B",2:"Connector C",3:"Connector D",4:"Connector E",5:"Connector F",6:"Connector G",7:"Connector H",8:"Connector I",9:"Connector J"};return a.forEach(l=>{n[l.charge_point_id]={charge_point_status:ee[l.charge_point_status],connector_statuses:l.connector_statuses.map((j,v)=>({key:`${l.charge_point_id}${y.rowKeySplit}${j.connector_id}`,name:t[`${v}`],charge_point_id:l.charge_point_id,connector_id:j.connector_id,charge_mode:v%2===1?"discharge_mode":"charge_mode",status:se[v%2===1?13:j.status]}))}}),s.filter(l=>n[l.id]).map((l,j)=>({key:`${l.id}${y.rowKeySplit}${l.id_tag}`,id:l.id,id_tag:l.id_tag,sn:l.sn,brand:l.brand_model.brand,brand_model:l.brand_model.brand_model,v2g_support:j%2===1?"Non-V2G":"V2G",charge_point_status:n[l.id].charge_point_status,picture:l.brand_model.picture,connectors:n[l.id].connector_statuses.map(v=>({...v,v2g_support:j%2===1?"Non-V2G":"V2G"}))}))},ke=()=>{x({}),m(Date.now())},Ee=async()=>{const s={...o};Q&&(s.brand_id=Q[s.brand],delete s.brand,s.brand_model||delete s.brand_model),q(!0);const a=await E.queryAll({num:100}),{results:n}=a.detail,t=await E.getStatus(s),i=Ne(n||[],t.detail.results);U(i),$&&i.length&&i.forEach(l=>{l.key===$.key&&k(l)}),A(i.map(l=>l.key)),pe(t.detail.count),q(!1)};return r.useEffect(()=>{Ee()},[H]),r.useEffect(()=>{be(),m(Date.now())},[]),e.jsxs("div",{className:"main-content",children:[e.jsxs("div",{className:"search-area flex items-center justify-start",children:[e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Enter"}),e.jsx(Te,{addonBefore:Se,placeholder:"Enter",allowClear:!0,value:o[I],onChange:s=>{let a={...o};delete a.id_tag,delete a.sn,a={...a,[I]:s.target.value},x(a)}})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Brand"}),e.jsx(h,{className:"w-full",placeholder:"Select",allowClear:!0,value:o.brand,style:{width:"150px"},onChange:s=>{x({...o,brand:s,brand_model:void 0})},children:Object.keys(J).map(s=>e.jsx(h.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Brand Model"}),e.jsx(h,{className:"w-full",allowClear:!0,disabled:!o.brand,placeholder:"Select",style:{width:"160px"},value:o.brand_model,onChange:s=>x({...o,brand_model:s}),children:o.brand&&J[o.brand].map(s=>e.jsx(h.Option,{value:s,children:s},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"V2G Support"}),e.jsx(h,{placeholder:"Select",allowClear:!0,style:{width:"160px"},onChange:s=>{x({...o,v2g_support:!!s})},children:Be.map(s=>e.jsx(h.Option,{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Charge Point Status"}),e.jsx(h,{className:"w-full",style:{width:"210px"},allowClear:!0,value:o.charge_point_status,placeholder:"Select",onChange:s=>x({...o,charge_point_status:s}),children:Object.entries(ee).map(([s,a])=>e.jsx(B,{value:s,children:`${a}`},s))})]}),e.jsxs("div",{className:"search-item",children:[e.jsx("div",{className:"label",children:"Connector Status"}),e.jsx(h,{className:"w-full",style:{width:"190px"},allowClear:!0,placeholder:"Select",value:o.connector_status,onChange:s=>x({...o,connector_status:s}),children:Object.entries(se).map(([s,a])=>e.jsx(B,{value:s,children:`${a}`},s))})]}),e.jsx("div",{className:"search-btn",children:e.jsx(c,{icon:e.jsx(d,{icon:"Search",size:"20"}),type:"primary",loading:de,onClick:ye})}),e.jsx("div",{className:"search-btn clear",children:e.jsx(c,{icon:e.jsx(d,{icon:"Close",size:"24",color:"#999"}),type:"primary",onClick:ke})})]}),e.jsxs("div",{className:"operation-area flex items-center justify-start",children:[e.jsxs(O.Group,{className:"layout-switch",value:R,onChange:s=>te(s.target.value),children:[e.jsx(O.Button,{value:"list",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(Y,{icon:"mynaui:list",size:20}),"List"]})}),e.jsx(O.Button,{value:"grid",children:e.jsxs("div",{className:"layout-switch-item",children:[e.jsx(Y,{icon:"proicons:grid",size:20}),"Grid"]})})]}),e.jsx(f,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm Start?",onConfirm:()=>xe(),children:e.jsx(c,{className:"ml-3 mr-3",disabled:p.length===0,icon:e.jsx(d,{icon:"Start",size:"20",color:p.length===0?"#999":"currentColor"}),children:"Bulk Start"})}),e.jsx(f,{placement:"bottom",okText:"Confirm",cancelText:"Cancel",title:"Confirm stop?",onConfirm:()=>ge(),children:e.jsx(c,{disabled:p.length===0,className:"mr-3",icon:e.jsx(d,{color:p.length===0?"#999":"currentColor",icon:"Stop",size:"20"}),children:"Bulk Stop"})})]}),R==="list"?e.jsx(L,{columns:fe,dataSource:C,rowHoverable:!1,bordered:!0,rowKey:"key",pagination:!1,expandable:{expandedRowRender:_e,expandIcon:ve,expandedRowKeys:ce,onExpand:(s,a)=>{A(n=>s?[...n,a.key]:n.filter(t=>t!==a.key))}},rowSelection:{selectedRowKeys:g,onChange:D}}):e.jsxs("div",{className:"grid-wrapper",children:[e.jsx(F,{className:"check-all",checked:C.length===g.length,onChange:je}),e.jsx("div",{className:"grid",children:C.map(s=>e.jsx("div",{className:"grid-item",children:e.jsxs(ze,{children:[e.jsxs("div",{className:"grid-top with-image flex items-center",children:[e.jsx(F,{checked:g.includes(s.key),onChange:a=>{const n=a.target.checked?[...g,s.key]:g.filter(t=>t!==s.key);P(n)}}),e.jsx(Ke,{src:Le,preview:!1,height:184,className:"entity-image object-cover"})]}),e.jsxs("div",{className:"grid-bottom monitor-bottom",children:[e.jsx("div",{className:"display-item",children:e.jsx(c,{type:"link",className:"detail-link",onClick:()=>{k(s),M(!0)},children:s.id_tag})}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Status:"})," ",e.jsx("span",{className:"value",children:e.jsxs("div",{className:`status-item ${s.charge_point_status.toLowerCase().replace(" ","_")}`,children:[e.jsx("div",{className:"point"}),e.jsx("span",{children:s.charge_point_status})]})})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"SN:"})," ",e.jsx("span",{className:"value",children:s.sn})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand:"})," ",e.jsx("span",{className:"value",children:s.brand})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"Brand Model:"})," ",e.jsx("span",{className:"value",children:s.brand_model})]}),e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:"V2G Support:"})," ",e.jsx("span",{className:"value",children:s.v2g_support})]}),s.charge_point_status!=="Offline"&&e.jsx("div",{className:"display-item  !mb-0 flex-col !items-start gap-2 !px-0",children:s.connectors.map(a=>e.jsxs("div",{className:"connector-wrapper w-full",children:[e.jsxs("div",{className:"connectors",children:[e.jsx(F,{checked:p.includes(a.key),onChange:n=>{const t=n.target.checked?[...p,a.key]:p.filter(i=>i!==a.key);w(t)}}),e.jsx("div",{className:"items flex-auto",children:e.jsxs("div",{className:"display-item",children:[e.jsx("span",{className:"label",children:a.name})," ",e.jsx("span",{className:`value status ${a.status.toLowerCase().replace(" ","_")}`,children:a.status})]})})]}),e.jsxs("div",{className:"operation-columns",children:[e.jsxs("div",{className:"operation-row",children:[e.jsx(h,{placeholder:"Select",allowClear:!0,value:a.charge_mode,disabled:a.v2g_support==="Non-V2G",style:{width:"160px"},onChange:n=>T(a,n),children:Z.map(n=>e.jsx(h.Option,{value:n.value,children:e.jsx("span",{className:n.value,children:n.label})},n.value))}),e.jsxs("div",{className:"btns",children:[a.v2g_support==="V2G"?e.jsx(c,{type:"link",onClick:()=>W(a),icon:e.jsx(d,{color:a.status.toLowerCase()==="discharging"?"1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${a.status.toLowerCase()==="discharging"?"discharging":"'"}`,children:"Start"})}):e.jsx(f,{title:"Confirm start?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>z(a),children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:a.status.toLowerCase()==="discharging"?"1B6EF3":"currentColor",icon:"Start",size:"20"}),children:e.jsx("span",{className:`btn ${a.status.toLowerCase()==="discharging"?"discharging":"'"}`,children:"Start"})})}),e.jsx("div",{className:"split"}),e.jsx(f,{title:"Confirm stop?",placement:"bottom",okText:"Confirm",cancelText:"Cancel",onConfirm:()=>K(a),children:e.jsx(c,{type:"link",icon:e.jsx(d,{color:a.status.toLowerCase()==="discharging"?"1B6EF3":"currentColor",icon:"Stop",size:"20"}),children:e.jsx("span",{className:`btn ${a.status.toLowerCase()==="discharging"?"discharging":"'"}`,children:"Stop"})})})]})]}),e.jsxs("div",{className:"operation-row",children:[e.jsx(c,{type:"link",className:"operation-row-item",icon:e.jsx(d,{color:a.status.toLowerCase()==="discharging"?"1B6EF3":"currentColor",icon:"AStart",size:"20"}),onClick:()=>{u(a),_(!0)},children:e.jsx("span",{className:`btn ${a.status.toLowerCase()==="discharging"?"discharging":"'"}`,children:"Advance Start"})}),e.jsx(c,{type:"link",icon:e.jsx(d,{color:a.status.toLowerCase()==="discharging"?"1B6EF3":"currentColor",icon:"Set",size:"20"}),onClick:()=>{u(a),X()},children:e.jsx("span",{className:`btn ${a.status.toLowerCase()==="discharging"?"discharging":"'"}`,children:"Set Profile"})})]})]})]},a.key))})]})]},s.key)}))})]}),e.jsx("div",{className:"mr-4 mt-4 flex justify-end",children:e.jsx(Oe,{total:he,showQuickJumper:!0,onChange:we})}),e.jsx(Me,{visible:ne,connector:S,onCancel:()=>b(!1),onConfirm:()=>{b(!1),m(Date.now())}}),e.jsx(Ve,{visible:le,connector:S,onCancel:()=>V(!1),onConfirm:()=>{V(!1)}}),e.jsx(De,{visible:ie,connector:S,onCancel:()=>N(!1),onConfirm:()=>{N(!1)}}),re?e.jsx(Ie,{onCancel:()=>{k(null),M(!1),m(Date.now())},updateList:H,chargePoint:$,onChangeChargeMode:(s,a)=>{T(s,a)},handleV2gStart:s=>{u(s),N(!0)},onStart:s=>{u(s),_(!0)},onUpdate:()=>{m(Date.now())},onSetChargeProfile:s=>{u(s),b(!0)},onEditConnector:s=>{u(s),V(!0)}}):null,e.jsx($e,{visible:oe,connector:S,onCancel:()=>_(!1),onConfirm:()=>{_(!1),m(Date.now())}})]})}export{ns as default};
